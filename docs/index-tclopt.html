<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>Tcl wrapper for C optimization procedures</title>
<link rel='stylesheet' type='text/css' href='assets/ruff-min.css' />
<script type='text/javascript' src='assets/ruff-min.js'></script>
</head>
<body>
<div class='ruff-layout'>
<header class='ruff-layout-header ruff-hd'>
<a style='text-decoration:none;' href='index.html'>Tcl wrapper for C optimization procedures (v0.21)</a>


            <div id="ruffButtonBar">
            <button id="ruffNavMove" onclick="ruffMoveNavPane()"></button>
            <button id="ruffToggleTheme" onclick="ruffNextTheme()"></button>
            </div>
        </header><main class='ruff-layout-main ruff-bd'><h1 class='ruff'><a name='::tclopt'></a>::tclopt<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h1>
<div style='clear:both;'></div>
<h2 class='ruff'><a name='::tclopt-Classes'></a>Classes<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h2>
<div style='clear:both;'></div>
<h3 class='ruffclass'><a name='::tclopt::DE'>DE</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::DE::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DE::addPars" title="addPars" class='ruff_cmd'>addPars</a></td><td>Not documented.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><code>duplListCheck</code></td><td>See <a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="DuplChecker.duplListCheck" class='ruff_cmd'>DuplChecker.duplListCheck</a></td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DE::getAllPars" title="getAllPars" class='ruff_cmd'>getAllPars</a></td><td>Gets references of all parameters objects.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DE::getAllParsNames" title="getAllParsNames" class='ruff_cmd'>getAllParsNames</a></td><td>Gets names of all parameters.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DE::run" title="run" class='ruff_cmd'>run</a></td><td>Runs optimization.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-abstol</font></code>, <code><font color=#b9b96e>-cr</font></code>, <code><font color=#b9b96e>-d</font></code>, <code><font color=#b9b96e>-debug</font></code>, <code><font color=#b9b96e>-f</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-genmax</font></code>, <code><font color=#b9b96e>-initpop</font></code>, <code><font color=#b9b96e>-initype</font></code>, <code><font color=#b9b96e>-np</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-refresh</font></code>, <code><font color=#b9b96e>-reltol</font></code>, <code><font color=#b9b96e>-seed</font></code>, <code><font color=#b9b96e>-strategy</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-abstol</font></code>, <code><font color=#b9b96e>-cr</font></code>, <code><font color=#b9b96e>-d</font></code>, <code><font color=#b9b96e>-debug</font></code>, <code><font color=#b9b96e>-f</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-genmax</font></code>, <code><font color=#b9b96e>-initpop</font></code>, <code><font color=#b9b96e>-initype</font></code>, <code><font color=#b9b96e>-np</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-refresh</font></code>, <code><font color=#b9b96e>-reltol</font></code>, <code><font color=#b9b96e>-seed</font></code>, <code><font color=#b9b96e>-strategy</font></code></p>
<h5 class='ruff'>Mixins</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::DuplChecker" title="DuplChecker" class='ruff_cmd'>DuplChecker</a></p>
<h4 class='ruffmethod'><a name='::tclopt::DE::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DE" title="::tclopt::DE" class='ruff_cmd'>::tclopt::DE</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Creates optimization object that tuns optimization using modified Differential Evolution algorithm.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT constructor</span> <span class='ruff_arg'>-funct value -strategy value -pdata value ?-genmax value? ?-refresh value? ?-np value? ?-f value? ?-cr value? ?-seed value? ?-abstol value? ?-reltol value? ?-debug? ?-random|specified -initpop value?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><font color=#b9b96e>-abstol</font></code></td><td>Absolute tolerance. Controls termination of optimization. Default 1e-6.</td></tr>
<tr><td><code><font color=#b9b96e>-cr</font></code></td><td>Crossing over factor (crossover rate). Controls the probability of mixing components from the target vector and the mutant vector to form a trial vector. It determines how much of the trial vector inherits its components from the mutant vector versus the target vector. A high crossover rate means that more components will come from the mutant vector, promoting exploration of new solutions. Conversely, a low crossover rate results in more components being taken from the target vector, which can help maintain existing solutions and refine them. The typical range for CR is between 0.0 and 1.0. Default is 0.9.</td></tr>
<tr><td><code><font color=#b9b96e>-debug</font></code></td><td>Print debug messages during optimization.</td></tr>
<tr><td><code><font color=#b9b96e>-f</font></code></td><td>Weight factor (mutation rate). Controls the amplification of the differential variation between individuals. It is a scaling factor applied to the difference between two randomly selected population vectors before adding the result to a third vector to create a mutant vector (exact mechanism is dependent on selected strategy). The mutation rate influences the algorithm's ability to explore the search space; a higher value of <code>f</code> increases the diversity of the mutant vectors, leading to broader exploration, while a lower value encourages convergence by making smaller adjustments. The typical range for <code>f</code> is between 0.4 and 1.0, though values outside this range can be used depending on the problem characteristics. Default is 0.9.</td></tr>
<tr><td><code><font color=#b9b96e>-funct</font></code></td><td>Name of the procedure that should be minimized.</td></tr>
<tr><td><code><font color=#b9b96e>-genmax</font></code></td><td>Maximum number of generations. Controls termination of optimization. Default 3000.</td></tr>
<tr><td><code><font color=#b9b96e>-initpop</font></code></td><td>List of lists (matrix) with size np x d, requires <code><font color=#b9b96e>-specified</font></code>.</td></tr>
<tr><td><code><font color=#b9b96e>-np</font></code></td><td>Population size. Represents number of random parameter vector per generation. As a first guess for the value it is recommended to set it from 5 to 10 times the number of parameters. Default is 20.</td></tr>
<tr><td><code><font color=#b9b96e>-pdata</font></code></td><td>List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification.</td></tr>
<tr><td><code><font color=#b9b96e>-random</font></code></td><td>Select population initialization with random values over the individual parameters ranges.</td></tr>
<tr><td><code><font color=#b9b96e>-refresh</font></code></td><td>Output refresh cycle. Represent the frequency of printing debug information to stdout.</td></tr>
<tr><td><code><font color=#b9b96e>-reltol</font></code></td><td>Relative tolerance. Controls termination of optimization. Default 1e-2.</td></tr>
<tr><td><code><font color=#b9b96e>-seed</font></code></td><td>Random seed.</td></tr>
<tr><td><code><font color=#b9b96e>-specified</font></code></td><td>Select population initialization with specified population values, requires <code><font color=#b9b96e>-initpop</font></code>.</td></tr>
<tr><td><code><font color=#b9b96e>-strategy</font></code></td><td>Choice of strategy. Possible strategies: best/1/exp rand/1/exp rand-to-best/1/exp best/2/exp rand/2/exp best/1/bin rand/1/bin rand-to-best/1/bin best/2/bin rand/2/bin.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Class implements the Differential Evolution (DE) algorithm to solve global optimization problems over continuous parameter spaces. Typically, it is used to minimize a user-supplied objective function by evolving a population of candidate solutions through mutation, crossover, and selection.</p>
<p class='ruff'>Differential Evolution is a stochastic, population-based optimizer that works well for non-linear, non-differentiable, and multi-modal objective functions. It does not require gradient information and is effective in high-dimensional or rugged search spaces. The user-supplied objective function should take a vector of parameters as input and return a scalar value to be minimized. For example, the objective function might compute the volume of material used in a structure given its geometric parameters, the error rate of a machine learning model, or the energy of a physical system. DE begins by initializing a population of random candidate solutions within given parameter bounds and iteratively refines them by combining members of the population and selecting better solutions over generations.</p>
<p class='ruff'>Simple constraints are placed on parameter values by adding objects of class <a href="index-tclopt.html#::tclopt::Parameter" title="::tclopt::Parameter" class='ruff_cmd'>::tclopt::Parameter</a> to DE with method <a href="index-tclopt.html#::tclopt::DE::addPars" title="addPars" class='ruff_cmd'>addPars</a>.  For details of how to specify constraints, please look at the description of <a href="index-tclopt.html#::tclopt::Parameter" title="::tclopt::Parameter" class='ruff_cmd'>::tclopt::Parameter</a> class. Please note, that order in which we attach parameters objects is the order in which values will be supplied to minimized function, and the order in which resulted will be written to X property of the class.</p>
<h3 class='ruff'><a name='::tclopt::DE-General advices'></a>General advices<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>1)  <code>f</code> is usually between 0.5 and 1 (in rare cases &gt; 1) 2)  <code>cr</code> is between 0 and 1 with 0., 0.3, 0.7 and 1. being worth to be tried first 3)  To start off <code>np = 10*d</code> is a reasonable choice. Increase NP if misconvergence happens. 4)  If you increase <code>np</code>, <code>f</code> usually has to be decreased 5)  When the <code>DE/best</code>... schemes fail <code>DE/rand</code>... usually works and vice versa</p>
<h3 class='ruff'><a name='::tclopt::DE-Strategies overview'></a>Strategies overview<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Naming convention for strategies: x/y/z, where:</p>
<ul class='ruff'>
<li>x - a string which denotes the vector to be perturbed (mutated)</li>
<li>y - number of difference vectors taken for perturbation (mutation) of x</li>
<li>z - crossover method (exp = exponential, bin = binomial)</li>
</ul>
<h4 class='ruff'><a name='::tclopt::DE-Mutation'></a>Mutation<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Combination of x and y gives following mutation function:</p>
<p class='ruff'>best/1: <img src="assets/image.svg" alt="drawing" width="300"/></p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'> →    →         →     →
 u  = x  + f ⋅ ⎛x   - x  ⎞
  i    b       ⎝ r2    r3⎠
</pre>

</figure><p class='ruff'>rand/1:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'> →    →         →     →
 u  = x  + f ⋅ ⎛x   - x  ⎞
  i    r1      ⎝ r2    r3⎠
</pre>

</figure><p class='ruff'>rand-to-best/1 (custom variant):</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'> →    →         →     →           →     →
 u  = x  + f ⋅ ⎛x   - x  ⎞ + f ⋅ ⎛x   - x  ⎞
  i    i       ⎝ b     i ⎠       ⎝ r1    r2⎠
</pre>

</figure><p class='ruff'>best/2:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'> →    →         →     →     →     →
 u  = x  + f ⋅ ⎛x   + x   - x   - x  ⎞
  i    b       ⎝ r1    r2    r3    r4⎠
</pre>

</figure><p class='ruff'>rand/2:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'> →    →         →     →     →     →
 u  = x  + f ⋅ ⎛x   + x   - x   - x  ⎞
  i    r5      ⎝ r1    r2    r3    r4⎠
</pre>

</figure><p class='ruff'>x_i - trial vector, x_b - best vector, x_rn - randomly selected individuals from population.</p>
<p class='ruff'>A crossover operation between the new generated mutant vector v_i and the target vector x_i is used to further increase the diversity of the new candidate solution.</p>
<h4 class='ruff'><a name='::tclopt::DE-Exponential crossover'></a>Exponential crossover<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>In exponential crossover, a contiguous block of dimensions is modified, starting from a random index, and continues as long as random values are less than CR. The mutation happens inline during crossover, and wrapping around is supported.</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'>Example (D = 10, n = 3, L = 4):

Parent x_i:         [x0 x1 x2 x3 x4 x5 x6 x7 x8 x9]
Exponential mask:             →  →  →  →
                             n  n+1 n+2 n+3

Trial u_i:          [x0 x1 x2 v3 v4 v5 v6 x7 x8 x9]
                            ↑ mutated from DE strategy
</pre>

</figure><ul class='ruff'>
<li>Starts from a random index n ∈ [0, D)</li>
<li>Replaces a contiguous block of components (dimension-wise)</li>
<li>Continues as long as rand() &lt; CR, up to D components</li>
<li>Mutation and crossover are applied together in the code, not as separate stages.</li>
</ul>
<h4 class='ruff'><a name='::tclopt::DE-Binomial crossover'></a>Binomial crossover<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>In binomial crossover, each dimension has an independent probability CR of being replaced by the mutant vector. At least one dimension is guaranteed to be copied from the mutant (typically by forcing one fixed index to be included).</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'>Example (D = 10):

Parent x_i:         [x0 x1 x2 x3 x4 x5 x6 x7 x8 x9]
Random mask:         ✗  ✓  ✗  ✗  ✓  ✗  ✓  ✗  ✗  ✓
Mutant values:      [v0 v1 v2 v3 v4 v5 v6 v7 v8 v9]

Trial u_i:          [x0 v1 x2 x3 v4 x5 v6 x7 x8 v9]
                         ↑       ↑       ↑     ↑
                   replaced where rand() &lt; CR
</pre>

</figure><ul class='ruff'>
<li>Applies independent crossover decision for each dimension</li>
<li>Starts at a random dimension n, iterates D steps circularly</li>
<li>Each dimension is replaced with probability CR</li>
<li>Ensures at least one dimension is modified (usually last)</li>
<li>Mutation and crossover are applied together in the code, not as separate stages.</li>
</ul>
<h4 class='ruff'><a name='::tclopt::DE-Summary of strategies'></a>Summary of strategies<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'>+----+----------+-----------------------------+-----+----------------------------------+
| ID |  Base    | Difference                  | XOV | Description                      |
+----+----------+-----------------------------+-----+----------------------------------+
| 1  | best     | r2 - r3                     | exp | Exploitative, may misconv        |
| 2  | r1       | r2 - r3                     | exp | Balanced, exploratory            |
|    |          |                             |     | Try e.g. F=0.7 and CR=0.5 first  |
| 3  | x_i      | (best - x_i) + (r1 - r2)    | exp | Hybrid: pull + variation         |
|    |          |                             |     | Try e.g  F=0.85 and CR=1 first   |
| 4  | best     | (r1 + r2) - (r3 + r4)       | exp | Exploratory, best-guided         |
| 5  | r5       | (r1 + r2) - (r3 + r4)       | exp | Fully random, robust             |
| 6  | best     | r2 - r3                     | bin | Same as 1, binomial crossover    |
| 7  | r1       | r2 - r3                     | bin | Same as 2, binomial crossover    |
| 8  | x_i      | (best - x_i) + (r1 - r2)    | bin | Same as 3, binomial crossover    |
| 9  | best     | (r1 + r2) - (r3 + r4)       | bin | Same as 4, binomial crossover    |
| 10 | r5       | (r1 + r2) - (r3 + r4)       | bin | Same as 5, binomial crossover    |
+----+----------+-----------------------------+-----+----------------------------------+
</pre>

</figure><p class='ruff'>See more information in <a href="http://mirror.krakadikt.com/2004-11-13-genetic-algorithms/www.icsi.berkeley.edu/%257Estorn/deshort1.ps" >techreport</a></p>
<p class='ruff'>Description of keys and data in returned dictionary:</p>
<table class='ruff_deflist'>
<tr><td>-objfunc</td><td>Final value of object (cost) function <code>funct</code></td></tr>
<tr><td>-x</td><td>Final vector of parameters.</td></tr>
<tr><td>-generation</td><td>Number of generations.</td></tr>
<tr><td>-strategy</td><td>Strategy used for optimization.</td></tr>
<tr><td>-std</td><td>Standard deviation of final population.</td></tr>
</table>
<p class='ruff'>You can also access all results by [my configure -propertyName] mechanism.</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>object of class</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DE_constructor' href="javascript:toggleSource('tclopt_DE_constructor')">Show source</a></p>
<div id='tclopt_DE_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <i><font color=#76a396># Creates optimization object that tuns optimization using modified Differential Evolution algorithm.</font></i>
    <i><font color=#76a396>#  -funct - name of the procedure that should be minimized</font></i>
    <i><font color=#76a396>#  -strategy - choice of strategy. Possible strategies: best/1/exp rand/1/exp rand-to-best/1/exp best/2/exp</font></i>
    <i><font color=#76a396>#    rand/2/exp best/1/bin rand/1/bin rand-to-best/1/bin best/2/bin rand/2/bin.</font></i>
    <i><font color=#76a396>#  -pdata - list or dictionary that provides private data to funct that is needed to evaluate residuals. Usually</font></i>
    <i><font color=#76a396>#    it contains x and y values lists, but you can provide any data necessary for function residuals evaluation.</font></i>
    <i><font color=#76a396>#    Will be passed upon each function evaluation without modification.</font></i>
    <i><font color=#76a396>#  -genmax - maximum number of generations. Controls termination of optimization. Default 3000.</font></i>
    <i><font color=#76a396>#  -refresh - output refresh cycle. Represent the frequency of printing debug information to stdout.</font></i>
    <i><font color=#76a396>#  -np - population size. Represents number of random parameter vector per generation. As a first guess for the</font></i>
    <i><font color=#76a396>#    value it is recommended to set it from 5 to 10 times the number of parameters. Default is 20.</font></i>
    <i><font color=#76a396>#  -f - weight factor (mutation rate). Controls the amplification of the differential variation between</font></i>
    <i><font color=#76a396>#    individuals. It is a scaling factor applied to the difference between two randomly selected population</font></i>
    <i><font color=#76a396>#    vectors before adding the result to a third vector to create a mutant vector (exact mechanism is dependent</font></i>
    <i><font color=#76a396>#    on selected strategy). The mutation rate influences the algorithm's ability to explore the search space; a</font></i>
    <i><font color=#76a396>#    higher value of `f` increases the diversity of the mutant vectors, leading to broader exploration, while a</font></i>
    <i><font color=#76a396>#    lower value encourages convergence by making smaller adjustments. The typical range for `f` is between 0.4</font></i>
    <i><font color=#76a396>#    and 1.0, though values outside this range can be used depending on the problem characteristics. Default is</font></i>
    <i><font color=#76a396>#    0.9.</font></i>
    <i><font color=#76a396>#  -cr - crossing over factor (crossover rate). Controls the probability of mixing components from the target</font></i>
    <i><font color=#76a396>#    vector and the mutant vector to form a trial vector. It determines how much of the trial vector inherits</font></i>
    <i><font color=#76a396>#    its components from the mutant vector versus the target vector. A high crossover rate means that more</font></i>
    <i><font color=#76a396>#    components will come from the mutant vector, promoting exploration of new solutions. Conversely, a low</font></i>
    <i><font color=#76a396>#    crossover rate results in more components being taken from the target vector, which can help maintain</font></i>
    <i><font color=#76a396>#    existing solutions and refine them. The typical range for CR is between 0.0 and 1.0. Default is 0.9.</font></i>
    <i><font color=#76a396>#  -seed - random seed.</font></i>
    <i><font color=#76a396>#  -abstol - absolute tolerance. Controls termination of optimization. Default 1e-6.</font></i>
    <i><font color=#76a396>#  -reltol - relative tolerance. Controls termination of optimization. Default 1e-2.</font></i>
    <i><font color=#76a396>#  -debug - print debug messages during optimization.</font></i>
    <i><font color=#76a396>#  -random - select population initialization with random values over the individual parameters ranges.</font></i>
    <i><font color=#76a396>#  -specified - select population initialization with specified population values, requires `-initpop`.</font></i>
    <i><font color=#76a396>#  -initpop - list of lists (matrix) with size np x d, requires `-specified`.</font></i>
    <i><font color=#76a396># Returns: object of class</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Class implements the Differential Evolution (DE) algorithm to solve global optimization problems over</font></i>
    <i><font color=#76a396># continuous parameter spaces. Typically, it is used to minimize a user-supplied objective function by evolving</font></i>
    <i><font color=#76a396># a population of candidate solutions through mutation, crossover, and selection.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Differential Evolution is a stochastic, population-based optimizer that works well for non-linear,</font></i>
    <i><font color=#76a396># non-differentiable, and multi-modal objective functions. It does not require gradient information and is</font></i>
    <i><font color=#76a396># effective in high-dimensional or rugged search spaces. The user-supplied objective function should take a</font></i>
    <i><font color=#76a396># vector of parameters as input and return a scalar value to be minimized. For example, the objective function</font></i>
    <i><font color=#76a396># might compute the volume of material used in a structure given its geometric parameters, the error rate of a</font></i>
    <i><font color=#76a396># machine learning model, or the energy of a physical system. DE begins by initializing a population of random</font></i>
    <i><font color=#76a396># candidate solutions within given parameter bounds and iteratively refines them by combining members of the</font></i>
    <i><font color=#76a396># population and selecting better solutions over generations.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Simple constraints are placed on parameter values by adding objects of class [::tclopt::Parameter] to DE with</font></i>
    <i><font color=#76a396># method [::tclopt::DE::addPars].  For details of how to specify constraints, please look at the description of</font></i>
    <i><font color=#76a396># [::tclopt::Parameter] class. Please note, that order in which we attach parameters objects is the order in</font></i>
    <i><font color=#76a396># which values will be supplied to minimized function, and the order in which resulted will be written to X</font></i>
    <i><font color=#76a396># property of the class.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># ### General advices</font></i>
    <i><font color=#76a396># 1)  `f` is usually between 0.5 and 1 (in rare cases &gt; 1)</font></i>
    <i><font color=#76a396># 2)  `cr` is between 0 and 1 with 0., 0.3, 0.7 and 1. being worth to be tried first</font></i>
    <i><font color=#76a396># 3)  To start off `np = 10*d` is a reasonable choice. Increase NP if misconvergence happens.</font></i>
    <i><font color=#76a396># 4)  If you increase `np`, `f` usually has to be decreased</font></i>
    <i><font color=#76a396># 5)  When the `DE/best`... schemes fail `DE/rand`... usually works and vice versa</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># ### Strategies overview</font></i>
    <i><font color=#76a396># Naming convention for strategies: x/y/z, where:</font></i>
    <i><font color=#76a396>#  - x - a string which denotes the vector to be perturbed (mutated)</font></i>
    <i><font color=#76a396>#  - y - number of difference vectors taken for perturbation (mutation) of x</font></i>
    <i><font color=#76a396>#  - z - crossover method (exp = exponential, bin = binomial)</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># #### Mutation</font></i>
    <i><font color=#76a396># Combination of x and y gives following mutation function:</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># best/1:</font></i>
    <i><font color=#76a396># &lt;img src=&quot;assets/image.svg&quot; alt=&quot;drawing&quot; width=&quot;300&quot;/&gt;</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#  →    →         →     →</font></i>
    <i><font color=#76a396>#  u  = x  + f ⋅ ⎛x   - x  ⎞</font></i>
    <i><font color=#76a396>#   i    b       ⎝ r2    r3⎠</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># rand/1:</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#  →    →         →     →</font></i>
    <i><font color=#76a396>#  u  = x  + f ⋅ ⎛x   - x  ⎞</font></i>
    <i><font color=#76a396>#   i    r1      ⎝ r2    r3⎠</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># rand-to-best/1 (custom variant):</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#  →    →         →     →           →     →</font></i>
    <i><font color=#76a396>#  u  = x  + f ⋅ ⎛x   - x  ⎞ + f ⋅ ⎛x   - x  ⎞</font></i>
    <i><font color=#76a396>#   i    i       ⎝ b     i ⎠       ⎝ r1    r2⎠</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># best/2:</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#  →    →         →     →     →     →</font></i>
    <i><font color=#76a396>#  u  = x  + f ⋅ ⎛x   + x   - x   - x  ⎞</font></i>
    <i><font color=#76a396>#   i    b       ⎝ r1    r2    r3    r4⎠</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># rand/2:</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#  →    →         →     →     →     →</font></i>
    <i><font color=#76a396>#  u  = x  + f ⋅ ⎛x   + x   - x   - x  ⎞</font></i>
    <i><font color=#76a396>#   i    r5      ⎝ r1    r2    r3    r4⎠</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># x_i \- trial vector, x_b - best vector, x_rn - randomly selected individuals from population.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># A crossover operation between the new generated mutant vector v_i and the target vector x_i is used to further</font></i>
    <i><font color=#76a396># increase the diversity of the new candidate solution.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># #### Exponential crossover</font></i>
    <i><font color=#76a396># In exponential crossover, a contiguous block of dimensions is modified, starting from a random index, and</font></i>
    <i><font color=#76a396># continues as long as random values are less than CR. The mutation happens inline during crossover, and</font></i>
    <i><font color=#76a396># wrapping around is supported.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#Example (D = 10, n = 3, L = 4):</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#Parent x_i:         [x0 x1 x2 x3 x4 x5 x6 x7 x8 x9]</font></i>
    <i><font color=#76a396>#Exponential mask:             →  →  →  →</font></i>
    <i><font color=#76a396>#                              n  n+1 n+2 n+3</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#Trial u_i:          [x0 x1 x2 v3 v4 v5 v6 x7 x8 x9]</font></i>
    <i><font color=#76a396>#                             ↑ mutated from DE strategy</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># - Starts from a random index n ∈ \[0, D)</font></i>
    <i><font color=#76a396># - Replaces a contiguous block of components (dimension-wise)</font></i>
    <i><font color=#76a396># - Continues as long as rand() &lt; CR, up to D components</font></i>
    <i><font color=#76a396># - Mutation and crossover are applied together in the code, not as separate stages.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># #### Binomial crossover</font></i>
    <i><font color=#76a396># In binomial crossover, each dimension has an independent probability CR of being replaced by the mutant</font></i>
    <i><font color=#76a396># vector. At least one dimension is guaranteed to be copied from the mutant (typically by forcing one fixed</font></i>
    <i><font color=#76a396># index to be included).</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#Example (D = 10):</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#Parent x_i:         [x0 x1 x2 x3 x4 x5 x6 x7 x8 x9]</font></i>
    <i><font color=#76a396>#Random mask:         ✗  ✓  ✗  ✗  ✓  ✗  ✓  ✗  ✗  ✓</font></i>
    <i><font color=#76a396>#Mutant values:      [v0 v1 v2 v3 v4 v5 v6 v7 v8 v9]</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396>#Trial u_i:          [x0 v1 x2 x3 v4 x5 v6 x7 x8 v9]</font></i>
    <i><font color=#76a396>#                          ↑       ↑       ↑     ↑</font></i>
    <i><font color=#76a396>#                    replaced where rand() &lt; CR</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># - Applies independent crossover decision for each dimension</font></i>
    <i><font color=#76a396># - Starts at a random dimension n, iterates D steps circularly</font></i>
    <i><font color=#76a396># - Each dimension is replaced with probability CR</font></i>
    <i><font color=#76a396># - Ensures at least one dimension is modified (usually last)</font></i>
    <i><font color=#76a396># - Mutation and crossover are applied together in the code, not as separate stages.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># #### Summary of strategies</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396># +----+----------+-----------------------------+-----+----------------------------------+</font></i>
    <i><font color=#76a396># | ID |  Base    | Difference                  | XOV | Description                      |</font></i>
    <i><font color=#76a396># +----+----------+-----------------------------+-----+----------------------------------+</font></i>
    <i><font color=#76a396># | 1  | best     | r2 - r3                     | exp | Exploitative, may misconv        |</font></i>
    <i><font color=#76a396># | 2  | r1       | r2 - r3                     | exp | Balanced, exploratory            |</font></i>
    <i><font color=#76a396># |    |          |                             |     | Try e.g. F=0.7 and CR=0.5 first  |</font></i>
    <i><font color=#76a396># | 3  | x_i      | (best - x_i) + (r1 - r2)    | exp | Hybrid: pull + variation         |</font></i>
    <i><font color=#76a396># |    |          |                             |     | Try e.g  F=0.85 and CR=1 first   |</font></i>
    <i><font color=#76a396># | 4  | best     | (r1 + r2) - (r3 + r4)       | exp | Exploratory, best-guided         |</font></i>
    <i><font color=#76a396># | 5  | r5       | (r1 + r2) - (r3 + r4)       | exp | Fully random, robust             |</font></i>
    <i><font color=#76a396># | 6  | best     | r2 - r3                     | bin | Same as 1, binomial crossover    |</font></i>
    <i><font color=#76a396># | 7  | r1       | r2 - r3                     | bin | Same as 2, binomial crossover    |</font></i>
    <i><font color=#76a396># | 8  | x_i      | (best - x_i) + (r1 - r2)    | bin | Same as 3, binomial crossover    |</font></i>
    <i><font color=#76a396># | 9  | best     | (r1 + r2) - (r3 + r4)       | bin | Same as 4, binomial crossover    |</font></i>
    <i><font color=#76a396># | 10 | r5       | (r1 + r2) - (r3 + r4)       | bin | Same as 5, binomial crossover    |</font></i>
    <i><font color=#76a396># +----+----------+-----------------------------+-----+----------------------------------+</font></i>
    <i><font color=#76a396>#```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># See more information in [techreport](http://mirror.krakadikt.com/2004-11-13-genetic-algorithms/www.icsi.berkeley.edu/%257Estorn/deshort1.ps)</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Description of keys and data in returned dictionary:</font></i>
    <i><font color=#76a396>#   -objfunc - final value of object (cost) function `funct`</font></i>
    <i><font color=#76a396>#   -x - final vector of parameters</font></i>
    <i><font color=#76a396>#   -generation - number of generations</font></i>
    <i><font color=#76a396>#   -strategy - strategy used for optimization</font></i>
    <i><font color=#76a396>#   -std - standard deviation of final population</font></i>
    <i><font color=#76a396># You can also access all results by \[my configure -propertyName\] mechanism.</font></i>
    <i><font color=#76a396># Synopsis: -funct value -strategy value -pdata value ?-genmax value? ?-refresh value? ?-np value?</font></i>
    <i><font color=#76a396>#   ?-f value? ?-cr value? ?-seed value? ?-abstol value? ?-reltol value? ?-debug?</font></i>
    <i><font color=#76a396>#   ?-random|specified -initpop value?</font></i>
    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-help</font> {Creates optimization object that does Differential Evolution optimization. For more detailed description please see documentation} {
        {<font color=#b9b96e>-funct</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Name of the procedure that should be minimized}}
        {<font color=#b9b96e>-strategy</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Choice of strategy}}
        {<font color=#b9b96e>-pdata</font>= <font color=#b9b96e>-default</font> {} <font color=#b9b96e>-help</font> {List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification}}
        {<font color=#b9b96e>-genmax</font>= <font color=#b9b96e>-default</font> 3000 <font color=#b9b96e>-help</font> {Maximum number of generations}}
        {<font color=#b9b96e>-refresh</font>= <font color=#b9b96e>-default</font> 100 <font color=#b9b96e>-help</font> {Output refresh cycle}}
        {<font color=#b9b96e>-np</font>= <font color=#b9b96e>-default</font> 20 <font color=#b9b96e>-help</font> {Population size}}
        {<font color=#b9b96e>-f</font>= <font color=#b9b96e>-default</font> 0.9 <font color=#b9b96e>-help</font> {Weight factor (mutation rate)}}
        {<font color=#b9b96e>-cr</font>= <font color=#b9b96e>-default</font> 0.9 <font color=#b9b96e>-help</font> {Crossing over factor (crossover rate)}}
        {<font color=#b9b96e>-seed</font>= <font color=#b9b96e>-default</font> 1 <font color=#b9b96e>-help</font> {Random seed}}
        {<font color=#b9b96e>-abstol</font>= <font color=#b9b96e>-default</font> 1e-6 <font color=#b9b96e>-help</font> {Absolute tolerance}}
        {<font color=#b9b96e>-reltol</font>= <font color=#b9b96e>-default</font> 0.01 <font color=#b9b96e>-help</font> {Relative tolerance}}
        {<font color=#b9b96e>-debug</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Print debug information}}
        {<font color=#b9b96e>-random</font> <font color=#b9b96e>-key</font> initype <font color=#b9b96e>-default</font> random <font color=#b9b96e>-help</font> {Random population initialization}}
        {<font color=#b9b96e>-specified</font> <font color=#b9b96e>-key</font> initype <font color=#b9b96e>-value</font> specified <font color=#b9b96e>-help</font> {Specified points population initialization}}
        {<font color=#b9b96e>-initpop</font>= <font color=#b9b96e>-require</font> specified <font color=#b9b96e>-reciprocal</font> <font color=#b9b96e>-help</font> {Specified initial population}}
    }]
    <b><font color=#ffa500>dict</font></b> for {elName elValue} <font color=#f1b479>$arguments</font> {
        <b><font color=#fe6efe>my</font></b> configure -<font color=#f1b479>$elName</font> <font color=#f1b479>$elValue</font>
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::DE::addPars'>addPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DE" title="::tclopt::DE" class='ruff_cmd'>::tclopt::DE</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT addPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DE_addPars' href="javascript:toggleSource('tclopt_DE_addPars')">Show source</a></p>
<div id='tclopt_DE_addPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> addPars {args} {

    argparse <font color=#b9b96e>-help</font> {Attaches parameters to optimizer object} {
        {params <font color=#b9b96e>-catchall</font> <font color=#b9b96e>-help</font> {References to objects of class '::tclopt::Parameter'}}
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> argClass [<b><font color=#ffa500>info</font></b> object class <font color=#f1b479>$arg</font>]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$argClass</font> ne {::tclopt::Parameter}} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Only ::tclopt::Parameter could be added to optimizer, '<font color=#f1b479>$</font>argClass' was provided&quot;</font>
        }
        <b><font color=#ffa500>lappend</font></b> parsNamesList [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#ffa500>lappend</font></b> parsNamesList {<b><font color=#ffa500>*</font></b>}[<b><font color=#fe6efe>my</font></b> getAllParsNames]
    }
    <b><font color=#ffa500>set</font></b> dup [<b><font color=#fe6efe>my</font></b> duplListCheck <font color=#f1b479>$parsNamesList</font>]
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dup</font> ne {}} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Optimizer already contains parameter with name '<font color=#f1b479>$</font>dup'&quot;</font>
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> parName [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
        <b><font color=#ffa500>dict</font></b> append Pars <font color=#f1b479>$parName</font> <font color=#f1b479>$arg</font>
    }
    <b><font color=#fe6efe>return</font></b>
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::DE::getAllPars'>getAllPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DE" title="::tclopt::DE" class='ruff_cmd'>::tclopt::DE</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets references of all parameters objects.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DE_getAllPars' href="javascript:toggleSource('tclopt_DE_getAllPars')">Show source</a></p>
<div id='tclopt_DE_getAllPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllPars {args} {

    <i><font color=#76a396># Gets references of all parameters objects.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets references of all parameters objects. Returns: list of references} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$Pars</font>
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::DE::getAllParsNames'>getAllParsNames</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DE" title="::tclopt::DE" class='ruff_cmd'>::tclopt::DE</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets names of all parameters.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllParsNames</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DE_getAllParsNames' href="javascript:toggleSource('tclopt_DE_getAllParsNames')">Show source</a></p>
<div id='tclopt_DE_getAllParsNames' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllParsNames {args} {

    <i><font color=#76a396># Gets names of all parameters.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets names of all parameters. Returns: list of elements names} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [dkeys <font color=#f1b479>$Pars</font>]
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::DE::run'>run</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DE" title="::tclopt::DE" class='ruff_cmd'>::tclopt::DE</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Runs optimization.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT run</span> </div>
<h5 class='ruff'>Description</h5><h2 class='ruff'><a name='::tclopt::DE-Initialize random number generator'></a>Initialize random number generator<span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DE'>DE</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h2>
<div style='clear:both;'></div>
<h5 class='ruff'>Return value</h5><p class='ruff'>dictionary containing resulted data</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DE_run' href="javascript:toggleSource('tclopt_DE_run')">Show source</a></p>
<div id='tclopt_DE_run' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> run {} {

            <i><font color=#76a396># Runs optimization.</font></i>
            <i><font color=#76a396># Returns: dictionary containing resulted data</font></i>
    <i><font color=#76a396>### Initialize random number generator</font></i>
            ::tclopt::NewIntps idum
            ::tclopt::intp_assign <font color=#f1b479>$idum</font> [= {-<font color=#f1b479>$seed</font>}]
            <b><font color=#ffa500>set</font></b> nfeval 0 ;<i><font color=#76a396># reset number of function evaluations</font></i>
    <i><font color=#76a396>### Initialization</font></i>
            <b><font color=#ffa500>set</font></b> pars [dvalues [<b><font color=#fe6efe>my</font></b> getAllPars]]
            <b><font color=#ffa500>set</font></b> d [<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$pars</font>]
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>lappend</font></b> lowlims [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
                <b><font color=#ffa500>lappend</font></b> uplims [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$initype</font> eq {specified}} {
                <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$initpop</font>]!=<font color=#f1b479>$np</font>} {
                    <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Number of specified initial parameters populations should be equal to populations size '<font color=#f1b479>$</font>np' but '<font color=#f1b479>[</font>llength <font color=#f1b479>$</font>initpop<font color=#f1b479>]</font>' was provided&quot;</font>
                } <b><font color=#ffa500>else</font></b> {
                    <b><font color=#ffa500>foreach</font></b> paramSet <font color=#f1b479>$initpop</font> {
                        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$paramSet</font>]!=<font color=#f1b479>$d</font>} {
                            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Number of specified initial  parameters per population should be equal to number of parameters '<font color=#f1b479>$</font>d' but '<font color=#f1b479>[</font>llength <font color=#f1b479>$</font>paramSet<font color=#f1b479>]</font>' was provided&quot;</font>
                        }
                    }
                }
            }
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> i} {
                <i><font color=#76a396># spread initial population members</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> <font color=#f1b479>$j</font>]
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$initype</font> eq {specified}} {
                        <b><font color=#ffa500>set</font></b> value [@ <font color=#f1b479>$initpop</font> <font color=#f1b479>$i</font> <font color=#f1b479>$j</font>]
                        <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$value</font>&lt;[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]) || (<font color=#f1b479>$value</font>&gt;[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>])} {
                            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Value '<font color=#f1b479>$</font>value' from specified initial population is outside provided lower '<font color=#f1b479>[$</font>par configure -lowlim<font color=#f1b479>]</font>' or upper limit '<font color=#f1b479>$</font>value&gt;<font color=#f1b479>[$</font>par configure -uplim<font color=#f1b479>]</font>' for parameter '<font color=#f1b479>[$</font>par configure -name<font color=#f1b479>]</font>'&quot;</font>
                        }
                        <b><font color=#ffa500>lappend</font></b> cj [@ <font color=#f1b479>$initpop</font> <font color=#f1b479>$i</font> <font color=#f1b479>$j</font>]
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$initype</font> eq {random}} {
                        <b><font color=#ffa500>lappend</font></b> cj [= {[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]+[::tclopt::rnd_uni <font color=#f1b479>$idum</font>]* ([<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]-[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>])}]
                    }
                }
                <b><font color=#ffa500>lappend</font></b> c <font color=#f1b479>$cj</font>
                <b><font color=#ffa500>lappend</font></b> cost [<font color=#f1b479>$funct</font> <font color=#f1b479>$cj</font> <font color=#f1b479>$pdata</font>]
                <b><font color=#ffa500>incr</font></b> nfeval
                <b><font color=#ffa500>unset</font></b> cj
            }
            <b><font color=#ffa500>set</font></b> cmin [@ <font color=#f1b479>$cost</font> 0]
            <b><font color=#ffa500>set</font></b> imin 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 1} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> i} {
                <b><font color=#ffa500>if</font></b> {[@ <font color=#f1b479>$cost</font> <font color=#f1b479>$i</font>]&lt;<font color=#f1b479>$cmin</font>} {
                    <b><font color=#ffa500>set</font></b> cmin [@ <font color=#f1b479>$cost</font> <font color=#f1b479>$i</font>]
                    <b><font color=#ffa500>set</font></b> imin <font color=#f1b479>$i</font>
                }
            }
            <b><font color=#ffa500>set</font></b> best [@ <font color=#f1b479>$c</font> <font color=#f1b479>$imin</font>] ;<i><font color=#76a396># save best member ever</font></i>
            <b><font color=#ffa500>set</font></b> bestit [@ <font color=#f1b479>$c</font> <font color=#f1b479>$imin</font>] ;<i><font color=#76a396># save best member of generation</font></i>
            <b><font color=#ffa500>set</font></b> pold <font color=#f1b479>$c</font>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> i} {
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lappend</font></b> pnewj 0.0
                }
                <b><font color=#ffa500>lappend</font></b> pnew <font color=#f1b479>$pnewj</font>
                <b><font color=#ffa500>unset</font></b> pnewj
            }
    <i><font color=#76a396>### Iteration loop</font></i>
            <b><font color=#ffa500>set</font></b> gen 0 ;<i><font color=#76a396># generation counter reset</font></i>
            <b><font color=#ffa500>while</font></b> {<font color=#f1b479>$gen</font>&lt;<font color=#f1b479>$genmax</font>} {
                <b><font color=#ffa500>incr</font></b> gen
                <b><font color=#ffa500>set</font></b> imin 0
    <i><font color=#76a396>####  Start of loop through ensemble</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    do {
                        <b><font color=#ffa500>set</font></b> r1 [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$np</font>)}]
    _                } <b><font color=#ffa500>while</font></b> {<font color=#f1b479>$r1</font>==<font color=#f1b479>$i</font>}
                    do {
                        <b><font color=#ffa500>set</font></b> r2 [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$np</font>)}]
                    } <b><font color=#ffa500>while</font></b> {(<font color=#f1b479>$r2</font>==<font color=#f1b479>$i</font>) || (<font color=#f1b479>$r2</font>==<font color=#f1b479>$r1</font>)}
                    do {
                        <b><font color=#ffa500>set</font></b> r3 [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$np</font>)}]
                    } <b><font color=#ffa500>while</font></b> {(<font color=#f1b479>$r3</font>==<font color=#f1b479>$i</font>) || (<font color=#f1b479>$r3</font>==<font color=#f1b479>$r1</font>) || (<font color=#f1b479>$r3</font>==<font color=#f1b479>$r2</font>)}
                    do {
                        <b><font color=#ffa500>set</font></b> r4 [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$np</font>)}]
                    } <b><font color=#ffa500>while</font></b> {(<font color=#f1b479>$r4</font>==<font color=#f1b479>$i</font>) || (<font color=#f1b479>$r4</font>==<font color=#f1b479>$r1</font>) || (<font color=#f1b479>$r4</font>==<font color=#f1b479>$r2</font>) || (<font color=#f1b479>$r4</font>==<font color=#f1b479>$r3</font>)}
                    do {
                        <b><font color=#ffa500>set</font></b> r5 [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$np</font>)}]
                    } <b><font color=#ffa500>while</font></b> {(<font color=#f1b479>$r5</font>==<font color=#f1b479>$i</font>) || (<font color=#f1b479>$r5</font>==<font color=#f1b479>$r1</font>) || (<font color=#f1b479>$r5</font>==<font color=#f1b479>$r2</font>) || (<font color=#f1b479>$r5</font>==<font color=#f1b479>$r3</font>) || (<font color=#f1b479>$r5</font>==<font color=#f1b479>$r4</font>)}
    <i><font color=#76a396>####  Choice of strategy</font></i>
    <i><font color=#76a396>#####   best/1/exp</font></i>
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$strategy</font> eq {best/1/exp}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        do {
                            <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>])}]
                            <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                            <b><font color=#ffa500>incr</font></b> l
                        } <b><font color=#ffa500>while</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) && (<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>)}
    <i><font color=#76a396>#####   rand/1/exp</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand/1/exp}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        do {
                            <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>])}]
                            <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                            <b><font color=#ffa500>incr</font></b> l
                        } <b><font color=#ffa500>while</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) && (<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>)}
    <i><font color=#76a396>#####   rand-to-best/1/exp</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand-to-best/1/exp}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        do {
                            <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$tmp</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$tmp</font> <font color=#f1b479>$n</font>])+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>])}]
                            <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                            <b><font color=#ffa500>incr</font></b> l
                        } <b><font color=#ffa500>while</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) && (<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>)}
    <i><font color=#76a396>#####   best/2/exp</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {best/2/exp}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        do {
                            <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]+([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r4</font> <font color=#f1b479>$n</font>])*<font color=#f1b479>$f</font>}]
                            <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                            <b><font color=#ffa500>incr</font></b> l
                        } <b><font color=#ffa500>while</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) && (<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>)}
    <i><font color=#76a396>#####   rand/2/exp</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand/2/exp}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        do {
                            <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r5</font> <font color=#f1b479>$n</font>]+([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r4</font> <font color=#f1b479>$n</font>])*<font color=#f1b479>$f</font>}]
                            <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                            <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                            <b><font color=#ffa500>incr</font></b> l
                        } <b><font color=#ffa500>while</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) && (<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>)}
    <i><font color=#76a396>#####   best/1/bin</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {best/1/bin}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        <i><font color=#76a396># perform D binomial trials</font></i>
                        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> l 0} {<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> l} {
                            <b><font color=#ffa500>if</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) || (<font color=#f1b479>$l</font>==(<font color=#f1b479>$d</font>-1))} {
                                <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>])}]
                                <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            }
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                        }
    <i><font color=#76a396>#####   rand/1/bin</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand/1/bin}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        <i><font color=#76a396># perform D binomial trials</font></i>
                        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> l 0} {<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> l} {
                            <b><font color=#ffa500>if</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) || (<font color=#f1b479>$l</font>==(<font color=#f1b479>$d</font>-1))} {
                                <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>])}]
                                <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            }
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                        }
    <i><font color=#76a396>#####   rand-to-best/1/bin</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand-to-best/1/bin}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        <i><font color=#76a396># perform D binomial trials</font></i>
                        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> l 0} {<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> l} {
                            <b><font color=#ffa500>if</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) || (<font color=#f1b479>$l</font>==(<font color=#f1b479>$d</font>-1))} {
                                <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$tmp</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$tmp</font> <font color=#f1b479>$n</font>])+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>])}]
                                <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            }
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                        }
    <i><font color=#76a396>#####   best/2/bin</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {best/2/bin}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        <i><font color=#76a396># perform D binomial trials</font></i>
                        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> l 0} {<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> l} {
                            <b><font color=#ffa500>if</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) || (<font color=#f1b479>$l</font>==(<font color=#f1b479>$d</font>-1))} {
                                <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$bestit</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r4</font> <font color=#f1b479>$n</font>])*<font color=#f1b479>$f</font>}]
                                <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            }
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                        }
    <i><font color=#76a396>#####   rand/2/bin</font></i>
                    } <b><font color=#ffa500>elseif</font></b> {<font color=#f1b479>$strategy</font> eq {rand/2/bin}} {
                        <b><font color=#ffa500>set</font></b> tmp [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>]
                        <b><font color=#ffa500>set</font></b> n [= {int([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*<font color=#f1b479>$d</font>)}]
                        <b><font color=#ffa500>set</font></b> l 0
                        <i><font color=#76a396># perform D binomial trials</font></i>
                        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> l 0} {<font color=#f1b479>$l</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> l} {
                            <b><font color=#ffa500>if</font></b> {([::tclopt::rnd_uni <font color=#f1b479>$idum</font>]&lt;<font color=#f1b479>$cr</font>) || (<font color=#f1b479>$l</font>==(<font color=#f1b479>$d</font>-1))} {
                                <b><font color=#ffa500>set</font></b> tmpValue [= {[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r5</font> <font color=#f1b479>$n</font>]+<font color=#f1b479>$f</font>*([@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r1</font> <font color=#f1b479>$n</font>]+[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r2</font> <font color=#f1b479>$n</font>]-[@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r3</font> <font color=#f1b479>$n</font>]- [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$r4</font> <font color=#f1b479>$n</font>])*<font color=#f1b479>$f</font>}]
                                <b><font color=#ffa500>set</font></b> lowLim [@ <font color=#f1b479>$lowlims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>set</font></b> upLim [@ <font color=#f1b479>$uplims</font> <font color=#f1b479>$n</font>]
                                <b><font color=#ffa500>lset</font></b> tmp <font color=#f1b479>$n</font> [<b><font color=#fe6efe>my</font></b> ParamClamp <font color=#f1b479>$tmpValue</font> <font color=#f1b479>$lowLim</font> <font color=#f1b479>$upLim</font>]
                            }
                            <b><font color=#ffa500>set</font></b> n [= {(<font color=#f1b479>$n</font>+1)%<font color=#f1b479>$d</font>}]
                        }
                    }
    <i><font color=#76a396>####  Test how good this choice really was</font></i>
                    <b><font color=#ffa500>set</font></b> trial_cost [<font color=#f1b479>$funct</font> <font color=#f1b479>$tmp</font> <font color=#f1b479>$pdata</font>]
                    <b><font color=#ffa500>incr</font></b> nfeval
                    <i><font color=#76a396># improved objective function value ?</font></i>
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$trial_cost</font>&lt;=[@ <font color=#f1b479>$cost</font> <font color=#f1b479>$i</font>]} {
                        <b><font color=#ffa500>lset</font></b> cost <font color=#f1b479>$i</font> <font color=#f1b479>$trial_cost</font>
                        <b><font color=#ffa500>lset</font></b> pnew <font color=#f1b479>$i</font> <font color=#f1b479>$tmp</font>
                        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$trial_cost</font>&lt;<font color=#f1b479>$cmin</font>} {
                            <b><font color=#ffa500>set</font></b> cmin <font color=#f1b479>$trial_cost</font>
                            <b><font color=#ffa500>set</font></b> imin <font color=#f1b479>$i</font>
                            <b><font color=#ffa500>set</font></b> best <font color=#f1b479>$tmp</font>
                        }
                    } <b><font color=#ffa500>else</font></b> {
                        <b><font color=#ffa500>lset</font></b> pnew <font color=#f1b479>$i</font> [@ <font color=#f1b479>$pold</font> <font color=#f1b479>$i</font>] ;<i><font color=#76a396># replace target with old value</font></i>
                    }
                }
                <b><font color=#ffa500>set</font></b> bestit <font color=#f1b479>$best</font> ;<i><font color=#76a396># Save best population member of current iteration</font></i>
                <b><font color=#ffa500>set</font></b> pold <font color=#f1b479>$pnew</font>
    <i><font color=#76a396>### Compute the energy variance (just for monitoring purposes)</font></i>
                <b><font color=#ffa500>set</font></b> cmean 0.0 ;<i><font color=#76a396># compute the mean value first</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>set</font></b> cmean [= {<font color=#f1b479>$cmean</font>+[@ <font color=#f1b479>$cost</font> <font color=#f1b479>$j</font>]}]
                }
                <b><font color=#ffa500>set</font></b> cmean [= {<font color=#f1b479>$cmean</font>/<font color=#f1b479>$np</font>}]
                <b><font color=#ffa500>set</font></b> cvar 0.0 ;<i><font color=#76a396># compute the variance</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$np</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>set</font></b> cvar [= {<font color=#f1b479>$cvar</font>+([@ <font color=#f1b479>$cost</font> <font color=#f1b479>$j</font>]-<font color=#f1b479>$cmean</font>)*([@ <font color=#f1b479>$cost</font> <font color=#f1b479>$j</font>]-<font color=#f1b479>$cmean</font>)}]
                }
                <b><font color=#ffa500>set</font></b> stddev [= {sqrt(<font color=#f1b479>$cvar</font>/(<font color=#f1b479>$np</font>-1))}]
                <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$gen</font>%<font color=#f1b479>$refresh</font>==1) && <font color=#f1b479>$debug</font>} {
                    <b><font color=#ffa500>puts</font></b> [<b><font color=#ffa500>format</font></b> <font color=#90ee90>&quot;Best-so-far cost funct. value=%-15.10g&quot;</font> <font color=#f1b479>$cmin</font>]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$d</font>} {<b><font color=#ffa500>incr</font></b> j} {
                        <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> <font color=#f1b479>$j</font>]
                        <b><font color=#ffa500>puts</font></b> [<b><font color=#ffa500>format</font></b> <font color=#90ee90>&quot;Parameter %s=%-15.10g&quot;</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-name</font>] [@ <font color=#f1b479>$best</font> <font color=#f1b479>$j</font>]]
                    }
                    <b><font color=#ffa500>puts</font></b> [<b><font color=#ffa500>format</font></b> <font color=#90ee90>&quot;Generation=%d  NFEs=%ld   Strategy: %s&quot;</font> <font color=#f1b479>$gen</font> <font color=#f1b479>$nfeval</font> <font color=#f1b479>$strategy</font>]
                    <b><font color=#ffa500>puts</font></b> [<b><font color=#ffa500>format</font></b> <font color=#90ee90>&quot;NP=%d F=%-4.2g CR=%-4.2g std=%-10.5g&quot;</font> <font color=#f1b479>$np</font> <font color=#f1b479>$f</font> <font color=#f1b479>$cr</font> <font color=#f1b479>$stddev</font>]
                }
                <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$stddev</font> &lt;= [= {<font color=#f1b479>$abstol</font> + <font color=#f1b479>$reltol</font> * abs(<font color=#f1b479>$cmean</font>)}])} {
                    ::tclopt::DeleteIntps <font color=#f1b479>$idum</font>
                    <b><font color=#fe6efe>break</font></b>
                }
            }
            <b><font color=#ffa500>set</font></b> resDict [<b><font color=#ffa500>dcreate</font></b> objfunc <font color=#f1b479>$cmin</font> x <font color=#f1b479>$best</font> generation <font color=#f1b479>$gen</font> nfev <font color=#f1b479>$nfeval</font> strategy <font color=#f1b479>$strategy</font> std <font color=#f1b479>$stddev</font>]
            <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$resDict</font>
}</pre></div>
</div><h3 class='ruffclass'><a name='::tclopt::DuplChecker'>DuplChecker</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="duplListCheck" class='ruff_cmd'>duplListCheck</a></td><td>Checks if list contains duplicates.</td></tr>
</table>
<h5 class='ruff'>Subclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::Mpfit" title="Mpfit" class='ruff_cmd'>Mpfit</a>, <a href="index-tclopt.html#::tclopt::DE" title="DE" class='ruff_cmd'>DE</a>, <a href="index-tclopt.html#::tclopt::GSA" title="GSA" class='ruff_cmd'>GSA</a></p>
<h4 class='ruffmethod'><a name='::tclopt::DuplChecker::duplListCheck'>duplListCheck</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DuplChecker" title="::tclopt::DuplChecker" class='ruff_cmd'>::tclopt::DuplChecker</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DuplChecker'>DuplChecker</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if list contains duplicates.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT duplListCheck</span> <span class='ruff_arg'>list</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><b><font color=#ffa500>list</font></b></code></td><td>List to check.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>0 if there are no duplicates and 1 if there are.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DuplChecker_duplListCheck' href="javascript:toggleSource('tclopt_DuplChecker_duplListCheck')">Show source</a></p>
<div id='tclopt_DuplChecker_duplListCheck' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> duplListCheck {<b><font color=#ffa500>list</font></b>} {

    <i><font color=#76a396># Checks if list contains duplicates.</font></i>
    <i><font color=#76a396>#  list - list to check</font></i>
    <i><font color=#76a396># Returns: 0 if there are no duplicates and 1 if there are.</font></i>
    <b><font color=#ffa500>set</font></b> itemDup {}
    <b><font color=#ffa500>set</font></b> new {}
    <b><font color=#ffa500>foreach</font></b> item <font color=#f1b479>$list</font> {
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>lsearch</font></b> <font color=#f1b479>$new</font> <font color=#f1b479>$item</font>] &lt; 0} {
            <b><font color=#ffa500>lappend</font></b> new <font color=#f1b479>$item</font>
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> itemDup <font color=#f1b479>$item</font>
            <b><font color=#fe6efe>break</font></b>
        }
    }
    <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$itemDup</font>
}</pre></div>
</div><h3 class='ruffclass'><a name='::tclopt::GSA'>GSA</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::GSA::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::GSA::addPars" title="addPars" class='ruff_cmd'>addPars</a></td><td>Not documented.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><code>duplListCheck</code></td><td>See <a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="DuplChecker.duplListCheck" class='ruff_cmd'>DuplChecker.duplListCheck</a></td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::GSA::getAllPars" title="getAllPars" class='ruff_cmd'>getAllPars</a></td><td>Gets references of all parameters objects.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::GSA::getAllParsNames" title="getAllParsNames" class='ruff_cmd'>getAllParsNames</a></td><td>Gets names of all parameters.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::GSA::run" title="run" class='ruff_cmd'>run</a></td><td>Not documented.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-debug</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-initype</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxinniter</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-maxratio</font></code>, <code><font color=#b9b96e>-mininniter</font></code>, <code><font color=#b9b96e>-nbase</font></code>, <code><font color=#b9b96e>-ntrial</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-qa</font></code>, <code><font color=#b9b96e>-qv</font></code>, <code><font color=#b9b96e>-r</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-seed</font></code>, <code><font color=#b9b96e>-temp0</font></code>, <code><font color=#b9b96e>-threshold</font></code>, <code><font color=#b9b96e>-tmin</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-debug</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-initype</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxinniter</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-maxratio</font></code>, <code><font color=#b9b96e>-mininniter</font></code>, <code><font color=#b9b96e>-nbase</font></code>, <code><font color=#b9b96e>-ntrial</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-qa</font></code>, <code><font color=#b9b96e>-qv</font></code>, <code><font color=#b9b96e>-r</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-seed</font></code>, <code><font color=#b9b96e>-temp0</font></code>, <code><font color=#b9b96e>-threshold</font></code>, <code><font color=#b9b96e>-tmin</font></code></p>
<h5 class='ruff'>Mixins</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::DuplChecker" title="DuplChecker" class='ruff_cmd'>DuplChecker</a></p>
<h4 class='ruffmethod'><a name='::tclopt::GSA::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::GSA" title="::tclopt::GSA" class='ruff_cmd'>::tclopt::GSA</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>GSA create OBJNAME</span> <span class='ruff_arg'>?args?</span><br><span class='ruff_cmd'>GSA new</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_GSA_constructor' href="javascript:toggleSource('tclopt_GSA_constructor')">Show source</a></p>
<div id='tclopt_GSA_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-help</font> {Creates optimization object that does General annealing simulation optimization. For more detailed description please see documentation} {
        {<font color=#b9b96e>-funct</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Name of the procedure that should be minimized}}
        {<font color=#b9b96e>-pdata</font>= <font color=#b9b96e>-default</font> {} <font color=#b9b96e>-help</font> {List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification}}
        {<font color=#b9b96e>-maxiter</font>= <font color=#b9b96e>-default</font> 5000 <font color=#b9b96e>-help</font> {Maximum number of temperature steps}}
        {<font color=#b9b96e>-mininniter</font>= <font color=#b9b96e>-default</font> 10 <font color=#b9b96e>-help</font> {Minimum number of iterations per temperature}}
        {<font color=#b9b96e>-maxinniter</font>= <font color=#b9b96e>-default</font> 1000 <font color=#b9b96e>-help</font> {Maximum number of iterations per temperature}}
        {<font color=#b9b96e>-maxfev</font>= <font color=#b9b96e>-help</font> {Output refresh cycle}}
        {<font color=#b9b96e>-seed</font>= <font color=#b9b96e>-default</font> 0 <font color=#b9b96e>-help</font> {Random seed}}
        {<font color=#b9b96e>-ntrial</font>= <font color=#b9b96e>-default</font> 20 <font color=#b9b96e>-help</font> {Initial number of samples to determine initial temperature}}
        {<font color=#b9b96e>-nbase</font>= <font color=#b9b96e>-default</font> 30 <font color=#b9b96e>-help</font> {Base number of iterations within single temperature}}
        {<font color=#b9b96e>-qv</font>= <font color=#b9b96e>-default</font> 2.0 <font color=#b9b96e>-help</font> {Visiting distribution parameter}}
        {<font color=#b9b96e>-qa</font>= <font color=#b9b96e>-default</font> 1.5 <font color=#b9b96e>-help</font> {<b><font color=#ffa500>Parameter</font></b> defining shape of the acceptance probability distribution}}
        {<font color=#b9b96e>-tmin</font>= <font color=#b9b96e>-default</font> 1e-5 <font color=#b9b96e>-help</font> {Lowest temperature value}}
        {<font color=#b9b96e>-temp0</font>= <font color=#b9b96e>-help</font> {Initial temperature}}
        {<font color=#b9b96e>-debug</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Print debug information}}
        {<font color=#b9b96e>-threshold</font>= <font color=#b9b96e>-help</font> {Objective function threshold that stops optimization}}
        {<font color=#b9b96e>-r</font>= <font color=#b9b96e>-help</font> {Cooling constant ratio}}
        {<font color=#b9b96e>-maxratio</font>= <font color=#b9b96e>-default</font> 1e4 <font color=#b9b96e>-help</font> {Maximum ratio of temp0/tmin}}
        {<font color=#b9b96e>-random</font> <font color=#b9b96e>-key</font> initype <font color=#b9b96e>-default</font> random <font color=#b9b96e>-help</font> {Random parameter vector initialization}}
        {<font color=#b9b96e>-specified</font> <font color=#b9b96e>-key</font> initype <font color=#b9b96e>-value</font> specified <font color=#b9b96e>-help</font> {Specified points parameter vector initialization}}
    }]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dict</font></b> exists <font color=#f1b479>$arguments</font> r]} {
        <b><font color=#ffa500>set</font></b> r [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$arguments</font> r]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dict</font></b> exists <font color=#f1b479>$arguments</font> temp0]} {
        <b><font color=#ffa500>set</font></b> temp0 [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$arguments</font> temp0]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dict</font></b> exists <font color=#f1b479>$arguments</font> threshold]} {
        <b><font color=#ffa500>set</font></b> threshold [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$arguments</font> threshold]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dict</font></b> exists <font color=#f1b479>$arguments</font> maxfev]} {
        <b><font color=#ffa500>set</font></b> maxfev [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$arguments</font> maxfev]
    }
    <b><font color=#ffa500>dict</font></b> for {elName elValue} <font color=#f1b479>$arguments</font> {
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$elName</font> ni {r temp0 threshold maxfev}} {
            <b><font color=#fe6efe>my</font></b> configure -<font color=#f1b479>$elName</font> <font color=#f1b479>$elValue</font>
        }
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::GSA::addPars'>addPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::GSA" title="::tclopt::GSA" class='ruff_cmd'>::tclopt::GSA</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT addPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_GSA_addPars' href="javascript:toggleSource('tclopt_GSA_addPars')">Show source</a></p>
<div id='tclopt_GSA_addPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> addPars {args} {

    argparse <font color=#b9b96e>-help</font> {Attaches parameters to optimizer object} {
        {params <font color=#b9b96e>-catchall</font> <font color=#b9b96e>-help</font> {References to objects of class '::tclopt::Parameter'}}
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> argClass [<b><font color=#ffa500>info</font></b> object class <font color=#f1b479>$arg</font>]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$argClass</font> ne {::tclopt::Parameter}} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Only ::tclopt::Parameter could be added to optimizer, '<font color=#f1b479>$</font>argClass' was provided&quot;</font>
        }
        <b><font color=#ffa500>lappend</font></b> parsNamesList [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#ffa500>lappend</font></b> parsNamesList {<b><font color=#ffa500>*</font></b>}[<b><font color=#fe6efe>my</font></b> getAllParsNames]
    }
    <b><font color=#ffa500>set</font></b> dup [<b><font color=#fe6efe>my</font></b> duplListCheck <font color=#f1b479>$parsNamesList</font>]
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dup</font> ne {}} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Optimizer already contains parameter with name '<font color=#f1b479>$</font>dup'&quot;</font>
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> parName [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
        <b><font color=#ffa500>dict</font></b> append Pars <font color=#f1b479>$parName</font> <font color=#f1b479>$arg</font>
    }
    <b><font color=#fe6efe>return</font></b>
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::GSA::getAllPars'>getAllPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::GSA" title="::tclopt::GSA" class='ruff_cmd'>::tclopt::GSA</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets references of all parameters objects.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_GSA_getAllPars' href="javascript:toggleSource('tclopt_GSA_getAllPars')">Show source</a></p>
<div id='tclopt_GSA_getAllPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllPars {args} {

    <i><font color=#76a396># Gets references of all parameters objects.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets references of all parameters objects. Returns: list of references} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$Pars</font>
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::GSA::getAllParsNames'>getAllParsNames</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::GSA" title="::tclopt::GSA" class='ruff_cmd'>::tclopt::GSA</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets names of all parameters.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllParsNames</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_GSA_getAllParsNames' href="javascript:toggleSource('tclopt_GSA_getAllParsNames')">Show source</a></p>
<div id='tclopt_GSA_getAllParsNames' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllParsNames {args} {

    <i><font color=#76a396># Gets names of all parameters.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets names of all parameters. Returns: list of elements names} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [dkeys <font color=#f1b479>$Pars</font>]
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::GSA::run'>run</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::GSA" title="::tclopt::GSA" class='ruff_cmd'>::tclopt::GSA</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT run</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_GSA_run' href="javascript:toggleSource('tclopt_GSA_run')">Show source</a></p>
<div id='tclopt_GSA_run' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> run {} {

            ::tclopt::NewIntps idum
            ::tclopt::intp_assign <font color=#f1b479>$idum</font> [= {-<font color=#f1b479>$seed</font>}]
            <b><font color=#ffa500>set</font></b> nfeval 0 ;<i><font color=#76a396># reset number of function evaluations</font></i>
            <b><font color=#ffa500>set</font></b> pars [dvalues [<b><font color=#fe6efe>my</font></b> getAllPars]]
            <b><font color=#ffa500>set</font></b> d [<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$pars</font>]
    <i><font color=#76a396>### Set inital parameter vector</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$initype</font> eq {specified}} {
                <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
                    <b><font color=#ffa500>lappend</font></b> xinit [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-initval</font>]
                }
            } <b><font color=#ffa500>else</font></b> {
                <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
                    <b><font color=#ffa500>set</font></b> l [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
                    <b><font color=#ffa500>set</font></b> u [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
                    <b><font color=#ffa500>lappend</font></b> xinit [= {<font color=#f1b479>$l</font>+[::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*(<font color=#f1b479>$u</font>-<font color=#f1b479>$l</font>)}]
                }
            }
    <i><font color=#76a396>### Estimate initial temperature</font></i>
            <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists temp0]} {
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font> &lt; <font color=#f1b479>$ntrial</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>set</font></b> xvec {}
                    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
                        <b><font color=#ffa500>set</font></b> l [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
                        <b><font color=#ffa500>set</font></b> u [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
                        <b><font color=#ffa500>lappend</font></b> xvec [= {<font color=#f1b479>$l</font>+[::tclopt::rnd_uni <font color=#f1b479>$idum</font>]*(<font color=#f1b479>$u</font>-<font color=#f1b479>$l</font>)}]
                    }
                    <b><font color=#ffa500>lappend</font></b> values [<font color=#f1b479>$funct</font> <font color=#f1b479>$xvec</font> <font color=#f1b479>$pdata</font>]
                }
                <i><font color=#76a396># calculate mean</font></i>
                <b><font color=#ffa500>set</font></b> sum 0.0
                <b><font color=#ffa500>foreach</font></b> value <font color=#f1b479>$values</font> {
                    <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+<font color=#f1b479>$value</font>}]
                }
                <b><font color=#ffa500>set</font></b> mean [= {<font color=#f1b479>$sum</font>/double([<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$values</font>])}]
                <i><font color=#76a396># Compute standard deviation</font></i>
                <b><font color=#ffa500>set</font></b> sumsq 0.0
                <b><font color=#ffa500>foreach</font></b> value <font color=#f1b479>$values</font> {
                    <b><font color=#ffa500>set</font></b> sumsq [= {<font color=#f1b479>$sumsq</font>+(<font color=#f1b479>$value</font>-<font color=#f1b479>$mean</font>)*(<font color=#f1b479>$value</font>-<font color=#f1b479>$mean</font>)}]
                }
                <b><font color=#ffa500>set</font></b> stddev [= {sqrt(<font color=#f1b479>$sumsq</font>/double(<font color=#f1b479>$ntrial</font>))}]
                <b><font color=#ffa500>set</font></b> temp0 [= {<font color=#f1b479>$stddev</font>/<font color=#f1b479>$d</font>}]
            }
    <i><font color=#76a396>### Calculate cooling constant r</font></i>
            <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists r]} {
                <b><font color=#ffa500>set</font></b> ratio [<b><font color=#ffa500>expr</font></b> {min(<font color=#f1b479>$temp0</font>/<font color=#f1b479>$tmin</font>, <font color=#f1b479>$maxratio</font>)}]
                <b><font color=#ffa500>set</font></b> r [= {(pow(<font color=#f1b479>$ratio</font>, <font color=#f1b479>$qv</font>-1.0)-1.0)/((<font color=#f1b479>$qv</font>-1.0)*<font color=#f1b479>$maxiter</font>)}]
            }
    <i><font color=#76a396>### Start of the outer loop (cooling)</font></i>
            <b><font color=#ffa500>set</font></b> niter 0
            <b><font color=#ffa500>set</font></b> xVecCurr <font color=#f1b479>$xinit</font>
            <b><font color=#ffa500>set</font></b> functCurrVal [<font color=#f1b479>$funct</font> <font color=#f1b479>$xinit</font> <font color=#f1b479>$pdata</font>]
            <b><font color=#ffa500>incr</font></b> nfev
            <b><font color=#ffa500>while</font></b> true {
                <b><font color=#ffa500>set</font></b> tempq [= {<font color=#f1b479>$temp0</font>*pow(1.0+(<font color=#f1b479>$qv</font>-1.0)*<font color=#f1b479>$r</font>*<font color=#f1b479>$niter</font>, -1.0/(<font color=#f1b479>$qv</font>-1.0))}]
    <i><font color=#76a396>####  Calculate number of inner iterations within temperature</font></i>
                <b><font color=#ffa500>set</font></b> nt [= {min(<font color=#f1b479>$maxinniter</font>, max(<font color=#f1b479>$mininniter</font>, int(<font color=#f1b479>$nbase</font>*pow(<font color=#f1b479>$tempq</font>, <font color=#b9b96e>-double</font>(<font color=#f1b479>$d</font>)/(3.0-<font color=#f1b479>$qv</font>)))))}]
    <i><font color=#76a396>####  Start inner loop within the temperature</font></i>
                <b><font color=#ffa500>set</font></b> accepted 0
                <b><font color=#ffa500>set</font></b> attempted 0
                <b><font color=#ffa500>set</font></b> xVecBest <font color=#f1b479>$xVecCurr</font>
                <b><font color=#ffa500>set</font></b> functBestVal <font color=#f1b479>$functCurrVal</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> nti 0} {<font color=#f1b479>$nti</font>&lt;<font color=#f1b479>$nt</font>} {<b><font color=#ffa500>incr</font></b> nti} {
    <i><font color=#76a396>#####   Pertrub initial vector</font></i>
                    <b><font color=#ffa500>set</font></b> xVecCandidate {}
                    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> i [lseq 0 to [= {[<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$pars</font>]-1}]] {
                        <b><font color=#ffa500>incr</font></b> attempted
                        <b><font color=#ffa500>set</font></b> lowlim [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
                        <b><font color=#ffa500>set</font></b> uplim [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
                        <b><font color=#ffa500>set</font></b> u [::tclopt::rnd_uni <font color=#f1b479>$idum</font>]
                        <b><font color=#ffa500>set</font></b> sign [= {<font color=#f1b479>$u</font>&lt;0.5 ? -1.0 : 1.0}]
                        <b><font color=#ffa500>set</font></b> u [= {abs(2.0*<font color=#f1b479>$u</font>-1.0)}]
                        <b><font color=#ffa500>set</font></b> dx [= {<font color=#f1b479>$sign</font>*sqrt(<font color=#f1b479>$tempq</font>)*sqrt((pow(1.0/<font color=#f1b479>$u</font>, <font color=#f1b479>$qv</font>-1.0)-1.0)/(<font color=#f1b479>$qv</font>-1.0))}]
                        <b><font color=#ffa500>set</font></b> xnew [= {[@ <font color=#f1b479>$xVecCurr</font> <font color=#f1b479>$i</font>]+<font color=#f1b479>$dx</font>}]
                        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$xnew</font> &lt; <font color=#f1b479>$lowlim</font>} {
                            <b><font color=#ffa500>set</font></b> xnew <font color=#f1b479>$lowlim</font>
                        }
                        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$xnew</font> &gt; <font color=#f1b479>$uplim</font>} {
                            <b><font color=#ffa500>set</font></b> xnew <font color=#f1b479>$uplim</font>
                        }
                        <b><font color=#ffa500>lappend</font></b> xVecCandidate <font color=#f1b479>$xnew</font>
                    }
                    <b><font color=#ffa500>set</font></b> functCandidateVal [<font color=#f1b479>$funct</font> <font color=#f1b479>$xVecCandidate</font> <font color=#f1b479>$pdata</font>]
                    <b><font color=#ffa500>incr</font></b> nfev
                    <b><font color=#ffa500>set</font></b> deltaFunct [= {<font color=#f1b479>$functCandidateVal</font> - <font color=#f1b479>$functCurrVal</font>}]
    <i><font color=#76a396>#####   Check accept or not the new solution</font></i>
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deltaFunct</font>&lt;=0.0} {
                        <b><font color=#ffa500>set</font></b> functCurrVal <font color=#f1b479>$functCandidateVal</font>
                        <b><font color=#ffa500>set</font></b> xVecCurr <font color=#f1b479>$xVecCandidate</font>
                        <b><font color=#ffa500>incr</font></b> accepted
                    } <b><font color=#ffa500>else</font></b> {
                        <b><font color=#ffa500>set</font></b> prob [= {pow(1.0+(<font color=#f1b479>$qa</font>-1.0)*<font color=#f1b479>$deltaFunct</font>/<font color=#f1b479>$tempq</font>, -1.0/(<font color=#f1b479>$qa</font>-1.0))}]
                        <b><font color=#ffa500>set</font></b> u [::tclopt::rnd_uni <font color=#f1b479>$idum</font>]
                        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$u</font>&lt;<font color=#f1b479>$prob</font>} {
                            <b><font color=#ffa500>set</font></b> functCurrVal <font color=#f1b479>$functCandidateVal</font>
                            <b><font color=#ffa500>set</font></b> xVecCurr <font color=#f1b479>$xVecCandidate</font>
                            <b><font color=#ffa500>incr</font></b> accepted
                        }
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$functCurrVal</font> &lt; <font color=#f1b479>$functBestVal</font>} {
                        <i><font color=#76a396>#puts $functCurrVal</font></i>
                        <b><font color=#ffa500>set</font></b> functBestVal <font color=#f1b479>$functCurrVal</font>
                        <b><font color=#ffa500>set</font></b> xVecBest <font color=#f1b479>$xVecCurr</font>
                    }
                }
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$attempted</font> &gt; 0} {
                    <b><font color=#ffa500>set</font></b> ratio [= {double(<font color=#f1b479>$accepted</font>)/<font color=#f1b479>$attempted</font>}]
                } <b><font color=#ffa500>else</font></b> {
                    <b><font color=#ffa500>set</font></b> ratio 0.0
                }
                <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists threshold]} {
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$functBestVal</font>&lt;=<font color=#f1b479>$threshold</font>} {
                        <b><font color=#ffa500>set</font></b> info <font color=#90ee90>&quot;Optimization stopped due to reaching threshold of objective function '<font color=#f1b479>$</font>threshold'&quot;</font>
                        <b><font color=#fe6efe>break</font></b>
                    }
                }
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$niter</font>&gt;=<font color=#f1b479>$maxiter</font>} {
                    <b><font color=#ffa500>set</font></b> info <font color=#90ee90>&quot;Optimization stopped due to reaching maximum number of iterations '<font color=#f1b479>$</font>maxiter'&quot;</font>
                    <b><font color=#fe6efe>break</font></b>
                }
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$tempq</font>&lt;=<font color=#f1b479>$tmin</font>} {
                    <b><font color=#ffa500>set</font></b> info <font color=#90ee90>&quot;Optimization stopped due to reaching minimum temperature '<font color=#f1b479>$</font>tmin'&quot;</font>
                    <b><font color=#fe6efe>break</font></b>
                }
                <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists maxfev]} {
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nfev</font>&gt;=<font color=#f1b479>$maxfev</font>} {
                        <b><font color=#ffa500>set</font></b> info <font color=#90ee90>&quot;Optimization stopped due to reaching maximum number of objective functions evaluation '<font color=#f1b479>$</font>maxfev'&quot;</font>
                        <b><font color=#fe6efe>break</font></b>
                    }
                }
                <b><font color=#ffa500>incr</font></b> niter
            }
    <i><font color=#76a396>### Save result</font></i>
            <b><font color=#ffa500>set</font></b> resDict [<b><font color=#ffa500>dcreate</font></b> objfunc <font color=#f1b479>$functBestVal</font> x <font color=#f1b479>$xVecBest</font> nfev <font color=#f1b479>$nfev</font> temp0 <font color=#f1b479>$temp0</font> tempend <font color=#f1b479>$tempq</font> info <font color=#f1b479>$info</font> r <font color=#f1b479>$r</font>]
            <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$resDict</font>
}</pre></div>
</div><h3 class='ruffclass'><a name='::tclopt::Mpfit'>Mpfit</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::addPars" title="addPars" class='ruff_cmd'>addPars</a></td><td>Not documented.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><code>duplListCheck</code></td><td>See <a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="DuplChecker.duplListCheck" class='ruff_cmd'>DuplChecker.duplListCheck</a></td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::getAllPars" title="getAllPars" class='ruff_cmd'>getAllPars</a></td><td>Gets references of all parameters objects.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::getAllParsNames" title="getAllParsNames" class='ruff_cmd'>getAllParsNames</a></td><td>Gets names of all parameters.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::run" title="run" class='ruff_cmd'>run</a></td><td>Runs optimization.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-covtol</font></code>, <code><font color=#b9b96e>-epsfcn</font></code>, <code><font color=#b9b96e>-ftol</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-gtol</font></code>, <code><font color=#b9b96e>-m</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-nofinitecheck</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-stepfactor</font></code>, <code><font color=#b9b96e>-xtol</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-covtol</font></code>, <code><font color=#b9b96e>-epsfcn</font></code>, <code><font color=#b9b96e>-ftol</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-gtol</font></code>, <code><font color=#b9b96e>-m</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-nofinitecheck</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-stepfactor</font></code>, <code><font color=#b9b96e>-xtol</font></code></p>
<h5 class='ruff'>Mixins</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::DuplChecker" title="DuplChecker" class='ruff_cmd'>DuplChecker</a></p>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT constructor</span> <span class='ruff_arg'>-funct value -m value -pdata value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value? ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><font color=#b9b96e>-covtol</font></code></td><td>Range tolerance for covariance calculation. Value must be of the type float more than zero, default is 1e-14.</td></tr>
<tr><td><code><font color=#b9b96e>-epsfcn</font></code></td><td>Finite derivative step size. Value must be of the type float more than zero, default is 2.2204460e-16.</td></tr>
<tr><td><code><font color=#b9b96e>-ftol</font></code></td><td>Control termination of mpfit. Termination occurs when both the actual and predicted relative reductions in the sum of squares are at most ftol. Therefore, ftol measures the relative error desired in the sum of squares. Value must be of the type float more than zero, default is 1e-10.</td></tr>
<tr><td><code><font color=#b9b96e>-funct</font></code></td><td>Name of the procedure that should be minimized.</td></tr>
<tr><td><code><font color=#b9b96e>-gtol</font></code></td><td>Control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any column of the jacobian is at most gtol in absolute value. Therefore, gtol measures the orthogonality desired between the function vector and the columns of the jacobian. Value must be of the type float more than zero, default is 1e-10.</td></tr>
<tr><td><code><font color=#b9b96e>-m</font></code></td><td>Number of data points.</td></tr>
<tr><td><code><font color=#b9b96e>-maxfev</font></code></td><td>Control termination of mpfit. Termination occurs when the number of calls to funct is at least maxfev by the end of an iteration. Value must be the positive integer, default is 0. If it equals to 0, number of evaluations is not restricted.</td></tr>
<tr><td><code><font color=#b9b96e>-maxiter</font></code></td><td>Maximum number of iterations. If maxiter equal to 0, then basic error checking is done, and parameter errors/covariances are estimated based on input arameter values, but no fitting iterations are done. Value must be the positive integer, default is 200.</td></tr>
<tr><td><code><font color=#b9b96e>-nofinitecheck</font></code></td><td>Enable check for infinite quantities, default is off.</td></tr>
<tr><td><code><font color=#b9b96e>-pdata</font></code></td><td>List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification.</td></tr>
<tr><td><code><font color=#b9b96e>-stepfactor</font></code></td><td>Used in determining the initial step bound. This bound is set to the product of factor and the euclidean norm of diag*x if nonzero, or else to factor itself. In most cases factor should lie in the interval (.1,100.). 100. is a generally recommended value. Value must be of the type float more than zero, default is 100.</td></tr>
<tr><td><code><font color=#b9b96e>-xtol</font></code></td><td>Control termination of mpfit. Termination occurs when the relative error between two consecutive iterates is at most xtol. Therefore, xtol measures the relative error desired in the approximate solution. Value must be of the type float more than zero, default is 1e-10.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Class uses the Levenberg-Marquardt technique to solve the least-squares problem. In its typical use, it will be used to fit a user-supplied function (the &quot;model&quot;) to user-supplied data points (the &quot;data&quot;) by adjusting a set of parameters. mpfit is based upon MINPACK-1 (LMDIF.F) by More' and collaborators. The user-supplied function should compute an array of weighted deviations between model and data. In a typical scientific problem the residuals should be weighted so that each deviate has a gaussian sigma of 1.0. If x represents values of the independent variable, y represents a measurement for each value of x, and err represents the error in the measurements, then the deviates could be calculated as follows:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
    <b><font color=#ffa500>lset</font></b> deviates <font color=#f1b479>$i</font> [<b><font color=#ffa500>expr</font></b> {([<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$y</font> <font color=#f1b479>$i</font>] - [f [<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]])/[<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$err</font> <font color=#f1b479>$i</font>]}]
}
</pre>

</figure><p class='ruff'>where m is the number of data points, and where f is the function representing the model evaluated at x. If ERR are the 1-sigma uncertainties in Y, then the sum of deviates squared will be the total chi-squared value, which mpfit will seek to minimize. Simple constraints are placed on parameter values by adding objects of class <a href="index-tclopt.html#::tclopt::ParameterMpfit" title="::tclopt::ParameterMpfit" class='ruff_cmd'>::tclopt::ParameterMpfit</a> to mpfit with method <a href="index-tclopt.html#::tclopt::Mpfit::addPars" title="addPars" class='ruff_cmd'>addPars</a>, where other parameter-specific options can be set. For details of how to specify constraints, please look at the description of <a href="index-tclopt.html#::tclopt::ParameterMpfit" title="::tclopt::ParameterMpfit" class='ruff_cmd'>::tclopt::ParameterMpfit</a> class. Please note, that order in which we attach parameters objects is the order in which values will be supplied to minimized function, and the order in which resulted will be written to X property of the class. Example of user defined function (using linear equation t=a+b*x):</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#fe6efe>proc</font></b> f {xall pdata args} {
    <b><font color=#ffa500>set</font></b> x [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> x]
    <b><font color=#ffa500>set</font></b> y [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> y]
    <b><font color=#ffa500>set</font></b> ey [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> ey]
    <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
        <b><font color=#ffa500>set</font></b> f [= {[@ <font color=#f1b479>$xall</font> 0]+[@ <font color=#f1b479>$xall</font> 1]*<font color=#f1b479>$xVal</font>}]
        <b><font color=#ffa500>lappend</font></b> fval [= {(<font color=#f1b479>$yVal</font>-<font color=#f1b479>$f</font>)/<font color=#f1b479>$eyVal</font>}]
    }
    <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fval</font>]
}
</pre>

</figure><p class='ruff'>where xall is list of initial parameters values, pdata - dictionary that contains x, y and ey lists with length m. It returns dictionary with residuals values. Alternative form of function f could also provide analytical derivatives:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#fe6efe>proc</font></b> quadfunc {xall pdata args} {
    <b><font color=#ffa500>set</font></b> x [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> x]
    <b><font color=#ffa500>set</font></b> y [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> y]
    <b><font color=#ffa500>set</font></b> ey [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> ey]
    <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
        <b><font color=#ffa500>lappend</font></b> fvec [= {(<font color=#f1b479>$yVal</font>-[@ <font color=#f1b479>$xall</font> 0]-[@ <font color=#f1b479>$xall</font> 1]*<font color=#f1b479>$xVal</font>-[@ <font color=#f1b479>$xall</font> 2]*<font color=#f1b479>$xVal</font>*<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
    }
    <b><font color=#ffa500>if</font></b> {[@ <font color=#f1b479>$args</font> 0]!=<font color=#90ee90>&quot;&quot;</font>} {
        <b><font color=#ffa500>set</font></b> derivs [@ <font color=#f1b479>$args</font> 0]
        <b><font color=#ffa500>foreach</font></b> deriv <font color=#f1b479>$derivs</font> {
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==0} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {-1/<font color=#f1b479>$eyVal</font>}]
                }
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==1} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {(-<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
                }
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==2} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {(-<font color=#f1b479>$xVal</font>*<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
                }
            }
        }
        <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fvec</font> dvec <font color=#f1b479>$dvec</font>]
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fvec</font>]
    }
}
</pre>

</figure><p class='ruff'>The first element of the <code>args</code> list is a list specifying the ordinal numbers of the parameters for which we need to calculate the analytical derivative. In this case, the returned <code>dvec</code> list contains the derivative at each x point for each specified parameter, following the same order as in the input list. For example, if the input list is {0, 2} and the number m of x points is 3, the <code>dvec</code> list will look like this:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'>⎛⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞  ⎞
⎜⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟  ⎟
⎜⎝dp0⎠   ⎝dp0⎠   ⎝dp0⎠   ⎝dp2⎠   ⎝dp2⎠   ⎝dp2⎠  ⎟
⎝     x0      x1      x2      x0      x1      x2⎠
</pre>

</figure><p class='ruff'>Description of keys and data in returned dictionary:</p>
<table class='ruff_deflist'>
<tr><td>-bestnorm</td><td>Final chi^2.</td></tr>
<tr><td>-orignorm</td><td>Starting value of chi^2.</td></tr>
<tr><td>-status</td><td>Fitting status code.</td></tr>
<tr><td>-niter</td><td>Number of iterations.</td></tr>
<tr><td>-nfev</td><td>Number of function evaluations.</td></tr>
<tr><td>-npar</td><td>Total number of parameters.</td></tr>
<tr><td>-nfree</td><td>Number of free parameters.</td></tr>
<tr><td>-npegged</td><td>Number of pegged parameters.</td></tr>
<tr><td>-nfunc</td><td>Number of residuals (= num. of data points)</td></tr>
<tr><td>-resid</td><td>List of final residuals.</td></tr>
<tr><td>-xerror</td><td>Final parameter uncertainties (1-sigma), in the order of elements in <code>Pars</code> property dictionary.</td></tr>
<tr><td>-x</td><td>Final parameters values list in the order of elements in <code>Pars</code> property dictionary.</td></tr>
<tr><td>-debug</td><td>String with derivatives debugging output.</td></tr>
<tr><td>-covar</td><td>Final parameters covariance matrix.</td></tr>
</table>
<p class='ruff'>You can also access all results by [my configure -propertyName] mechanism.</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>object of class</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_constructor' href="javascript:toggleSource('tclopt_Mpfit_constructor')">Show source</a></p>
<div id='tclopt_Mpfit_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <i><font color=#76a396># Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.</font></i>
    <i><font color=#76a396>#  -funct - name of the procedure that should be minimized</font></i>
    <i><font color=#76a396>#  -m - number of data points</font></i>
    <i><font color=#76a396>#  -pdata - list or dictionary that provides private data to funct that is needed to evaluate residuals. Usually</font></i>
    <i><font color=#76a396>#    it contains x and y values lists, but you can provide any data necessary for function residuals evaluation.</font></i>
    <i><font color=#76a396>#    Will be passed upon each function evaluation without modification.</font></i>
    <i><font color=#76a396>#  -ftol - control termination of mpfit. Termination occurs when both the actual and predicted relative</font></i>
    <i><font color=#76a396>#    reductions in the sum of squares are at most ftol. Therefore, ftol measures the relative error desired</font></i>
    <i><font color=#76a396>#    in the sum of squares. Value must be of the type float more than zero, default is 1e-10.</font></i>
    <i><font color=#76a396>#  -xtol - control termination of mpfit. Termination occurs when the relative error between two consecutive</font></i>
    <i><font color=#76a396>#    iterates is at most xtol. Therefore, xtol measures the relative error desired in the approximate solution.</font></i>
    <i><font color=#76a396>#    Value must be of the type float more than zero, default is 1e-10.</font></i>
    <i><font color=#76a396>#  -gtol - control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any</font></i>
    <i><font color=#76a396>#    column of the jacobian is at most gtol in absolute value. Therefore, gtol measures the orthogonality desired</font></i>
    <i><font color=#76a396>#    between the function vector and the columns of the jacobian. Value must be of the type float more than zero,</font></i>
    <i><font color=#76a396>#    default is 1e-10.</font></i>
    <i><font color=#76a396>#  -maxfev - control termination of mpfit. Termination occurs when the number of calls to funct is at least</font></i>
    <i><font color=#76a396>#    maxfev by the end of an iteration. Value must be the positive integer, default is 0. If it equals to 0,</font></i>
    <i><font color=#76a396>#    number of evaluations is not restricted.</font></i>
    <i><font color=#76a396>#  -stepfactor - used in determining the initial step bound. This bound is set to the product of factor and the</font></i>
    <i><font color=#76a396>#    euclidean norm of diag*x if nonzero, or else to factor itself. In most cases factor should lie in the</font></i>
    <i><font color=#76a396>#    interval (.1,100.). 100. is a generally recommended value. Value must be of the type float more than zero,</font></i>
    <i><font color=#76a396>#    default is 100.</font></i>
    <i><font color=#76a396>#  -covtol - range tolerance for covariance calculation. Value must be of the type float more than zero, default</font></i>
    <i><font color=#76a396>#    is 1e-14.</font></i>
    <i><font color=#76a396>#  -maxiter - maximum number of iterations. If maxiter equal to 0, then basic error checking is done, and</font></i>
    <i><font color=#76a396>#    parameter errors/covariances are estimated based on input arameter values, but no fitting iterations are</font></i>
    <i><font color=#76a396>#    done. Value must be the positive integer, default is 200.</font></i>
    <i><font color=#76a396>#  -epsfcn - finite derivative step size. Value must be of the type float more than zero, default is</font></i>
    <i><font color=#76a396>#    2.2204460e-16.</font></i>
    <i><font color=#76a396>#  -nofinitecheck - enable check for infinite quantities, default is off.</font></i>
    <i><font color=#76a396># Returns: object of class</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Class uses the Levenberg-Marquardt technique to solve the least-squares problem. In its typical use, it will</font></i>
    <i><font color=#76a396># be used to fit a user-supplied function (the &quot;model&quot;) to user-supplied data points (the &quot;data&quot;) by adjusting a</font></i>
    <i><font color=#76a396># set of parameters. mpfit is based upon MINPACK-1 (LMDIF.F) by More' and collaborators.</font></i>
    <i><font color=#76a396># The user-supplied function should compute an array of weighted deviations between model and data. In a typical</font></i>
    <i><font color=#76a396># scientific problem the residuals should be weighted so that each deviate has a gaussian sigma of 1.0. If x</font></i>
    <i><font color=#76a396># represents values of the independent variable, y represents a measurement for each value of x, and err</font></i>
    <i><font color=#76a396># represents the error in the measurements, then the deviates could be calculated as follows:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># for {set i 0} {$i&lt;$m} {incr i} {</font></i>
    <i><font color=#76a396>#     lset deviates $i [expr {([lindex $y $i] - [f [lindex $x $i]])/[lindex $err $i]}]</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># where m is the number of data points, and where f is the function representing the model evaluated at x. If ERR</font></i>
    <i><font color=#76a396># are the 1-sigma uncertainties in Y, then the sum of deviates squared will be the total chi-squared value, which</font></i>
    <i><font color=#76a396># mpfit will seek to minimize.</font></i>
    <i><font color=#76a396># Simple constraints are placed on parameter values by adding objects of class [::tclopt::ParameterMpfit] to</font></i>
    <i><font color=#76a396># mpfit with method [::tclopt::Mpfit::addPars], where other parameter-specific options can be set.</font></i>
    <i><font color=#76a396># For details of how to specify constraints, please look at the</font></i>
    <i><font color=#76a396># description of [::tclopt::ParameterMpfit] class. Please note, that order in which we attach parameters objects</font></i>
    <i><font color=#76a396># is the order in which values will be supplied to minimized function, and the order in which resulted will</font></i>
    <i><font color=#76a396># be written to X property of the class.</font></i>
    <i><font color=#76a396># Example of user defined function (using linear equation t=a+b*x):</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># proc f {xall pdata args} {</font></i>
    <i><font color=#76a396>#     set x [dget $pdata x]</font></i>
    <i><font color=#76a396>#     set y [dget $pdata y]</font></i>
    <i><font color=#76a396>#     set ey [dget $pdata ey]</font></i>
    <i><font color=#76a396>#     foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#         set f [= {[@ $xall 0]+[@ $xall 1]*$xVal}]</font></i>
    <i><font color=#76a396>#         lappend fval [= {($yVal-$f)/$eyVal}]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396>#     return [dcreate fvec $fval]</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># where xall is list of initial parameters values, pdata - dictionary that contains x, y and ey lists with</font></i>
    <i><font color=#76a396># length m. It returns dictionary with residuals values.</font></i>
    <i><font color=#76a396># Alternative form of function f could also provide analytical derivatives:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># proc quadfunc {xall pdata args} {</font></i>
    <i><font color=#76a396>#     set x [dget $pdata x]</font></i>
    <i><font color=#76a396>#     set y [dget $pdata y]</font></i>
    <i><font color=#76a396>#     set ey [dget $pdata ey]</font></i>
    <i><font color=#76a396>#     foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#         lappend fvec [= {($yVal-[@ $xall 0]-[@ $xall 1]*$xVal-[@ $xall 2]*$xVal*$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396>#     if {[@ $args 0]!=&quot;&quot;} {</font></i>
    <i><font color=#76a396>#         set derivs [@ $args 0]</font></i>
    <i><font color=#76a396>#         foreach deriv $derivs {</font></i>
    <i><font color=#76a396>#             if {$deriv==0} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {-1/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#             if {$deriv==1} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {(-$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#             if {$deriv==2} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {(-$xVal*$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#         }</font></i>
    <i><font color=#76a396>#         return [dcreate fvec $fvec dvec $dvec]</font></i>
    <i><font color=#76a396>#     } else {</font></i>
    <i><font color=#76a396>#         return [dcreate fvec $fvec]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># The first element of the `args` list is a list specifying the ordinal numbers of the parameters for which we</font></i>
    <i><font color=#76a396># need to calculate the analytical derivative. In this case, the returned `dvec` list contains the derivative at</font></i>
    <i><font color=#76a396># each x point for each specified parameter, following the same order as in the input list. For example, if the</font></i>
    <i><font color=#76a396># input list is {0, 2} and the number m of x points is 3, the `dvec` list will look like this:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># ⎛⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞  ⎞</font></i>
    <i><font color=#76a396># ⎜⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟  ⎟</font></i>
    <i><font color=#76a396># ⎜⎝dp0⎠   ⎝dp0⎠   ⎝dp0⎠   ⎝dp2⎠   ⎝dp2⎠   ⎝dp2⎠  ⎟</font></i>
    <i><font color=#76a396># ⎝     x0      x1      x2      x0      x1      x2⎠</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Description of keys and data in returned dictionary:</font></i>
    <i><font color=#76a396>#   -bestnorm - final chi^2</font></i>
    <i><font color=#76a396>#   -orignorm - starting value of chi^2</font></i>
    <i><font color=#76a396>#   -status - fitting status code</font></i>
    <i><font color=#76a396>#   -niter - number of iterations</font></i>
    <i><font color=#76a396>#   -nfev - number of function evaluations</font></i>
    <i><font color=#76a396>#   -npar - total number of parameters</font></i>
    <i><font color=#76a396>#   -nfree - number of free parameters</font></i>
    <i><font color=#76a396>#   -npegged - number of pegged parameters</font></i>
    <i><font color=#76a396>#   -nfunc - number of residuals (= num. of data points)</font></i>
    <i><font color=#76a396>#   -resid - list of final residuals</font></i>
    <i><font color=#76a396>#   -xerror - final parameter uncertainties (1-sigma), in the order of elements in `Pars` property dictionary.</font></i>
    <i><font color=#76a396>#   -x - final parameters values list in the order of elements in `Pars` property dictionary.</font></i>
    <i><font color=#76a396>#   -debug - string with derivatives debugging output</font></i>
    <i><font color=#76a396>#   -covar - final parameters covariance matrix.</font></i>
    <i><font color=#76a396># You can also access all results by \[my configure -propertyName\] mechanism.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Synopsis: -funct value -m value -pdata value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value?</font></i>
    <i><font color=#76a396>#   ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?</font></i>
    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-help</font> {Creates optimization object that does least squares fitting using modified  Levenberg-Marquardt algorithm. For more detailed description please see documentation} {
        {<font color=#b9b96e>-funct</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Name of the procedure that should be minimized}}
        {<font color=#b9b96e>-m</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Number of data points}}
        {<font color=#b9b96e>-pdata</font>= <font color=#b9b96e>-default</font> {} <font color=#b9b96e>-help</font> {List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification}}
        {<font color=#b9b96e>-ftol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when both the actual and predicted relative reductions in the sum of squares are at most ftol}}
        {<font color=#b9b96e>-xtol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the relative error between two consecutive iterates is at most xtol}}
        {<font color=#b9b96e>-gtol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any column of the jacobian is at most gtol in absolute value}}
        {<font color=#b9b96e>-stepfactor</font>= <font color=#b9b96e>-default</font> 100 <font color=#b9b96e>-help</font> {Used in determining the initial step bound. This bound is set to the product of factor and the euclidean norm of diag*x if nonzero, or else to factor itself}}
        {<font color=#b9b96e>-covtol</font>= <font color=#b9b96e>-default</font> 1e-14 <font color=#b9b96e>-help</font> {Range tolerance for covariance calculation}}
        {<font color=#b9b96e>-maxiter</font>= <font color=#b9b96e>-default</font> 200 <font color=#b9b96e>-help</font> {Maximum number of iterations}}
        {<font color=#b9b96e>-maxfev</font>= <font color=#b9b96e>-default</font> 0 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the number of calls to funct is at least maxfev by the end of an iteration. If it equals to 0, number of evaluations is not restricted}}
        {<font color=#b9b96e>-epsfcn</font>= <font color=#b9b96e>-default</font> 2.2204460e-16 <font color=#b9b96e>-help</font> {Finite derivative step size}}
        {<font color=#b9b96e>-nofinitecheck</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Enable check for infinite quantities}}
    }]
    <b><font color=#ffa500>dict</font></b> for {elName elValue} <font color=#f1b479>$arguments</font> {
        <b><font color=#fe6efe>my</font></b> configure -<font color=#f1b479>$elName</font> <font color=#f1b479>$elValue</font>
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::Mpfit::addPars'>addPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT addPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_addPars' href="javascript:toggleSource('tclopt_Mpfit_addPars')">Show source</a></p>
<div id='tclopt_Mpfit_addPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> addPars {args} {

    argparse <font color=#b9b96e>-help</font> {Attaches parameters to optimizer object} {
        {params <font color=#b9b96e>-catchall</font> <font color=#b9b96e>-help</font> {References to objects of class '::tclopt::ParameterMpfit'}}
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> argClass [<b><font color=#ffa500>info</font></b> object class <font color=#f1b479>$arg</font>]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$argClass</font> ne {::tclopt::ParameterMpfit}} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Only ::tclopt::ParameterMpfit could be added to optimizer, '<font color=#f1b479>$</font>argClass' was provided&quot;</font>
        }
        <b><font color=#ffa500>lappend</font></b> parsNamesList [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#ffa500>lappend</font></b> parsNamesList {<b><font color=#ffa500>*</font></b>}[<b><font color=#fe6efe>my</font></b> getAllParsNames]
    }
    <b><font color=#ffa500>set</font></b> dup [<b><font color=#fe6efe>my</font></b> duplListCheck <font color=#f1b479>$parsNamesList</font>]
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dup</font> ne {}} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Optimizer already contains parameter with name '<font color=#f1b479>$</font>dup'&quot;</font>
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> parName [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
        <b><font color=#ffa500>dict</font></b> append Pars <font color=#f1b479>$parName</font> <font color=#f1b479>$arg</font>
    }
    <b><font color=#fe6efe>return</font></b>
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::Mpfit::getAllPars'>getAllPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets references of all parameters objects.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllPars</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_getAllPars' href="javascript:toggleSource('tclopt_Mpfit_getAllPars')">Show source</a></p>
<div id='tclopt_Mpfit_getAllPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllPars {args} {

    <i><font color=#76a396># Gets references of all parameters objects.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets references of all parameters objects. Returns: list of references} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$Pars</font>
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::Mpfit::getAllParsNames'>getAllParsNames</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets names of all parameters.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllParsNames</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_getAllParsNames' href="javascript:toggleSource('tclopt_Mpfit_getAllParsNames')">Show source</a></p>
<div id='tclopt_Mpfit_getAllParsNames' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllParsNames {args} {

    <i><font color=#76a396># Gets names of all parameters.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets names of all parameters. Returns: list of elements names} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [dkeys <font color=#f1b479>$Pars</font>]
    }
}</pre></div>
</div><h4 class='ruffmethod'><a name='::tclopt::Mpfit::run'>run</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Runs optimization.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT run</span> </div>
<h5 class='ruff'>Return value</h5><p class='ruff'>dictionary containing resulted data</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_run' href="javascript:toggleSource('tclopt_Mpfit_run')">Show source</a></p>
<div id='tclopt_Mpfit_run' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> run {} {

    <i><font color=#76a396># Runs optimization.</font></i>
    <i><font color=#76a396># Returns: dictionary containing resulted data</font></i>
    <b><font color=#ffa500>set</font></b> sideMap [<b><font color=#ffa500>dict</font></b> create auto 0 right 1 left -1 both 2 an 3]
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {At least one parameter must be attached to optimizer before call to run}
    }
    <b><font color=#ffa500>set</font></b> pars [dvalues [<b><font color=#fe6efe>my</font></b> getAllPars]]
    <b><font color=#ffa500>set</font></b> npar [<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$pars</font>]
    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
        <b><font color=#ffa500>lappend</font></b> xall [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-initval</font>]
    }
    <b><font color=#ffa500>set</font></b> qanylim false
    <b><font color=#ffa500>set</font></b> npegged 0
    <b><font color=#ffa500>set</font></b> nfev 0
    <b><font color=#ffa500>set</font></b> info 0
    <b><font color=#ffa500>set</font></b> fnorm -1.0
    <b><font color=#ffa500>set</font></b> fnorm1 -1.0
    <b><font color=#ffa500>set</font></b> xnorm -1.0
    <b><font color=#ffa500>set</font></b> delta 0.0
    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
        <b><font color=#ffa500>if</font></b> {[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-fixed</font>]} {
            <b><font color=#ffa500>lappend</font></b> pfixed true
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> pfixed false
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-step</font>}]} {
            <b><font color=#ffa500>lappend</font></b> step 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> step [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-step</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-relstep</font>}]} {
            <b><font color=#ffa500>lappend</font></b> dstep 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> dstep [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-relstep</font>]
        }
        <b><font color=#ffa500>lappend</font></b> mpside [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$sideMap</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-side</font>]]
        <b><font color=#ffa500>if</font></b> {![<font color=#f1b479>$par</font> configure <font color=#b9b96e>-debugder</font>]} {
            <b><font color=#ffa500>lappend</font></b> ddebug 0
            <b><font color=#ffa500>lappend</font></b> ddrtol 0
            <b><font color=#ffa500>lappend</font></b> ddatol 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> ddebug 1
            <b><font color=#ffa500>lappend</font></b> ddrtol [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-derivreltol</font>]
            <b><font color=#ffa500>lappend</font></b> ddatol [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-derivabstol</font>]
        }
    }
    <i><font color=#76a396># Finish up the free parameters</font></i>
    <b><font color=#ffa500>set</font></b> nfree 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> ifree 0
    }
    <b><font color=#ffa500>set</font></b> j 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>if</font></b> {![@ <font color=#f1b479>$pfixed</font> <font color=#f1b479>$i</font>]} {
            <b><font color=#ffa500>incr</font></b> nfree
            <b><font color=#ffa500>lset</font></b> ifree <font color=#f1b479>$j</font> <font color=#f1b479>$i</font>
            <b><font color=#ffa500>incr</font></b> j
        }
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nfree</font>==0} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {All parameters are fixed, optimization is not possible}
    }
    <i><font color=#76a396># allocate lists with zeros</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> qllim 0
        <b><font color=#ffa500>lappend</font></b> qulim 0
        <b><font color=#ffa500>lappend</font></b> llim 0
        <b><font color=#ffa500>lappend</font></b> ulim 0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>]]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>}]} {
            <b><font color=#ffa500>lset</font></b> qllim <font color=#f1b479>$i</font> 0
            <b><font color=#ffa500>lset</font></b> llim <font color=#f1b479>$i</font> 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lset</font></b> qllim <font color=#f1b479>$i</font> 1
            <b><font color=#ffa500>lset</font></b> llim <font color=#f1b479>$i</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>}]} {
            <b><font color=#ffa500>lset</font></b> qulim <font color=#f1b479>$i</font> 0
            <b><font color=#ffa500>lset</font></b> ulim <font color=#f1b479>$i</font> 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lset</font></b> qulim <font color=#f1b479>$i</font> 1
            <b><font color=#ffa500>lset</font></b> ulim <font color=#f1b479>$i</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
        }
        <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$i</font>) || li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$i</font>)} {
            <b><font color=#ffa500>set</font></b> qanylim true
        }
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$m</font>&lt;<font color=#f1b479>$nfree</font>} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Degree of freedom check failed because of 'm=<font color=#f1b479>$</font>m&gt;=n=<font color=#f1b479>$</font>nfree'&quot;</font>
    }
    <i><font color=#76a396># allocate temporary storage</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> diag 0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> wa4 0
    }
    <b><font color=#ffa500>set</font></b> ldfjac <font color=#f1b479>$m</font>
    <i><font color=#76a396># Evaluate user function with initial parameter values</font></i>
    <b><font color=#ffa500>set</font></b> fvec [<b><font color=#ffa500>dget</font></b> [<font color=#f1b479>$funct</font> <font color=#f1b479>$xall</font> <font color=#f1b479>$pdata</font>] fvec]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$fvec</font>]!=<font color=#f1b479>$m</font>} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Length of list '<font color=#f1b479>[</font>llength <font color=#f1b479>$</font>fvec<font color=#f1b479>]</font>' returned from the function is less than m '<font color=#f1b479>$</font>m' value&quot;</font>
    }
    <b><font color=#ffa500>incr</font></b> nfev
    <b><font color=#ffa500>set</font></b> fnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$fvec</font>]
    <i><font color=#76a396>#puts $fnorm</font></i>
    <b><font color=#ffa500>set</font></b> orignorm [= {<font color=#f1b479>$fnorm</font>*<font color=#f1b479>$fnorm</font>}]
    <i><font color=#76a396># Make a new copy</font></i>
    <b><font color=#ffa500>set</font></b> xnew <font color=#f1b479>$xall</font>
    <i><font color=#76a396># Transfer free parameters to 'x'</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> x [@ <font color=#f1b479>$xall</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>]]
    }
    <i><font color=#76a396># Initialize Levelberg-Marquardt parameter and iteration counter</font></i>
    <b><font color=#ffa500>set</font></b> par 0.0
    <b><font color=#ffa500>set</font></b> iter 1
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> qtf 0
    }
    <i><font color=#76a396># Beginning of the outer loop</font></i>
    <b><font color=#ffa500>while</font></b> {true} {
        <i><font color=#76a396># puts &quot;beginning of the outer loop&quot;</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> xnew [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]
        }
        <i><font color=#76a396># Calculate the jacobian matrix</font></i>
        <b><font color=#ffa500>set</font></b> fdjac2Data [<b><font color=#fe6efe>my</font></b> Fdjac2 <font color=#f1b479>$funct</font> <font color=#f1b479>$ifree</font> <font color=#f1b479>$nfree</font> <font color=#f1b479>$xnew</font> <font color=#f1b479>$fvec</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$epsfcn</font> <font color=#f1b479>$pdata</font> <font color=#f1b479>$nfev</font> <font color=#f1b479>$step</font> <font color=#f1b479>$dstep</font> <font color=#f1b479>$mpside</font> <font color=#f1b479>$qulim</font> <font color=#f1b479>$ulim</font> <font color=#f1b479>$ddebug</font> <font color=#f1b479>$ddrtol</font> <font color=#f1b479>$ddatol</font>]
        <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> fjac]
        <b><font color=#ffa500>set</font></b> nfev [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> nfev]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$fdjac2Data</font> debug]} {
            <b><font color=#ffa500>lappend</font></b> debugOutput {<b><font color=#ffa500>*</font></b>}[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> debug]
        }
        <i><font color=#76a396># Determine if any of the parameters are pegged at the limits</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$qanylim</font>} {
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>set</font></b> lpegged [= {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)==li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))}]
                <b><font color=#ffa500>set</font></b> upegged [= {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)==li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))}]
                <b><font color=#ffa500>set</font></b> sum 0
                <i><font color=#76a396># If the parameter is pegged at a limit, compute the gradient direction</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> || <font color=#f1b479>$upegged</font>} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fvec</font>,<font color=#f1b479>$i</font>)*li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)}]
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
                <i><font color=#76a396># If pegged at lower limit and gradient is toward negative then reset gradient to zero</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> && (<font color=#f1b479>$sum</font>&gt;0)} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$ij</font> 0
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
                <i><font color=#76a396># If pegged at upper limit and gradient is toward positive then reset gradient to zero</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$upegged</font> && (<font color=#f1b479>$sum</font>&lt;0)} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$ij</font> 0
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
            }
        }
        <i><font color=#76a396># Compute the QR factorization of the jacobian</font></i>
        <b><font color=#ffa500>set</font></b> qfracData [<b><font color=#fe6efe>my</font></b> Qfrac <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> 1 <font color=#f1b479>$nfree</font>]
        <b><font color=#ffa500>set</font></b> ipvt [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> ipvt]
        <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> a]
        <b><font color=#ffa500>set</font></b> wa1 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> rdiag]
        <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> acnorm]
        <b><font color=#ffa500>set</font></b> wa3 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> wa]
        <i><font color=#76a396># on the first iteration and if mode is 1, scale according to the norms of the columns of the initial</font></i>
        <i><font color=#76a396># jacobian.</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>==1} {
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)==0.0} {
                    <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] 1.0
                }
            }
            <i><font color=#76a396># on the first iteration, calculate the norm of the scaled x and initialize the step bound delta.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> xnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]
            <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$stepfactor</font>*<font color=#f1b479>$xnorm</font>}]
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>==0.0} {
                <b><font color=#ffa500>set</font></b> delta <font color=#f1b479>$stepfactor</font>
            }
        }
        <i><font color=#76a396># form (q transpose)*fvec and store the first n components in qtf</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> wa4 <font color=#f1b479>$i</font> [@ <font color=#f1b479>$fvec</font> <font color=#f1b479>$i</font>]
        }
        <b><font color=#ffa500>set</font></b> jj 0
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
            <b><font color=#ffa500>set</font></b> temp3 [@ <font color=#f1b479>$fjac</font> <font color=#f1b479>$jj</font>]
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$temp3</font>!=0.0} {
                <b><font color=#ffa500>set</font></b> sum 0.0
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i <font color=#f1b479>$j</font>} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*li(<font color=#f1b479>$wa4</font>,<font color=#f1b479>$i</font>)}]
                    <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                }
                <b><font color=#ffa500>set</font></b> temp [= {-<font color=#f1b479>$sum</font>/<font color=#f1b479>$temp3</font>}]
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i <font color=#f1b479>$j</font>} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> wa4 <font color=#f1b479>$i</font> [= {li(<font color=#f1b479>$wa4</font>,<font color=#f1b479>$i</font>)+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*<font color=#f1b479>$temp</font>}]
                    <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                }
            }
            <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$jj</font> [@ <font color=#f1b479>$wa1</font> <font color=#f1b479>$j</font>]
            <b><font color=#ffa500>incr</font></b> jj [= {<font color=#f1b479>$m</font>+1}];<i><font color=#76a396> # fjac[j+m*j]&quot;</font></i>
            <b><font color=#ffa500>lset</font></b> qtf <font color=#f1b479>$j</font> [@ <font color=#f1b479>$wa4</font> <font color=#f1b479>$j</font>]
        }
        <i><font color=#76a396># (From this point on, only the square matrix, consisting of the triangle of R, is needed.)</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nofinitecheck</font>} {
            <i><font color=#76a396># Check for overflow.  This should be a cheap test here since FJAC</font></i>
            <i><font color=#76a396># has been reduced to a (small) square matrix, and the test is O(N^2).</font></i>
            <b><font color=#ffa500>set</font></b> off 0
            <b><font color=#ffa500>set</font></b> nonfinite 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$off</font>+<font color=#f1b479>$i</font>)&gt;<font color=#f1b479>$::tclopt::MP_GIANT</font>} {
                        <b><font color=#ffa500>set</font></b> nonfinite 1
                    }
                }
                <b><font color=#ffa500>incr</font></b> off <font color=#f1b479>$ldfjac</font>
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nonfinite</font>} {
                <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Overflow occured during finite check}
            }
        }
        <i><font color=#76a396># compute the norm of the scaled gradient.</font></i>
        <b><font color=#ffa500>set</font></b> gnorm 0.0
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$fnorm</font>!=0.0} {
            <b><font color=#ffa500>set</font></b> jj 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>set</font></b> l [@ <font color=#f1b479>$ipvt</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$l</font>)!=0.0} {
                    <b><font color=#ffa500>set</font></b> sum 0.0
                    <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;=<font color=#f1b479>$j</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*li(<font color=#f1b479>$qtf</font>,<font color=#f1b479>$i</font>)/<font color=#f1b479>$fnorm</font>}]
                        <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                    }
                    <b><font color=#ffa500>set</font></b> gnorm [<b><font color=#fe6efe>my</font></b> Dmax1 <font color=#f1b479>$gnorm</font> [= {abs(<font color=#f1b479>$sum</font>/li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$l</font>))}]]
                }
                <b><font color=#ffa500>incr</font></b> jj <font color=#f1b479>$m</font>
            }
        }
        <i><font color=#76a396># test for convergence of the gradient norm.</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$gnorm</font>&lt;=<font color=#f1b479>$gtol</font>} {
            <b><font color=#ffa500>set</font></b> info {Convergence in orthogonality}
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
            <b><font color=#fe6efe>break</font></b>
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$maxiter</font>==0} {
            <b><font color=#ffa500>set</font></b> info {Maximum number of iterations reached}
            <b><font color=#fe6efe>break</font></b>
        }
        <i><font color=#76a396># rescale</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
            <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [<b><font color=#fe6efe>my</font></b> Dmax1 [@ <font color=#f1b479>$diag</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>]] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]]
        }
        <i><font color=#76a396># beginning of the inner loop.</font></i>
        <b><font color=#ffa500>while</font></b> {true} {
            <i><font color=#76a396># determine the levenberg-marquardt parameter.</font></i>
            <b><font color=#ffa500>set</font></b> lmparData [<b><font color=#fe6efe>my</font></b> Lmpar <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$ipvt</font> <font color=#f1b479>$ifree</font> <font color=#f1b479>$diag</font> <font color=#f1b479>$qtf</font> <font color=#f1b479>$delta</font> <font color=#f1b479>$par</font>]
            <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> r]
            <b><font color=#ffa500>set</font></b> par [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> par]
            <b><font color=#ffa500>set</font></b> wa1 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> x]
            <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> sdiag]
            <b><font color=#ffa500>set</font></b> wa3 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> wa1]
            <i><font color=#76a396># store the direction p and x + p. calculate the norm of p.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> [= {<font color=#b9b96e>-li</font>(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> alpha 1.0
            <b><font color=#ffa500>if</font></b> {!<font color=#f1b479>$qanylim</font>} {
                <i><font color=#76a396># No parameter limits, so just move to new position WA2</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
                }
            } <b><font color=#ffa500>else</font></b> {
                <i><font color=#76a396># Respect the limits.  If a step were to go out of bounds, then</font></i>
                <i><font color=#76a396># we should take a step in the same direction but shorter distance.</font></i>
                <i><font color=#76a396># The step should take us right to the limit in that case.</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>set</font></b> lpegged [= {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)&lt;=li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))}]
                    <b><font color=#ffa500>set</font></b> upegged [= {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)&gt;=li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))}]
                    <b><font color=#ffa500>set</font></b> dwa1 [= {abs(li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&gt;<font color=#f1b479>$::tclopt::MP_MACHEP0</font>}]
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> && (li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)&lt;0)} {
                        <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> 0
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$upegged</font> && (li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)&gt;0)} {
                        <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> 0
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dwa1</font> && li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && ((li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&lt;li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))} {
                        <b><font color=#ffa500>set</font></b> alpha [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$alpha</font> [= {(li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)-li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>))/li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]]
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dwa1</font> && li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && ((li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&gt;li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))} {
                        <b><font color=#ffa500>set</font></b> alpha [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$alpha</font> [= {(li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)-li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>))/li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]]
                    }
                }
                <i><font color=#76a396># Scale the resulting vector, advance to the next position</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)*<font color=#f1b479>$alpha</font>}]
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
                    <i><font color=#76a396># Adjust the output values.  If the step put us exactly on a boundary, make sure it is exact.</font></i>
                    <b><font color=#ffa500>set</font></b> sgnu [= {(li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)&gt;=0) ? 1 : -1}]
                    <b><font color=#ffa500>set</font></b> sgnl [= {(li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)&gt;=0) ? 1 : -1}]
                    <b><font color=#ffa500>set</font></b> ulim1 [= {li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)*(1-<font color=#f1b479>$sgnu</font>*<font color=#f1b479>$::tclopt::MP_MACHEP0</font>)- ((li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)==0) ? <font color=#f1b479>$::tclopt::MP_MACHEP0</font> : 0)}]
                    <b><font color=#ffa500>set</font></b> llim1 [= {li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)*(1+<font color=#f1b479>$sgnl</font>*<font color=#f1b479>$::tclopt::MP_MACHEP0</font>)+ ((li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)==0) ? <font color=#f1b479>$::tclopt::MP_MACHEP0</font> : 0)}]
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)&gt;=<font color=#f1b479>$ulim1</font>)} {
                        <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [@ <font color=#f1b479>$ulim</font> <font color=#f1b479>$j</font>]
                    }
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)&lt;=<font color=#f1b479>$llim1</font>)} {
                        <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [@ <font color=#f1b479>$llim</font> <font color=#f1b479>$j</font>]
                    }
                }
            }
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> pnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]
            <i><font color=#76a396># on the first iteration, adjust the initial step bound.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>==1} {
                <b><font color=#ffa500>set</font></b> delta [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$delta</font> <font color=#f1b479>$pnorm</font>]
            }
            <i><font color=#76a396># evaluate the function at x + p and calculate its norm.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
                <b><font color=#ffa500>lset</font></b> xnew [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$i</font>]
            }
            <b><font color=#ffa500>set</font></b> functData [<font color=#f1b479>$funct</font> <font color=#f1b479>$xnew</font> <font color=#f1b479>$pdata</font>]
            <b><font color=#ffa500>set</font></b> wa4 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$functData</font> fvec]
            <b><font color=#ffa500>incr</font></b> nfev
            <b><font color=#ffa500>set</font></b> fnorm1 [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa4</font>]
            <i><font color=#76a396># compute the scaled actual reduction.</font></i>
            <b><font color=#ffa500>set</font></b> actred -1.0
            <b><font color=#ffa500>if</font></b> {[= {0.1*<font color=#f1b479>$fnorm1</font>}]&lt;<font color=#f1b479>$fnorm</font>} {
                <b><font color=#ffa500>set</font></b> temp [= {<font color=#f1b479>$fnorm1</font>/<font color=#f1b479>$fnorm</font>}]
                <b><font color=#ffa500>set</font></b> actred [= {1.0-<font color=#f1b479>$temp</font>*<font color=#f1b479>$temp</font>}]
            }
            <i><font color=#76a396># compute the scaled predicted reduction and the scaled directional derivative.</font></i>
            <b><font color=#ffa500>set</font></b> jj 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> 0.0
                <b><font color=#ffa500>set</font></b> l [@ <font color=#f1b479>$ipvt</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>set</font></b> temp [@ <font color=#f1b479>$wa1</font> <font color=#f1b479>$l</font>]
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;=<font color=#f1b479>$j</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$i</font> [= {li(<font color=#f1b479>$wa3</font>,<font color=#f1b479>$i</font>)+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*<font color=#f1b479>$temp</font>}]
                    <b><font color=#ffa500>incr</font></b> ij
                }
                <b><font color=#ffa500>incr</font></b> jj <font color=#f1b479>$m</font>
            }
            <i><font color=#76a396># Remember, alpha is the fraction of the full LM step actually taken</font></i>
            <b><font color=#ffa500>set</font></b> temp1 [= {[<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]*<font color=#f1b479>$alpha</font>/<font color=#f1b479>$fnorm</font>}]
            <b><font color=#ffa500>set</font></b> temp2 [= {sqrt(<font color=#f1b479>$par</font>*<font color=#f1b479>$alpha</font>)*<font color=#f1b479>$pnorm</font>/<font color=#f1b479>$fnorm</font>}]
            <b><font color=#ffa500>set</font></b> prered [= {<font color=#f1b479>$temp1</font>*<font color=#f1b479>$temp1</font>+(<font color=#f1b479>$temp2</font>*<font color=#f1b479>$temp2</font>)/0.5}]
            <b><font color=#ffa500>set</font></b> dirder [= {-(<font color=#f1b479>$temp1</font>*<font color=#f1b479>$temp1</font>+<font color=#f1b479>$temp2</font>*<font color=#f1b479>$temp2</font>)}]
            <i><font color=#76a396># compute the ratio of the actual to the predicted reduction</font></i>
            <b><font color=#ffa500>set</font></b> ratio 0.0
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$prered</font>!=0.0} {
                <b><font color=#ffa500>set</font></b> ratio [= {<font color=#f1b479>$actred</font>/<font color=#f1b479>$prered</font>}]
            }
            <i><font color=#76a396># update the step bound.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&lt;=0.25} {
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$actred</font>&gt;=0.0} {
                    <b><font color=#ffa500>set</font></b> temp 0.5
                } <b><font color=#ffa500>else</font></b> {
                    <b><font color=#ffa500>set</font></b> temp [= {0.5*<font color=#f1b479>$dirder</font>/(<font color=#f1b479>$dirder</font>+0.5*<font color=#f1b479>$actred</font>)}]
                }
                <b><font color=#ffa500>if</font></b> {((0.1*<font color=#f1b479>$fnorm1</font>)&gt;=<font color=#f1b479>$fnorm</font>) || (<font color=#f1b479>$temp</font>&lt;0.1)} {
                    <b><font color=#ffa500>set</font></b> temp 0.1
                }
                <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$temp</font>*[<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$delta</font> [= {<font color=#f1b479>$pnorm</font>/0.1}]]}]
                <b><font color=#ffa500>set</font></b> par [= {<font color=#f1b479>$par</font>/<font color=#f1b479>$temp</font>}]
            } <b><font color=#ffa500>else</font></b> {
                <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$par</font>==0.0) || (<font color=#f1b479>$ratio</font>&gt;=0.75)} {
                    <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$pnorm</font>/0.5}]
                    <b><font color=#ffa500>set</font></b> par [= {0.5*<font color=#f1b479>$par</font>}]
                }
            }
            <i><font color=#76a396># test for successful iteration.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&gt;=1e-4} {
                <i><font color=#76a396># successful iteration. update x, fvec, and their norms.</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> x <font color=#f1b479>$j</font> [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]
                    <i><font color=#76a396>#puts $x</font></i>
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)}]
                }
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> fvec <font color=#f1b479>$i</font> [@ <font color=#f1b479>$wa4</font> <font color=#f1b479>$i</font>]
                }
                <b><font color=#ffa500>set</font></b> xnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa2</font>]
                <b><font color=#ffa500>set</font></b> fnorm <font color=#f1b479>$fnorm1</font>
                <b><font color=#ffa500>incr</font></b> iter
            }
            <i><font color=#76a396># tests for convergence.</font></i>
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$ftol</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$ftol</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0)} {
                <b><font color=#ffa500>set</font></b> info {Convergence in chi-square value}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>&lt;=(<font color=#f1b479>$xtol</font>*<font color=#f1b479>$xnorm</font>)} {
                <b><font color=#ffa500>set</font></b> info {Convergence in parameter value}
            }
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$ftol</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$ftol</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0) && (<font color=#f1b479>$info</font>==2)} {
                <b><font color=#ffa500>set</font></b> info {Both convergence in parameter value and convergence in chi-square value hold}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
                <b><font color=#fe6efe>break</font></b>
            }
            <i><font color=#76a396># tests for termination and stringent tolerances.</font></i>
            <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$maxfev</font>&gt;0) && (<font color=#f1b479>$nfev</font>&gt;=<font color=#f1b479>$maxfev</font>)} {
                <i><font color=#76a396># Too many function evaluations</font></i>
                <b><font color=#ffa500>set</font></b> info {Maximum number of function evaluations reached}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>&gt;=<font color=#f1b479>$maxiter</font>} {
                <i><font color=#76a396># Too many iterations</font></i>
                <b><font color=#ffa500>set</font></b> info {Maximum number of iterations reached}
            }
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0)} {
                <b><font color=#ffa500>set</font></b> info {ftol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>*<font color=#f1b479>$xnorm</font>} {
                <b><font color=#ffa500>set</font></b> info {xtol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$gnorm</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>} {
                <b><font color=#ffa500>set</font></b> info {gtol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
                <b><font color=#fe6efe>break</font></b>
            }
            <i><font color=#76a396># end of the inner loop. repeat if iteration unsuccessful.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&lt;1e-4} {
                <b><font color=#fe6efe>continue</font></b>
            } <b><font color=#ffa500>else</font></b> {
                <b><font color=#fe6efe>break</font></b>
            }
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
            <b><font color=#fe6efe>break</font></b>
        }
    }
    <i><font color=#76a396># termination, either normal or user imposed.</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lset</font></b> xall [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>&gt;0} {
        <b><font color=#ffa500>set</font></b> functData [<font color=#f1b479>$funct</font> <font color=#f1b479>$xall</font> <font color=#f1b479>$pdata</font>]
        <b><font color=#ffa500>set</font></b> fvec [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$functData</font> fvec]
        <b><font color=#ffa500>incr</font></b> nfev
    }
    <i><font color=#76a396># Compute number of pegged parameters</font></i>
    <b><font color=#ffa500>set</font></b> npegged 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> <font color=#f1b479>$i</font>]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>}]} {
            <b><font color=#ffa500>set</font></b> parsLim0 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> parsLim0 [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>}]} {
            <b><font color=#ffa500>set</font></b> parsLim1 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> parsLim1 [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
        }
        <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$parsLim0</font> && (<font color=#f1b479>$parsLim0</font>==li(<font color=#f1b479>$xall</font>,<font color=#f1b479>$i</font>))) || (<font color=#f1b479>$parsLim1</font> && (<font color=#f1b479>$parsLim1</font>==li(<font color=#f1b479>$xall</font>,<font color=#f1b479>$i</font>)))} {
            <b><font color=#ffa500>incr</font></b> npegged
        }
    }
    <i><font color=#76a396># Compute and return the covariance matrix and/or parameter errors</font></i>
    <b><font color=#ffa500>set</font></b> covarData [<b><font color=#fe6efe>my</font></b> Covar <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$ipvt</font> <font color=#f1b479>$covtol</font>]
    <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$covarData</font> r]
    <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$covarData</font> wa]
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$npar</font>*<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> covar 0.0
    }
    <i><font color=#76a396># Transfer the covariance array</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> covar [= {int(li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>)*<font color=#f1b479>$npar</font>+li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$i</font>))}] [@ <font color=#f1b479>$fjac</font> [= {int(<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>+<font color=#f1b479>$i</font>)}]]
        }
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> xerror 0.0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>set</font></b> cc [@ <font color=#f1b479>$fjac</font> [= {int(<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>+<font color=#f1b479>$j</font>)}]]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$cc</font>&gt;0} {
            <b><font color=#ffa500>lset</font></b> xerror [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [= {sqrt(<font color=#f1b479>$cc</font>)}]
        }
    }
    <b><font color=#ffa500>set</font></b> bestnorm [= {[<b><font color=#fe6efe>my</font></b> Dmax1 <font color=#f1b479>$fnorm</font> <font color=#f1b479>$fnorm1</font>]**2}]
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> resid [@ <font color=#f1b479>$fvec</font> <font color=#f1b479>$j</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists debugOutput]} {
        <b><font color=#ffa500>set</font></b> debugOutput [<b><font color=#ffa500>join</font></b> <font color=#f1b479>$debugOutput</font> \n]
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#ffa500>set</font></b> debugOutput {}
    }
    <b><font color=#ffa500>set</font></b> resDict [<b><font color=#ffa500>dcreate</font></b> bestnorm <font color=#f1b479>$bestnorm</font> orignorm <font color=#f1b479>$orignorm</font> status <font color=#f1b479>$info</font> niter <font color=#f1b479>$iter</font> nfev <font color=#f1b479>$nfev</font> npar <font color=#f1b479>$npar</font> nfree <font color=#f1b479>$nfree</font> npegged <font color=#f1b479>$npegged</font> nfunc <font color=#f1b479>$m</font> resid <font color=#f1b479>$resid</font> xerror <font color=#f1b479>$xerror</font> x <font color=#f1b479>$xall</font> debug <font color=#f1b479>$debugOutput</font> covar <font color=#f1b479>$covar</font>]
    <b><font color=#ffa500>set</font></b> results <font color=#f1b479>$resDict</font>
    <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$resDict</font>
}</pre></div>
</div><h3 class='ruffclass'><a name='::tclopt::Parameter'>Parameter</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::Parameter::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<h5 class='ruff'>Subclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::ParameterMpfit" title="ParameterMpfit" class='ruff_cmd'>ParameterMpfit</a></p>
<h4 class='ruffmethod'><a name='::tclopt::Parameter::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Parameter" title="::tclopt::Parameter" class='ruff_cmd'>::tclopt::Parameter</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Parameter'>Parameter</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>Parameter create OBJNAME</span> <span class='ruff_arg'>?args?</span><br><span class='ruff_cmd'>Parameter new</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Parameter_constructor' href="javascript:toggleSource('tclopt_Parameter_constructor')">Show source</a></p>
<div id='tclopt_Parameter_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    argparse <font color=#b9b96e>-pfirst</font> {
        <font color=#b9b96e>-lowlim</font>=
        <font color=#b9b96e>-uplim</font>=
        name
        initval
    }
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-initval</font> <font color=#f1b479>$initval</font> <font color=#b9b96e>-name</font> <font color=#f1b479>$name</font>
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists lowlim]} {
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lowlim</font>&gt;<font color=#f1b479>$initval</font>} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Initial value must be higher than the lower limit}
        }
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-lowlim</font> <font color=#f1b479>$lowlim</font>
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists uplim]} {
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists lowlim]} {
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lowlim</font>&gt;=<font color=#f1b479>$uplim</font>} {
                <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Lower limit must be lower than the upper limit}
            }
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$uplim</font>&lt;<font color=#f1b479>$initval</font>} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Initial value must be lower than the upper limit}
        }
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-uplim</font> <font color=#f1b479>$uplim</font>
    }
}</pre></div>
</div><h3 class='ruffclass'><a name='::tclopt::ParameterMpfit'>ParameterMpfit</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::ParameterMpfit::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-debugder</font></code>, <code><font color=#b9b96e>-derivabstol</font></code>, <code><font color=#b9b96e>-derivreltol</font></code>, <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-relstep</font></code>, <code><font color=#b9b96e>-side</font></code>, <code><font color=#b9b96e>-step</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-debugder</font></code>, <code><font color=#b9b96e>-derivabstol</font></code>, <code><font color=#b9b96e>-derivreltol</font></code>, <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-relstep</font></code>, <code><font color=#b9b96e>-side</font></code>, <code><font color=#b9b96e>-step</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<h5 class='ruff'>Superclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::Parameter" title="Parameter" class='ruff_cmd'>Parameter</a></p>
<h4 class='ruffmethod'><a name='::tclopt::ParameterMpfit::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::ParameterMpfit" title="::tclopt::ParameterMpfit" class='ruff_cmd'>::tclopt::ParameterMpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::ParameterMpfit'>ParameterMpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Creates parameter object for <a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a> class.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT constructor</span> <span class='ruff_arg'>value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value? ?-debugder -debugreltol value -debugabstol value?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><font color=#b9b96e>-debugabstol</font></code></td><td>Absolute error that controls printing of derivatives comparison if absolute error exceeds this value. Requires -debugder and -debugreltol.</td></tr>
<tr><td><code><font color=#b9b96e>-debugder</font></code></td><td>Switch to enable console debug logging of user-computed derivatives, as described above. Note that when debugging is enabled, then -side should be set to auto, right, left or both, depending on which numerical derivative you wish to compare to. Requires -debugreltol and -debugabstol values.</td></tr>
<tr><td><code><font color=#b9b96e>-debugreltol</font></code></td><td>Relative error that controls printing of derivatives comparison if relative error exceeds this value. Requires -debugder and -debugabstol.</td></tr>
<tr><td><code><font color=#b9b96e>-fixed</font></code></td><td>Specify that parameter is fixed during optimization, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-lowlim</font></code></td><td>Specify lower limit for parameter, must be lower than upper limit if upper limit is provided, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-relstep</font></code></td><td>The <em>relative</em> step size to be used in calculating the numerical derivatives. This number is the fractional size of the step, compared to the parameter value. This value supercedes the -step setting. If the parameter is zero, then a default step size is chosen.</td></tr>
<tr><td><code><font color=#b9b96e>-side</font></code></td><td>The sidedness of the finite difference when computing numerical derivatives. This field can take four values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h, left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an : user-computed explicit derivatives, where h is the -step parameter described above. The &quot;automatic&quot; one-sided derivative method will chose a direction for the finite difference which does not violate any constraints. The other methods do not perform this check. The two-sided method is in principle more precise, but requires twice as many function evaluations. Default is auto.</td></tr>
<tr><td><code><font color=#b9b96e>-step</font></code></td><td>The step size to be used in calculating the numerical derivatives.  If set to zero, then the step size is computed automatically, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-uplim</font></code></td><td>Specify upper limit for parameter, must be higher than lower limit if lower limit is provided, optional.</td></tr>
<tr><td><code>initval</code></td><td>Initial value of parameter.</td></tr>
<tr><td><code>name</code></td><td>Name of the parameter.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Example of building 4 parameters with different constraints:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#ffa500>set</font></b> par0 [::tclopt::ParameterMpfit new a 1.0 <font color=#b9b96e>-fixed</font> <font color=#b9b96e>-side</font> both]
<b><font color=#ffa500>set</font></b> par1 [::tclopt::ParameterMpfit new b 2.0]
<b><font color=#ffa500>set</font></b> par2 [::tclopt::ParameterMpfit new c 0.0 <font color=#b9b96e>-fixed</font>]
<b><font color=#ffa500>set</font></b> par3 [::tclopt::ParameterMpfit new d 0.1 <font color=#b9b96e>-lowlim</font> -0.3 <font color=#b9b96e>-uplim</font> 0.2]
</pre>

</figure><div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_ParameterMpfit_constructor' href="javascript:toggleSource('tclopt_ParameterMpfit_constructor')">Show source</a></p>
<div id='tclopt_ParameterMpfit_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <i><font color=#76a396># Creates parameter object for [::tclopt::Mpfit] class.</font></i>
    <i><font color=#76a396>#  name - name of the parameter</font></i>
    <i><font color=#76a396>#  initval - initial value of parameter</font></i>
    <i><font color=#76a396>#  -fixed - specify that parameter is fixed during optimization, optional</font></i>
    <i><font color=#76a396>#  -lowlim - specify lower limit for parameter, must be lower than upper limit if upper limit is provided,</font></i>
    <i><font color=#76a396>#    optional</font></i>
    <i><font color=#76a396>#  -uplim - specify upper limit for parameter, must be higher than lower limit if lower limit is provided,</font></i>
    <i><font color=#76a396>#    optional</font></i>
    <i><font color=#76a396>#  -step - the step size to be used in calculating the numerical derivatives.  If set to zero, then the step</font></i>
    <i><font color=#76a396>#    size is computed automatically, optional</font></i>
    <i><font color=#76a396>#  -relstep - the *relative* step size to be used in calculating the numerical derivatives. This number is the</font></i>
    <i><font color=#76a396>#    fractional size of the step, compared to the parameter value. This value supercedes the -step setting.</font></i>
    <i><font color=#76a396>#    If the parameter is zero, then a default step size is chosen.</font></i>
    <i><font color=#76a396>#  -side - the sidedness of the finite difference when computing numerical derivatives. This field can take four</font></i>
    <i><font color=#76a396>#    values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h,</font></i>
    <i><font color=#76a396>#    left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an :</font></i>
    <i><font color=#76a396>#    user-computed explicit derivatives, where h is the -step parameter described above. The &quot;automatic&quot;</font></i>
    <i><font color=#76a396>#    one-sided derivative method will chose a direction for the finite difference which does not violate any</font></i>
    <i><font color=#76a396>#    constraints. The other methods do not perform this check. The two-sided method is in principle more precise,</font></i>
    <i><font color=#76a396>#    but requires twice as many function evaluations. Default is auto.</font></i>
    <i><font color=#76a396>#  -debugder - switch to enable console debug logging of user-computed derivatives, as described above. Note that</font></i>
    <i><font color=#76a396>#    when debugging is enabled, then -side should be set to auto, right, left or both, depending on which</font></i>
    <i><font color=#76a396>#    numerical derivative you wish to compare to. Requires -debugreltol and -debugabstol values.</font></i>
    <i><font color=#76a396>#  -debugreltol - relative error that controls printing of derivatives comparison if relative error exceeds this</font></i>
    <i><font color=#76a396>#    value. Requires -debugder and -debugabstol.</font></i>
    <i><font color=#76a396>#  -debugabstol - absolute error that controls printing of derivatives comparison if absolute error exceeds this</font></i>
    <i><font color=#76a396>#    value. Requires -debugder and -debugreltol.</font></i>
    <i><font color=#76a396># Synopsis: value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value?</font></i>
    <i><font color=#76a396>#   ?-debugder -debugreltol value -debugabstol value?</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Example of building 4 parameters with different constraints:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># set par0 [::tclopt::ParameterMpfit new a 1.0 -fixed -side both]</font></i>
    <i><font color=#76a396># set par1 [::tclopt::ParameterMpfit new b 2.0]</font></i>
    <i><font color=#76a396># set par2 [::tclopt::ParameterMpfit new c 0.0 -fixed]</font></i>
    <i><font color=#76a396># set par3 [::tclopt::ParameterMpfit new d 0.1 -lowlim -0.3 -uplim 0.2]</font></i>
    <i><font color=#76a396># ```</font></i>
    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-pfirst</font> <font color=#b9b96e>-help</font> {Creates parameter object for '::tclopt::Mpfit' class} {
        {<font color=#b9b96e>-fixed</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Specify that parameter is fixed during optimization}}
        {<font color=#b9b96e>-lowlim</font>= <font color=#b9b96e>-help</font> {Specify lower limit for parameter, must be lower than upper limit if upper limit is provided}}
        {<font color=#b9b96e>-uplim</font>= <font color=#b9b96e>-help</font> {Specify upper limit for parameter, must be higher than lower limit if lower limit is provided}}
        {<font color=#b9b96e>-step</font>= <font color=#b9b96e>-help</font> {The step size to be used in calculating the numerical derivatives.  If set to zero, then the size is computed automatically step}}
        {<font color=#b9b96e>-relstep</font>= <font color=#b9b96e>-help</font> {The *relative* step size to be used in calculating the numerical derivatives. This number is the fractional size of the step, compared to the parameter value. This value supercedes the <font color=#b9b96e>-step</font> setting. If the parameter is zero, then a default step size is chosen}}
        {<font color=#b9b96e>-side</font>= <font color=#b9b96e>-enum</font> {auto right left both an} <font color=#b9b96e>-default</font> auto <font color=#b9b96e>-help</font> {The sidedness of the finite difference when computing numerical derivatives. This field can take four values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h, left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an : user-computed explicit derivatives, where h is the <font color=#b9b96e>-step</font> parameter described above. The <font color=#90ee90>&quot;automatic&quot;</font> one-sided derivative method will chose a direction for the finite difference which does not violate any constraints. The other methods do not perform this check. The two-sided method is in principle more precise, but requires twice as many function evaluations. Default is auto}}
        {<font color=#b9b96e>-debugder</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-require</font> {debugreltol debugabstol} <font color=#b9b96e>-help</font> {Switch to enable console debug logging of user-computed derivatives, as described above. Note that when debugging is enabled, then <font color=#b9b96e>-side</font> should be set to auto, right, left or both, depending on which numerical derivative you wish to compare to}}
        {<font color=#b9b96e>-debugreltol</font>= <font color=#b9b96e>-help</font> {Relative error that controls printing of derivatives comparison if relative error exceeds this value}}
        {<font color=#b9b96e>-debugabstol</font>= <font color=#b9b96e>-help</font> {Absolute error that controls printing of derivatives comparison if absolute error exceeds this value}}
        {name <font color=#b9b96e>-help</font> {Name of the parameter}}
        {initval <font color=#b9b96e>-help</font> {Initial value of parameter}}
    }]
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-side</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> side]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$arguments</font> step]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-step</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> step]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$arguments</font> relstep]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-relstep</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> relstep]
    }
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-debugder</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugder]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugder]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-derivreltol</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugreltol]
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-derivabstol</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugabstol]
    }
    <b><font color=#ffa500>set</font></b> params {}
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> fixed]} {
        <b><font color=#ffa500>set</font></b> fixed 1
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#ffa500>set</font></b> fixed 0
    }
    <b><font color=#ffa500>dict</font></b> for {paramName value} <font color=#f1b479>$arguments</font> {
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$paramName</font> ni {name initval side step relstep debugder debugreltol debugabstol fixed}} {
            <b><font color=#ffa500>lappend</font></b> params -<font color=#f1b479>$paramName</font> <font color=#f1b479>$value</font>
        }
    }
    <b><font color=#ffa500>next</font></b> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> name] [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> initval] {<b><font color=#ffa500>*</font></b>}<font color=#f1b479>$params</font>
}</pre></div>
</div></main><nav class='ruff-nav'><ul ><li class='ruff-toc1'><a style='padding-top:2px;' href='index.html'>Start page</a></li>
<li class='ruff-toc1'><a href='index-docindex.html' accesskey='i'>Index</a></li>
<hr>
<li class='ruff-toc1'><a href='index-Examples.html'>Examples</a></li>
<li class='ruff-toc1'><a class='ruff-highlight' href='index-tclopt.html'>tclopt</a></li>
<hr><li class='ruff-toc2'><a href='#::tclopt-Classes'>Classes</a></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::DE'>DE</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DE::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT constructor&lt;/span&gt; &lt;span class='ruff_arg'&gt;<font color=#b9b96e>-funct</font> value <font color=#b9b96e>-strategy</font> value <font color=#b9b96e>-pdata</font> value ?-genmax value? ?-refresh value? ?-np value? ?-f value? ?-cr value? ?-seed value? ?-abstol value? ?-reltol value? ?-debug? ?-random|specified <font color=#b9b96e>-initpop</font> value?&lt;/span&gt;</pre>Creates optimization object that tuns optimization using modified Differential Evolution algorithm.
</span></li><li class='ruff-toc3'><a href='#::tclopt::DE-General advices'>General advices</a></li><li class='ruff-toc3'><a href='#::tclopt::DE-Strategies overview'>Strategies overview</a></li><li class='ruff-toc4'><a href='#::tclopt::DE-Mutation'>Mutation</a></li><li class='ruff-toc4'><a href='#::tclopt::DE-Exponential crossover'>Exponential crossover</a></li><li class='ruff-toc4'><a href='#::tclopt::DE-Binomial crossover'>Binomial crossover</a></li><li class='ruff-toc4'><a href='#::tclopt::DE-Summary of strategies'>Summary of strategies</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DE::addPars'>addPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT addPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DE::getAllPars'>getAllPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets references of all parameters objects.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DE::getAllParsNames'>getAllParsNames</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllParsNames&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets names of all parameters.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DE::run'>run</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT run&lt;/span&gt; </pre>Runs optimization.
</span></li><li class='ruff-toc2'><a href='#::tclopt::DE-Initialize random number generator'>Initialize random number generator</a></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::DuplChecker'>DuplChecker</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DuplChecker::duplListCheck'>duplListCheck</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT duplListCheck&lt;/span&gt; &lt;span class='ruff_arg'&gt;<b><font color=#ffa500>list</font></b>&lt;/span&gt;</pre>Checks if list contains duplicates.
</span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::GSA'>GSA</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::GSA::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;GSA create OBJNAME&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;
&lt;span class='ruff_cmd'&gt;GSA new&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::GSA::addPars'>addPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT addPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::GSA::getAllPars'>getAllPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets references of all parameters objects.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::GSA::getAllParsNames'>getAllParsNames</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllParsNames&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets names of all parameters.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::GSA::run'>run</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT run&lt;/span&gt; </pre></span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT constructor&lt;/span&gt; &lt;span class='ruff_arg'&gt;<font color=#b9b96e>-funct</font> value <font color=#b9b96e>-m</font> value <font color=#b9b96e>-pdata</font> value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value? ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?&lt;/span&gt;</pre>Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::addPars'>addPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT addPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::getAllPars'>getAllPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets references of all parameters objects.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::getAllParsNames'>getAllParsNames</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllParsNames&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets names of all parameters.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::run'>run</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT run&lt;/span&gt; </pre>Runs optimization.
</span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::Parameter'>Parameter</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Parameter::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;<b><font color=#ffa500>Parameter</font></b> create OBJNAME&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;
&lt;span class='ruff_cmd'&gt;<b><font color=#ffa500>Parameter</font></b> new&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::ParameterMpfit'>ParameterMpfit</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::ParameterMpfit::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT constructor&lt;/span&gt; &lt;span class='ruff_arg'&gt;value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value? ?-debugder <font color=#b9b96e>-debugreltol</font> value <font color=#b9b96e>-debugabstol</font> value?&lt;/span&gt;</pre>Creates parameter object for <a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a> class.
</span></li></ul></nav><footer class='ruff-layout-footer ruff-ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div><div>&copy; George Yashin</div></footer>
</div></body></html>
