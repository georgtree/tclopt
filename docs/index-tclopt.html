<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>Tcl wrapper for C optimization procedures</title>
<link rel='stylesheet' type='text/css' href='assets/ruff-min.css' />
<script type='text/javascript' src='assets/ruff-min.js'></script>
</head>
<body>
<div class='ruff-layout'>
<header class='ruff-layout-header ruff-hd'>
<a style='text-decoration:none;' href='index.html'>Tcl wrapper for C optimization procedures (v0.21)</a>


            <div id="ruffButtonBar">
            <button id="ruffNavMove" onclick="ruffMoveNavPane()"></button>
            <button id="ruffToggleTheme" onclick="ruffNextTheme()"></button>
            </div>
        </header><main class='ruff-layout-main ruff-bd'><h1 class='ruff'><a name='::tclopt'></a>::tclopt<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h1>
<div style='clear:both;'></div>
<h2 class='ruff'><a name='::tclopt-Classes'></a>Classes<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h2>
<div style='clear:both;'></div>
<h3 class='ruffclass'><a name='::tclopt::DuplChecker'>DuplChecker</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="duplListCheck" class='ruff_cmd'>duplListCheck</a></td><td>Checks if list contains duplicates.</td></tr>
</table>
<h5 class='ruff'>Subclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::Mpfit" title="Mpfit" class='ruff_cmd'>Mpfit</a></p>
<h4 class='ruffmethod'><a name='::tclopt::DuplChecker::duplListCheck'>duplListCheck</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::DuplChecker" title="::tclopt::DuplChecker" class='ruff_cmd'>::tclopt::DuplChecker</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::DuplChecker'>DuplChecker</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if list contains duplicates.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT duplListCheck</span> <span class='ruff_arg'>list</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><b><font color=#ffa500>list</font></b></code></td><td>List to check.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>0 if there are no duplicates and 1 if there are.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_DuplChecker_duplListCheck' href="javascript:toggleSource('tclopt_DuplChecker_duplListCheck')">Show source</a></p>
<div id='tclopt_DuplChecker_duplListCheck' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> duplListCheck {<b><font color=#ffa500>list</font></b>} {

    <i><font color=#76a396># Checks if list contains duplicates.</font></i>
    <i><font color=#76a396>#  list - list to check</font></i>
    <i><font color=#76a396># Returns: 0 if there are no duplicates and 1 if there are.</font></i>
    <b><font color=#ffa500>set</font></b> itemDup {}
    <b><font color=#ffa500>set</font></b> new {}
    <b><font color=#ffa500>foreach</font></b> item <font color=#f1b479>$list</font> {
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>lsearch</font></b> <font color=#f1b479>$new</font> <font color=#f1b479>$item</font>] &lt; 0} {
            <b><font color=#ffa500>lappend</font></b> new <font color=#f1b479>$item</font>
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> itemDup <font color=#f1b479>$item</font>
            <b><font color=#fe6efe>break</font></b>
        }
    }
    <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$itemDup</font>
}</pre></div>
</div></details>
<h3 class='ruffclass'><a name='::tclopt::Mpfit'>Mpfit</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::addPars" title="addPars" class='ruff_cmd'>addPars</a></td><td>Not documented.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
<tr><td><code>duplListCheck</code></td><td>See <a href="index-tclopt.html#::tclopt::DuplChecker::duplListCheck" title="DuplChecker.duplListCheck" class='ruff_cmd'>DuplChecker.duplListCheck</a></td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::getAllPars" title="getAllPars" class='ruff_cmd'>getAllPars</a></td><td>Gets references of all parameters objects.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::getAllParsNames" title="getAllParsNames" class='ruff_cmd'>getAllParsNames</a></td><td>Gets names of all parameters.</td></tr>
<tr><td><a href="index-tclopt.html#::tclopt::Mpfit::run" title="run" class='ruff_cmd'>run</a></td><td>Runs optimization.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-covtol</font></code>, <code><font color=#b9b96e>-epsfcn</font></code>, <code><font color=#b9b96e>-ftol</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-gtol</font></code>, <code><font color=#b9b96e>-m</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-nofinitecheck</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-stepfactor</font></code>, <code><font color=#b9b96e>-xtol</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-covtol</font></code>, <code><font color=#b9b96e>-epsfcn</font></code>, <code><font color=#b9b96e>-ftol</font></code>, <code><font color=#b9b96e>-funct</font></code>, <code><font color=#b9b96e>-gtol</font></code>, <code><font color=#b9b96e>-m</font></code>, <code><font color=#b9b96e>-maxfev</font></code>, <code><font color=#b9b96e>-maxiter</font></code>, <code><font color=#b9b96e>-nofinitecheck</font></code>, <code><font color=#b9b96e>-pdata</font></code>, <code><font color=#b9b96e>-results</font></code>, <code><font color=#b9b96e>-stepfactor</font></code>, <code><font color=#b9b96e>-xtol</font></code></p>
<h5 class='ruff'>Mixins</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::DuplChecker" title="DuplChecker" class='ruff_cmd'>DuplChecker</a></p>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT constructor</span> <span class='ruff_arg'>-funct value -m value -pdata value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value? ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><font color=#b9b96e>-covtol</font></code></td><td>Range tolerance for covariance calculation. Value must be of the type float more than zero, default is 1e-14.</td></tr>
<tr><td><code><font color=#b9b96e>-epsfcn</font></code></td><td>Finite derivative step size. Value must be of the type float more than zero, default is 2.2204460e-16.</td></tr>
<tr><td><code><font color=#b9b96e>-ftol</font></code></td><td>Control termination of mpfit. Termination occurs when both the actual and predicted relative reductions in the sum of squares are at most ftol. Therefore, ftol measures the relative error desired in the sum of squares. Value must be of the type float more than zero, default is 1e-10.</td></tr>
<tr><td><code><font color=#b9b96e>-funct</font></code></td><td>Name of the procedure that should be minimized.</td></tr>
<tr><td><code><font color=#b9b96e>-gtol</font></code></td><td>Control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any column of the jacobian is at most gtol in absolute value. Therefore, gtol measures the orthogonality desired between the function vector and the columns of the jacobian. Value must be of the type float more than zero, default is 1e-10.</td></tr>
<tr><td><code><font color=#b9b96e>-m</font></code></td><td>Number of data points.</td></tr>
<tr><td><code><font color=#b9b96e>-maxfev</font></code></td><td>Control termination of mpfit. Termination occurs when the number of calls to funct is at least maxfev by the end of an iteration. Value must be the positive integer, default is 0. If it equals to 0, number of evaluations is not restricted.</td></tr>
<tr><td><code><font color=#b9b96e>-maxiter</font></code></td><td>Maximum number of iterations. If maxiter equal to 0, then basic error checking is done, and parameter errors/covariances are estimated based on input arameter values, but no fitting iterations are done. Value must be the positive integer, default is 200.</td></tr>
<tr><td><code><font color=#b9b96e>-nofinitecheck</font></code></td><td>Enable check for infinite quantities, default is off.</td></tr>
<tr><td><code><font color=#b9b96e>-pdata</font></code></td><td>List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification.</td></tr>
<tr><td><code><font color=#b9b96e>-stepfactor</font></code></td><td>Used in determining the initial step bound. This bound is set to the product of factor and the euclidean norm of diag*x if nonzero, or else to factor itself. In most cases factor should lie in the interval (.1,100.). 100. is a generally recommended value. Value must be of the type float more than zero, default is 100.</td></tr>
<tr><td><code><font color=#b9b96e>-xtol</font></code></td><td>Control termination of mpfit. Termination occurs when the relative error between two consecutive iterates is at most xtol. Therefore, xtol measures the relative error desired in the approximate solution. Value must be of the type float more than zero, default is 1e-10.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Class uses the Levenberg-Marquardt technique to solve the least-squares problem. In its typical use, it will be used to fit a user-supplied function (the &quot;model&quot;) to user-supplied data points (the &quot;data&quot;) by adjusting a set of parameters. mpfit is based upon MINPACK-1 (LMDIF.F) by More' and collaborators. The user-supplied function should compute an array of weighted deviations between model and data. In a typical scientific problem the residuals should be weighted so that each deviate has a gaussian sigma of 1.0. If x represents values of the independent variable, y represents a measurement for each value of x, and err represents the error in the measurements, then the deviates could be calculated as follows:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
    <b><font color=#ffa500>lset</font></b> deviates <font color=#f1b479>$i</font> [<b><font color=#ffa500>expr</font></b> {([<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$y</font> <font color=#f1b479>$i</font>] - [f [<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]])/[<b><font color=#ffa500>lindex</font></b> <font color=#f1b479>$err</font> <font color=#f1b479>$i</font>]}]
}
</pre>

</figure><p class='ruff'>where m is the number of data points, and where f is the function representing the model evaluated at x. If ERR are the 1-sigma uncertainties in Y, then the sum of deviates squared will be the total chi-squared value, which mpfit will seek to minimize. Simple constraints are placed on parameter values by adding objects of class <a href="index-tclopt.html#::tclopt::ParameterMpfit" title="::tclopt::ParameterMpfit" class='ruff_cmd'>::tclopt::ParameterMpfit</a> to mpfit with method [:tclopt::Mpfit::addPars], where other parameter-specific options can be set. For details of how to specify constraints, please look at the description of [::tclopt::parCreate] procedure. Please note, that order in which we attach parameters objects is the order in which values will be supplied to minimized function, and the order in which resulted will be written to X property of the class. Example of user defined function (using linear equation t=a+b*x):</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#fe6efe>proc</font></b> f {xall pdata args} {
    <b><font color=#ffa500>set</font></b> x [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> x]
    <b><font color=#ffa500>set</font></b> y [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> y]
    <b><font color=#ffa500>set</font></b> ey [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> ey]
    <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
        <b><font color=#ffa500>set</font></b> f [= {[@ <font color=#f1b479>$xall</font> 0]+[@ <font color=#f1b479>$xall</font> 1]*<font color=#f1b479>$xVal</font>}]
        <b><font color=#ffa500>lappend</font></b> fval [= {(<font color=#f1b479>$yVal</font>-<font color=#f1b479>$f</font>)/<font color=#f1b479>$eyVal</font>}]
    }
    <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fval</font>]
}
</pre>

</figure><p class='ruff'>where xall is list of initial parameters values, pdata - dictionary that contains x, y and ey lists with length m. It returns dictionary with residuals values. Alternative form of function f could also provide analytical derivatives:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#fe6efe>proc</font></b> quadfunc {xall pdata args} {
    <b><font color=#ffa500>set</font></b> x [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> x]
    <b><font color=#ffa500>set</font></b> y [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> y]
    <b><font color=#ffa500>set</font></b> ey [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$pdata</font> ey]
    <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
        <b><font color=#ffa500>lappend</font></b> fvec [= {(<font color=#f1b479>$yVal</font>-[@ <font color=#f1b479>$xall</font> 0]-[@ <font color=#f1b479>$xall</font> 1]*<font color=#f1b479>$xVal</font>-[@ <font color=#f1b479>$xall</font> 2]*<font color=#f1b479>$xVal</font>*<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
    }
    <b><font color=#ffa500>if</font></b> {[@ <font color=#f1b479>$args</font> 0]!=<font color=#90ee90>&quot;&quot;</font>} {
        <b><font color=#ffa500>set</font></b> derivs [@ <font color=#f1b479>$args</font> 0]
        <b><font color=#ffa500>foreach</font></b> deriv <font color=#f1b479>$derivs</font> {
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==0} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {-1/<font color=#f1b479>$eyVal</font>}]
                }
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==1} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {(-<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
                }
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$deriv</font>==2} {
                <b><font color=#ffa500>foreach</font></b> xVal <font color=#f1b479>$x</font> yVal <font color=#f1b479>$y</font> eyVal <font color=#f1b479>$ey</font> {
                    <b><font color=#ffa500>lappend</font></b> dvec [= {(-<font color=#f1b479>$xVal</font>*<font color=#f1b479>$xVal</font>)/<font color=#f1b479>$eyVal</font>}]
                }
            }
        }
        <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fvec</font> dvec <font color=#f1b479>$dvec</font>]
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [<b><font color=#ffa500>dcreate</font></b> fvec <font color=#f1b479>$fvec</font>]
    }
}
</pre>

</figure><p class='ruff'>The first element of the <code>args</code> list is a list specifying the ordinal numbers of the parameters for which we need to calculate the analytical derivative. In this case, the returned <code>dvec</code> list contains the derivative at each x point for each specified parameter, following the same order as in the input list. For example, if the input list is {0, 2} and the number m of x points is 3, the <code>dvec</code> list will look like this:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'>⎛⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞  ⎞
⎜⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟  ⎟
⎜⎝dp0⎠   ⎝dp0⎠   ⎝dp0⎠   ⎝dp2⎠   ⎝dp2⎠   ⎝dp2⎠  ⎟
⎝     x0      x1      x2      x0      x1      x2⎠
</pre>

</figure><p class='ruff'>Description of keys and data in returned dictionary:</p>
<table class='ruff_deflist'>
<tr><td>-bestnorm</td><td>Final chi^2.</td></tr>
<tr><td>-orignorm</td><td>Starting value of chi^2.</td></tr>
<tr><td>-status</td><td>Fitting status code.</td></tr>
<tr><td>-niter</td><td>Number of iterations.</td></tr>
<tr><td>-nfev</td><td>Number of function evaluations.</td></tr>
<tr><td>-npar</td><td>Total number of parameters.</td></tr>
<tr><td>-nfree</td><td>Number of free parameters.</td></tr>
<tr><td>-npegged</td><td>Number of pegged parameters.</td></tr>
<tr><td>-nfunc</td><td>Number of residuals (= num. of data points)</td></tr>
<tr><td>-resid</td><td>List of final residuals.</td></tr>
<tr><td>-xerror</td><td>Final parameter uncertainties (1-sigma), in the order of elements in <code>Pars</code> property dictionary.</td></tr>
<tr><td>-x</td><td>Final parameters values list in the order of elements in <code>Pars</code> property dictionary.</td></tr>
<tr><td>-debug</td><td>String with derivatives debugging output.</td></tr>
<tr><td>-covar</td><td>Final parameters covariance matrix.</td></tr>
</table>
<p class='ruff'>You can also access all results by [my configure propertyName] mechanism.</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>object of class</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_constructor' href="javascript:toggleSource('tclopt_Mpfit_constructor')">Show source</a></p>
<div id='tclopt_Mpfit_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <i><font color=#76a396># Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.</font></i>
    <i><font color=#76a396>#  -funct - name of the procedure that should be minimized</font></i>
    <i><font color=#76a396>#  -m - number of data points</font></i>
    <i><font color=#76a396>#  -pdata - list or dictionary that provides private data to funct that is needed to evaluate residuals. Usually</font></i>
    <i><font color=#76a396>#    it contains x and y values lists, but you can provide any data necessary for function residuals evaluation.</font></i>
    <i><font color=#76a396>#    Will be passed upon each function evaluation without modification.</font></i>
    <i><font color=#76a396>#  -ftol - control termination of mpfit. Termination occurs when both the actual and predicted relative</font></i>
    <i><font color=#76a396>#    reductions in the sum of squares are at most ftol. Therefore, ftol measures the relative error desired</font></i>
    <i><font color=#76a396>#    in the sum of squares. Value must be of the type float more than zero, default is 1e-10.</font></i>
    <i><font color=#76a396>#  -xtol - control termination of mpfit. Termination occurs when the relative error between two consecutive</font></i>
    <i><font color=#76a396>#    iterates is at most xtol. Therefore, xtol measures the relative error desired in the approximate solution.</font></i>
    <i><font color=#76a396>#    Value must be of the type float more than zero, default is 1e-10.</font></i>
    <i><font color=#76a396>#  -gtol - control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any</font></i>
    <i><font color=#76a396>#    column of the jacobian is at most gtol in absolute value. Therefore, gtol measures the orthogonality desired</font></i>
    <i><font color=#76a396>#    between the function vector and the columns of the jacobian. Value must be of the type float more than zero,</font></i>
    <i><font color=#76a396>#    default is 1e-10.</font></i>
    <i><font color=#76a396>#  -maxfev - control termination of mpfit. Termination occurs when the number of calls to funct is at least</font></i>
    <i><font color=#76a396>#    maxfev by the end of an iteration. Value must be the positive integer, default is 0. If it equals to 0,</font></i>
    <i><font color=#76a396>#    number of evaluations is not restricted.</font></i>
    <i><font color=#76a396>#  -stepfactor - used in determining the initial step bound. This bound is set to the product of factor and the</font></i>
    <i><font color=#76a396>#    euclidean norm of diag*x if nonzero, or else to factor itself. In most cases factor should lie in the</font></i>
    <i><font color=#76a396>#    interval (.1,100.). 100. is a generally recommended value. Value must be of the type float more than zero,</font></i>
    <i><font color=#76a396>#    default is 100.</font></i>
    <i><font color=#76a396>#  -covtol - range tolerance for covariance calculation. Value must be of the type float more than zero, default</font></i>
    <i><font color=#76a396>#    is 1e-14.</font></i>
    <i><font color=#76a396>#  -maxiter - maximum number of iterations. If maxiter equal to 0, then basic error checking is done, and</font></i>
    <i><font color=#76a396>#    parameter errors/covariances are estimated based on input arameter values, but no fitting iterations are</font></i>
    <i><font color=#76a396>#    done. Value must be the positive integer, default is 200.</font></i>
    <i><font color=#76a396>#  -epsfcn - finite derivative step size. Value must be of the type float more than zero, default is</font></i>
    <i><font color=#76a396>#    2.2204460e-16.</font></i>
    <i><font color=#76a396>#  -nofinitecheck - enable check for infinite quantities, default is off.</font></i>
    <i><font color=#76a396># Returns: object of class</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Class uses the Levenberg-Marquardt technique to solve the least-squares problem. In its typical use, it will</font></i>
    <i><font color=#76a396># be used to fit a user-supplied function (the &quot;model&quot;) to user-supplied data points (the &quot;data&quot;) by adjusting a</font></i>
    <i><font color=#76a396># set of parameters. mpfit is based upon MINPACK-1 (LMDIF.F) by More' and collaborators.</font></i>
    <i><font color=#76a396># The user-supplied function should compute an array of weighted deviations between model and data. In a typical</font></i>
    <i><font color=#76a396># scientific problem the residuals should be weighted so that each deviate has a gaussian sigma of 1.0. If x</font></i>
    <i><font color=#76a396># represents values of the independent variable, y represents a measurement for each value of x, and err</font></i>
    <i><font color=#76a396># represents the error in the measurements, then the deviates could be calculated as follows:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># for {set i 0} {$i&lt;$m} {incr i} {</font></i>
    <i><font color=#76a396>#     lset deviates $i [expr {([lindex $y $i] - [f [lindex $x $i]])/[lindex $err $i]}]</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># where m is the number of data points, and where f is the function representing the model evaluated at x. If ERR</font></i>
    <i><font color=#76a396># are the 1-sigma uncertainties in Y, then the sum of deviates squared will be the total chi-squared value, which</font></i>
    <i><font color=#76a396># mpfit will seek to minimize.</font></i>
    <i><font color=#76a396># Simple constraints are placed on parameter values by adding objects of class [::tclopt::ParameterMpfit] to</font></i>
    <i><font color=#76a396># mpfit with method [:tclopt::Mpfit::addPars], where other parameter-specific options can be set.</font></i>
    <i><font color=#76a396># For details of how to specify constraints, please look at the</font></i>
    <i><font color=#76a396># description of [::tclopt::parCreate] procedure. Please note, that order in which we attach parameters objects</font></i>
    <i><font color=#76a396># is the order in which values will be supplied to minimized function, and the order in which resulted will</font></i>
    <i><font color=#76a396># be written to X property of the class.</font></i>
    <i><font color=#76a396># Example of user defined function (using linear equation t=a+b*x):</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># proc f {xall pdata args} {</font></i>
    <i><font color=#76a396>#     set x [dget $pdata x]</font></i>
    <i><font color=#76a396>#     set y [dget $pdata y]</font></i>
    <i><font color=#76a396>#     set ey [dget $pdata ey]</font></i>
    <i><font color=#76a396>#     foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#         set f [= {[@ $xall 0]+[@ $xall 1]*$xVal}]</font></i>
    <i><font color=#76a396>#         lappend fval [= {($yVal-$f)/$eyVal}]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396>#     return [dcreate fvec $fval]</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># where xall is list of initial parameters values, pdata - dictionary that contains x, y and ey lists with</font></i>
    <i><font color=#76a396># length m. It returns dictionary with residuals values.</font></i>
    <i><font color=#76a396># Alternative form of function f could also provide analytical derivatives:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># proc quadfunc {xall pdata args} {</font></i>
    <i><font color=#76a396>#     set x [dget $pdata x]</font></i>
    <i><font color=#76a396>#     set y [dget $pdata y]</font></i>
    <i><font color=#76a396>#     set ey [dget $pdata ey]</font></i>
    <i><font color=#76a396>#     foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#         lappend fvec [= {($yVal-[@ $xall 0]-[@ $xall 1]*$xVal-[@ $xall 2]*$xVal*$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396>#     if {[@ $args 0]!=&quot;&quot;} {</font></i>
    <i><font color=#76a396>#         set derivs [@ $args 0]</font></i>
    <i><font color=#76a396>#         foreach deriv $derivs {</font></i>
    <i><font color=#76a396>#             if {$deriv==0} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {-1/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#             if {$deriv==1} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {(-$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#             if {$deriv==2} {</font></i>
    <i><font color=#76a396>#                 foreach xVal $x yVal $y eyVal $ey {</font></i>
    <i><font color=#76a396>#                     lappend dvec [= {(-$xVal*$xVal)/$eyVal}]</font></i>
    <i><font color=#76a396>#                 }</font></i>
    <i><font color=#76a396>#             }</font></i>
    <i><font color=#76a396>#         }</font></i>
    <i><font color=#76a396>#         return [dcreate fvec $fvec dvec $dvec]</font></i>
    <i><font color=#76a396>#     } else {</font></i>
    <i><font color=#76a396>#         return [dcreate fvec $fvec]</font></i>
    <i><font color=#76a396>#     }</font></i>
    <i><font color=#76a396># }</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># The first element of the `args` list is a list specifying the ordinal numbers of the parameters for which we</font></i>
    <i><font color=#76a396># need to calculate the analytical derivative. In this case, the returned `dvec` list contains the derivative at</font></i>
    <i><font color=#76a396># each x point for each specified parameter, following the same order as in the input list. For example, if the</font></i>
    <i><font color=#76a396># input list is {0, 2} and the number m of x points is 3, the `dvec` list will look like this:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># ⎛⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞   ⎛df ⎞  ⎞</font></i>
    <i><font color=#76a396># ⎜⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟   ⎜───⎟  ⎟</font></i>
    <i><font color=#76a396># ⎜⎝dp0⎠   ⎝dp0⎠   ⎝dp0⎠   ⎝dp2⎠   ⎝dp2⎠   ⎝dp2⎠  ⎟</font></i>
    <i><font color=#76a396># ⎝     x0      x1      x2      x0      x1      x2⎠</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Description of keys and data in returned dictionary:</font></i>
    <i><font color=#76a396>#   -bestnorm - final chi^2</font></i>
    <i><font color=#76a396>#   -orignorm - starting value of chi^2</font></i>
    <i><font color=#76a396>#   -status - fitting status code</font></i>
    <i><font color=#76a396>#   -niter - number of iterations</font></i>
    <i><font color=#76a396>#   -nfev - number of function evaluations</font></i>
    <i><font color=#76a396>#   -npar - total number of parameters</font></i>
    <i><font color=#76a396>#   -nfree - number of free parameters</font></i>
    <i><font color=#76a396>#   -npegged - number of pegged parameters</font></i>
    <i><font color=#76a396>#   -nfunc - number of residuals (= num. of data points)</font></i>
    <i><font color=#76a396>#   -resid - list of final residuals</font></i>
    <i><font color=#76a396>#   -xerror - final parameter uncertainties (1-sigma), in the order of elements in `Pars` property dictionary.</font></i>
    <i><font color=#76a396>#   -x - final parameters values list in the order of elements in `Pars` property dictionary.</font></i>
    <i><font color=#76a396>#   -debug - string with derivatives debugging output</font></i>
    <i><font color=#76a396>#   -covar - final parameters covariance matrix.</font></i>
    <i><font color=#76a396># You can also access all results by [my configure propertyName] mechanism.</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Synopsis: -funct value -m value -pdata value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value?</font></i>
    <i><font color=#76a396>#   ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?</font></i>
    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-help</font> {Creates optimization object that does least squares fitting using modified  Levenberg-Marquardt algorithm. For more detailed description please see documentation} {
        {<font color=#b9b96e>-funct</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Name of the procedure that should be minimized}}
        {<font color=#b9b96e>-m</font>= <font color=#b9b96e>-required</font> <font color=#b9b96e>-help</font> {Number of data points}}
        {<font color=#b9b96e>-pdata</font>= <font color=#b9b96e>-default</font> {} <font color=#b9b96e>-help</font> {List or dictionary that provides private data to funct that is needed to evaluate residuals. Usually it contains x and y values lists, but you can provide any data necessary for function residuals evaluation. Will be passed upon each function evaluation without modification}}
        {<font color=#b9b96e>-ftol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when both the actual and predicted relative reductions in the sum of squares are at most ftol}}
        {<font color=#b9b96e>-xtol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the relative error between two consecutive iterates is at most xtol}}
        {<font color=#b9b96e>-gtol</font>= <font color=#b9b96e>-default</font> 1e-10 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the cosine of the angle between fvec and any column of the jacobian is at most gtol in absolute value}}
        {<font color=#b9b96e>-stepfactor</font>= <font color=#b9b96e>-default</font> 100 <font color=#b9b96e>-help</font> {Used in determining the initial step bound. This bound is set to the product of factor and the euclidean norm of diag*x if nonzero, or else to factor itself}}
        {<font color=#b9b96e>-covtol</font>= <font color=#b9b96e>-default</font> 1e-14 <font color=#b9b96e>-help</font> {Range tolerance for covariance calculation}}
        {<font color=#b9b96e>-maxiter</font>= <font color=#b9b96e>-default</font> 200 <font color=#b9b96e>-help</font> {Maximum number of iterations}}
        {<font color=#b9b96e>-maxfev</font>= <font color=#b9b96e>-default</font> 0 <font color=#b9b96e>-help</font> {Control termination of mpfit. Termination occurs when the number of calls to funct is at least maxfev by the end of an iteration. If it equals to 0, number of evaluations is not restricted}}
        {<font color=#b9b96e>-epsfcn</font>= <font color=#b9b96e>-default</font> 2.2204460e-16 <font color=#b9b96e>-help</font> {Finite derivative step size}}
        {<font color=#b9b96e>-nofinitecheck</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Enable check for infinite quantities}}
    }]
    <b><font color=#ffa500>dict</font></b> for {elName elValue} <font color=#f1b479>$arguments</font> {
        <b><font color=#fe6efe>my</font></b> configure -<font color=#f1b479>$elName</font> <font color=#f1b479>$elValue</font>
    }
}</pre></div>
</div></details>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::addPars'>addPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT addPars</span> <span class='ruff_arg'>?args?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_addPars' href="javascript:toggleSource('tclopt_Mpfit_addPars')">Show source</a></p>
<div id='tclopt_Mpfit_addPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> addPars {args} {

    argparse <font color=#b9b96e>-help</font> {Attaches parameters to optimizer object} {
        {params <font color=#b9b96e>-catchall</font> <font color=#b9b96e>-help</font> {References to objects of class '::tclopt::ParameterMpfit'}}
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> argClass [<b><font color=#ffa500>info</font></b> object class <font color=#f1b479>$arg</font>]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$argClass</font> ne {::tclopt::ParameterMpfit}} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Only ::tclopt::ParameterMpfit could be added to optimizer, '<font color=#f1b479>$</font>argClass' was provided&quot;</font>
        }
        <b><font color=#ffa500>lappend</font></b> parsNamesList [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#ffa500>lappend</font></b> parsNamesList {<b><font color=#ffa500>*</font></b>}[<b><font color=#fe6efe>my</font></b> getAllParsNames]
    }
    <b><font color=#ffa500>set</font></b> dup [<b><font color=#fe6efe>my</font></b> duplListCheck <font color=#f1b479>$parsNamesList</font>]
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dup</font> ne {}} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Optimizer already contains parameter with name '<font color=#f1b479>$</font>dup'&quot;</font>
    }
    <b><font color=#ffa500>foreach</font></b> arg <font color=#f1b479>$params</font> {
        <b><font color=#ffa500>set</font></b> parName [<font color=#f1b479>$arg</font> configure <font color=#b9b96e>-name</font>]
        <b><font color=#ffa500>dict</font></b> append Pars <font color=#f1b479>$parName</font> <font color=#f1b479>$arg</font>
    }
    <b><font color=#fe6efe>return</font></b>
}</pre></div>
</div></details>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::getAllPars'>getAllPars</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets references of all parameters objects.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllPars</span> <span class='ruff_arg'>?args?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_getAllPars' href="javascript:toggleSource('tclopt_Mpfit_getAllPars')">Show source</a></p>
<div id='tclopt_Mpfit_getAllPars' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllPars {args} {

    <i><font color=#76a396># Gets references of all parameters objects.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets references of all parameters objects. Returns: list of references} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$Pars</font>
    }
}</pre></div>
</div></details>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::getAllParsNames'>getAllParsNames</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets names of all parameters.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT getAllParsNames</span> <span class='ruff_arg'>?args?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of elements names</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_getAllParsNames' href="javascript:toggleSource('tclopt_Mpfit_getAllParsNames')">Show source</a></p>
<div id='tclopt_Mpfit_getAllParsNames' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> getAllParsNames {args} {

    <i><font color=#76a396># Gets names of all parameters.</font></i>
    <i><font color=#76a396># Returns: list of elements names</font></i>
    argparse <font color=#b9b96e>-help</font> {Gets names of all parameters. Returns: list of elements names} {}
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {There are no parameters attached to optimizer}
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#fe6efe>return</font></b> [dkeys <font color=#f1b479>$Pars</font>]
    }
}</pre></div>
</div></details>
<h4 class='ruffmethod'><a name='::tclopt::Mpfit::run'>run</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Runs optimization.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT run</span> </div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Return value</h5><p class='ruff'>dictionary containing resulted data</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Mpfit_run' href="javascript:toggleSource('tclopt_Mpfit_run')">Show source</a></p>
<div id='tclopt_Mpfit_run' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> run {} {

    <i><font color=#76a396># Runs optimization.</font></i>
    <i><font color=#76a396># Returns: dictionary containing resulted data</font></i>
    <b><font color=#ffa500>set</font></b> sideMap [<b><font color=#ffa500>dict</font></b> create auto 0 right 1 left -1 both 2 an 3]
    <b><font color=#ffa500>if</font></b> {![<b><font color=#ffa500>info</font></b> exists Pars]} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {At least one parameter must be attached to optimizer before call to run}
    }
    <b><font color=#ffa500>set</font></b> pars [dvalues [<b><font color=#fe6efe>my</font></b> getAllPars]]
    <b><font color=#ffa500>set</font></b> npar [<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$pars</font>]
    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
        <b><font color=#ffa500>lappend</font></b> xall [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-initval</font>]
    }
    <b><font color=#ffa500>set</font></b> qanylim false
    <b><font color=#ffa500>set</font></b> npegged 0
    <b><font color=#ffa500>set</font></b> nfev 0
    <b><font color=#ffa500>set</font></b> info 0
    <b><font color=#ffa500>set</font></b> fnorm -1.0
    <b><font color=#ffa500>set</font></b> fnorm1 -1.0
    <b><font color=#ffa500>set</font></b> xnorm -1.0
    <b><font color=#ffa500>set</font></b> delta 0.0
    <b><font color=#ffa500>foreach</font></b> par <font color=#f1b479>$pars</font> {
        <b><font color=#ffa500>if</font></b> {[<font color=#f1b479>$par</font> configure <font color=#b9b96e>-fixed</font>]} {
            <b><font color=#ffa500>lappend</font></b> pfixed true
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> pfixed false
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-step</font>}]} {
            <b><font color=#ffa500>lappend</font></b> step 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> step [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-step</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-relstep</font>}]} {
            <b><font color=#ffa500>lappend</font></b> dstep 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> dstep [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-relstep</font>]
        }
        <b><font color=#ffa500>lappend</font></b> mpside [<b><font color=#ffa500>dict</font></b> get <font color=#f1b479>$sideMap</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-side</font>]]
        <b><font color=#ffa500>if</font></b> {![<font color=#f1b479>$par</font> configure <font color=#b9b96e>-debugder</font>]} {
            <b><font color=#ffa500>lappend</font></b> ddebug 0
            <b><font color=#ffa500>lappend</font></b> ddrtol 0
            <b><font color=#ffa500>lappend</font></b> ddatol 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lappend</font></b> ddebug 1
            <b><font color=#ffa500>lappend</font></b> ddrtol [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-derivreltol</font>]
            <b><font color=#ffa500>lappend</font></b> ddatol [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-derivabstol</font>]
        }
    }
    <i><font color=#76a396># Finish up the free parameters</font></i>
    <b><font color=#ffa500>set</font></b> nfree 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> ifree 0
    }
    <b><font color=#ffa500>set</font></b> j 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>if</font></b> {![@ <font color=#f1b479>$pfixed</font> <font color=#f1b479>$i</font>]} {
            <b><font color=#ffa500>incr</font></b> nfree
            <b><font color=#ffa500>lset</font></b> ifree <font color=#f1b479>$j</font> <font color=#f1b479>$i</font>
            <b><font color=#ffa500>incr</font></b> j
        }
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nfree</font>==0} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {All parameters are fixed, optimization is not possible}
    }
    <i><font color=#76a396># allocate lists with zeros</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> qllim 0
        <b><font color=#ffa500>lappend</font></b> qulim 0
        <b><font color=#ffa500>lappend</font></b> llim 0
        <b><font color=#ffa500>lappend</font></b> ulim 0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>]]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>}]} {
            <b><font color=#ffa500>lset</font></b> qllim <font color=#f1b479>$i</font> 0
            <b><font color=#ffa500>lset</font></b> llim <font color=#f1b479>$i</font> 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lset</font></b> qllim <font color=#f1b479>$i</font> 1
            <b><font color=#ffa500>lset</font></b> llim <font color=#f1b479>$i</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>}]} {
            <b><font color=#ffa500>lset</font></b> qulim <font color=#f1b479>$i</font> 0
            <b><font color=#ffa500>lset</font></b> ulim <font color=#f1b479>$i</font> 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>lset</font></b> qulim <font color=#f1b479>$i</font> 1
            <b><font color=#ffa500>lset</font></b> ulim <font color=#f1b479>$i</font> [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
        }
        <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$i</font>) || li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$i</font>)} {
            <b><font color=#ffa500>set</font></b> qanylim true
        }
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$m</font>&lt;<font color=#f1b479>$nfree</font>} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Degree of freedom check failed because of 'm=<font color=#f1b479>$</font>m&gt;=n=<font color=#f1b479>$</font>nfree'&quot;</font>
    }
    <i><font color=#76a396># allocate temporary storage</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> diag 0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> wa4 0
    }
    <b><font color=#ffa500>set</font></b> ldfjac <font color=#f1b479>$m</font>
    <i><font color=#76a396># Evaluate user function with initial parameter values</font></i>
    <b><font color=#ffa500>set</font></b> fvec [<b><font color=#ffa500>dget</font></b> [<font color=#f1b479>$funct</font> <font color=#f1b479>$xall</font> <font color=#f1b479>$pdata</font>] fvec]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>llength</font></b> <font color=#f1b479>$fvec</font>]!=<font color=#f1b479>$m</font>} {
        <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error <font color=#90ee90>&quot;Length of list '<font color=#f1b479>[</font>llength <font color=#f1b479>$</font>fvec<font color=#f1b479>]</font>' returned from the function is less than m '<font color=#f1b479>$</font>m' value&quot;</font>
    }
    <b><font color=#ffa500>incr</font></b> nfev
    <b><font color=#ffa500>set</font></b> fnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$fvec</font>]
    <i><font color=#76a396>#puts $fnorm</font></i>
    <b><font color=#ffa500>set</font></b> orignorm [= {<font color=#f1b479>$fnorm</font>*<font color=#f1b479>$fnorm</font>}]
    <i><font color=#76a396># Make a new copy</font></i>
    <b><font color=#ffa500>set</font></b> xnew <font color=#f1b479>$xall</font>
    <i><font color=#76a396># Transfer free parameters to 'x'</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> x [@ <font color=#f1b479>$xall</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>]]
    }
    <i><font color=#76a396># Initialize Levelberg-Marquardt parameter and iteration counter</font></i>
    <b><font color=#ffa500>set</font></b> par 0.0
    <b><font color=#ffa500>set</font></b> iter 1
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lappend</font></b> qtf 0
    }
    <i><font color=#76a396># Beginning of the outer loop</font></i>
    <b><font color=#ffa500>while</font></b> {true} {
        <i><font color=#76a396># puts &quot;beginning of the outer loop&quot;</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> xnew [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]
        }
        <i><font color=#76a396># Calculate the jacobian matrix</font></i>
        <b><font color=#ffa500>set</font></b> fdjac2Data [<b><font color=#fe6efe>my</font></b> Fdjac2 <font color=#f1b479>$funct</font> <font color=#f1b479>$ifree</font> <font color=#f1b479>$nfree</font> <font color=#f1b479>$xnew</font> <font color=#f1b479>$fvec</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$epsfcn</font> <font color=#f1b479>$pdata</font> <font color=#f1b479>$nfev</font> <font color=#f1b479>$step</font> <font color=#f1b479>$dstep</font> <font color=#f1b479>$mpside</font> <font color=#f1b479>$qulim</font> <font color=#f1b479>$ulim</font> <font color=#f1b479>$ddebug</font> <font color=#f1b479>$ddrtol</font> <font color=#f1b479>$ddatol</font>]
        <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> fjac]
        <b><font color=#ffa500>set</font></b> nfev [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> nfev]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$fdjac2Data</font> debug]} {
            <b><font color=#ffa500>lappend</font></b> debugOutput {<b><font color=#ffa500>*</font></b>}[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$fdjac2Data</font> debug]
        }
        <i><font color=#76a396># Determine if any of the parameters are pegged at the limits</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$qanylim</font>} {
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>set</font></b> lpegged [= {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)==li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))}]
                <b><font color=#ffa500>set</font></b> upegged [= {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)==li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))}]
                <b><font color=#ffa500>set</font></b> sum 0
                <i><font color=#76a396># If the parameter is pegged at a limit, compute the gradient direction</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> || <font color=#f1b479>$upegged</font>} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fvec</font>,<font color=#f1b479>$i</font>)*li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)}]
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
                <i><font color=#76a396># If pegged at lower limit and gradient is toward negative then reset gradient to zero</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> && (<font color=#f1b479>$sum</font>&gt;0)} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$ij</font> 0
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
                <i><font color=#76a396># If pegged at upper limit and gradient is toward positive then reset gradient to zero</font></i>
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$upegged</font> && (<font color=#f1b479>$sum</font>&lt;0)} {
                    <b><font color=#ffa500>set</font></b> ij [= {<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>}]
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$ij</font> 0
                        <b><font color=#ffa500>incr</font></b> ij
                    }
                }
            }
        }
        <i><font color=#76a396># Compute the QR factorization of the jacobian</font></i>
        <b><font color=#ffa500>set</font></b> qfracData [<b><font color=#fe6efe>my</font></b> Qfrac <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> 1 <font color=#f1b479>$nfree</font>]
        <b><font color=#ffa500>set</font></b> ipvt [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> ipvt]
        <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> a]
        <b><font color=#ffa500>set</font></b> wa1 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> rdiag]
        <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> acnorm]
        <b><font color=#ffa500>set</font></b> wa3 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$qfracData</font> wa]
        <i><font color=#76a396># on the first iteration and if mode is 1, scale according to the norms of the columns of the initial jacobian.</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>==1} {
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)==0.0} {
                    <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] 1.0
                }
            }
            <i><font color=#76a396># on the first iteration, calculate the norm of the scaled x and initialize the step bound delta.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> xnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]
            <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$stepfactor</font>*<font color=#f1b479>$xnorm</font>}]
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>==0.0} {
                <b><font color=#ffa500>set</font></b> delta <font color=#f1b479>$stepfactor</font>
            }
        }
        <i><font color=#76a396># form (q transpose)*fvec and store the first n components in qtf</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> wa4 <font color=#f1b479>$i</font> [@ <font color=#f1b479>$fvec</font> <font color=#f1b479>$i</font>]
        }
        <b><font color=#ffa500>set</font></b> jj 0
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
            <b><font color=#ffa500>set</font></b> temp3 [@ <font color=#f1b479>$fjac</font> <font color=#f1b479>$jj</font>]
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$temp3</font>!=0.0} {
                <b><font color=#ffa500>set</font></b> sum 0.0
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i <font color=#f1b479>$j</font>} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*li(<font color=#f1b479>$wa4</font>,<font color=#f1b479>$i</font>)}]
                    <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                }
                <b><font color=#ffa500>set</font></b> temp [= {-<font color=#f1b479>$sum</font>/<font color=#f1b479>$temp3</font>}]
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i <font color=#f1b479>$j</font>} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> wa4 <font color=#f1b479>$i</font> [= {li(<font color=#f1b479>$wa4</font>,<font color=#f1b479>$i</font>)+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*<font color=#f1b479>$temp</font>}]
                    <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                }
            }
            <b><font color=#ffa500>lset</font></b> fjac <font color=#f1b479>$jj</font> [@ <font color=#f1b479>$wa1</font> <font color=#f1b479>$j</font>]
            <b><font color=#ffa500>incr</font></b> jj [= {<font color=#f1b479>$m</font>+1}];<i><font color=#76a396> # fjac[j+m*j]&quot;</font></i>
            <b><font color=#ffa500>lset</font></b> qtf <font color=#f1b479>$j</font> [@ <font color=#f1b479>$wa4</font> <font color=#f1b479>$j</font>]
        }
        <i><font color=#76a396># (From this point on, only the square matrix, consisting of the triangle of R, is needed.)</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nofinitecheck</font>} {
            <i><font color=#76a396># Check for overflow.  This should be a cheap test here since FJAC</font></i>
            <i><font color=#76a396># has been reduced to a (small) square matrix, and the test is O(N^2).</font></i>
            <b><font color=#ffa500>set</font></b> off 0
            <b><font color=#ffa500>set</font></b> nonfinite 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$off</font>+<font color=#f1b479>$i</font>)&gt;<font color=#f1b479>$::tclopt::MP_GIANT</font>} {
                        <b><font color=#ffa500>set</font></b> nonfinite 1
                    }
                }
                <b><font color=#ffa500>incr</font></b> off <font color=#f1b479>$ldfjac</font>
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$nonfinite</font>} {
                <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Overflow occured during finite check}
            }
        }
        <i><font color=#76a396># compute the norm of the scaled gradient.</font></i>
        <b><font color=#ffa500>set</font></b> gnorm 0.0
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$fnorm</font>!=0.0} {
            <b><font color=#ffa500>set</font></b> jj 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>set</font></b> l [@ <font color=#f1b479>$ipvt</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$l</font>)!=0.0} {
                    <b><font color=#ffa500>set</font></b> sum 0.0
                    <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;=<font color=#f1b479>$j</font>} {<b><font color=#ffa500>incr</font></b> i} {
                        <b><font color=#ffa500>set</font></b> sum [= {<font color=#f1b479>$sum</font>+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*li(<font color=#f1b479>$qtf</font>,<font color=#f1b479>$i</font>)/<font color=#f1b479>$fnorm</font>}]
                        <b><font color=#ffa500>incr</font></b> ij;<i><font color=#76a396> # fjac[i+m*j]</font></i>
                    }
                    <b><font color=#ffa500>set</font></b> gnorm [<b><font color=#fe6efe>my</font></b> Dmax1 <font color=#f1b479>$gnorm</font> [= {abs(<font color=#f1b479>$sum</font>/li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$l</font>))}]]
                }
                <b><font color=#ffa500>incr</font></b> jj <font color=#f1b479>$m</font>
            }
        }
        <i><font color=#76a396># test for convergence of the gradient norm.</font></i>
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$gnorm</font>&lt;=<font color=#f1b479>$gtol</font>} {
            <b><font color=#ffa500>set</font></b> info {Convergence in orthogonality}
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
            <b><font color=#fe6efe>break</font></b>
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$maxiter</font>==0} {
            <b><font color=#ffa500>set</font></b> info {Maximum number of iterations reached}
            <b><font color=#fe6efe>break</font></b>
        }
        <i><font color=#76a396># rescale</font></i>
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
            <b><font color=#ffa500>lset</font></b> diag [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [<b><font color=#fe6efe>my</font></b> Dmax1 [@ <font color=#f1b479>$diag</font> [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>]] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]]
        }
        <i><font color=#76a396># beginning of the inner loop.</font></i>
        <b><font color=#ffa500>while</font></b> {true} {
            <i><font color=#76a396># determine the levenberg-marquardt parameter.</font></i>
            <b><font color=#ffa500>set</font></b> lmparData [<b><font color=#fe6efe>my</font></b> Lmpar <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$ipvt</font> <font color=#f1b479>$ifree</font> <font color=#f1b479>$diag</font> <font color=#f1b479>$qtf</font> <font color=#f1b479>$delta</font> <font color=#f1b479>$par</font>]
            <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> r]
            <b><font color=#ffa500>set</font></b> par [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> par]
            <b><font color=#ffa500>set</font></b> wa1 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> x]
            <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> sdiag]
            <b><font color=#ffa500>set</font></b> wa3 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$lmparData</font> wa1]
            <i><font color=#76a396># store the direction p and x + p. calculate the norm of p.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> [= {<font color=#b9b96e>-li</font>(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> alpha 1.0
            <b><font color=#ffa500>if</font></b> {!<font color=#f1b479>$qanylim</font>} {
                <i><font color=#76a396># No parameter limits, so just move to new position WA2</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
                }
            } <b><font color=#ffa500>else</font></b> {
                <i><font color=#76a396># Respect the limits.  If a step were to go out of bounds, then</font></i>
                <i><font color=#76a396># we should take a step in the same direction but shorter distance.</font></i>
                <i><font color=#76a396># The step should take us right to the limit in that case.</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>set</font></b> lpegged [= {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)&lt;=li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))}]
                    <b><font color=#ffa500>set</font></b> upegged [= {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)&gt;=li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))}]
                    <b><font color=#ffa500>set</font></b> dwa1 [= {abs(li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&gt;<font color=#f1b479>$::tclopt::MP_MACHEP0</font>}]
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lpegged</font> && (li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)&lt;0)} {
                        <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> 0
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$upegged</font> && (li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)&gt;0)} {
                        <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> 0
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dwa1</font> && li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && ((li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&lt;li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>))} {
                        <b><font color=#ffa500>set</font></b> alpha [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$alpha</font> [= {(li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)-li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>))/li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]]
                    }
                    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$dwa1</font> && li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && ((li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>))&gt;li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>))} {
                        <b><font color=#ffa500>set</font></b> alpha [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$alpha</font> [= {(li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)-li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>))/li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]]
                    }
                }
                <i><font color=#76a396># Scale the resulting vector, advance to the next position</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> wa1 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)*<font color=#f1b479>$alpha</font>}]
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)+li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
                    <i><font color=#76a396># Adjust the output values.  If the step put us exactly on a boundary, make sure it is exact.</font></i>
                    <b><font color=#ffa500>set</font></b> sgnu [= {(li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)&gt;=0) ? 1 : -1}]
                    <b><font color=#ffa500>set</font></b> sgnl [= {(li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)&gt;=0) ? 1 : -1}]
                    <b><font color=#ffa500>set</font></b> ulim1 [= {li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)*(1-<font color=#f1b479>$sgnu</font>*<font color=#f1b479>$::tclopt::MP_MACHEP0</font>)- ((li(<font color=#f1b479>$ulim</font>,<font color=#f1b479>$j</font>)==0) ? <font color=#f1b479>$::tclopt::MP_MACHEP0</font> : 0)}]
                    <b><font color=#ffa500>set</font></b> llim1 [= {li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)*(1+<font color=#f1b479>$sgnl</font>*<font color=#f1b479>$::tclopt::MP_MACHEP0</font>)+ ((li(<font color=#f1b479>$llim</font>,<font color=#f1b479>$j</font>)==0) ? <font color=#f1b479>$::tclopt::MP_MACHEP0</font> : 0)}]
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qulim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)&gt;=<font color=#f1b479>$ulim1</font>)} {
                        <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [@ <font color=#f1b479>$ulim</font> <font color=#f1b479>$j</font>]
                    }
                    <b><font color=#ffa500>if</font></b> {li(<font color=#f1b479>$qllim</font>,<font color=#f1b479>$j</font>) && (li(<font color=#f1b479>$wa2</font>,<font color=#f1b479>$j</font>)&lt;=<font color=#f1b479>$llim1</font>)} {
                        <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [@ <font color=#f1b479>$llim</font> <font color=#f1b479>$j</font>]
                    }
                }
            }
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$wa1</font>,<font color=#f1b479>$j</font>)}]
            }
            <b><font color=#ffa500>set</font></b> pnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]
            <i><font color=#76a396># on the first iteration, adjust the initial step bound.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>==1} {
                <b><font color=#ffa500>set</font></b> delta [<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$delta</font> <font color=#f1b479>$pnorm</font>]
            }
            <i><font color=#76a396># evaluate the function at x + p and calculate its norm.</font></i>
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
                <b><font color=#ffa500>lset</font></b> xnew [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$i</font>]
            }
            <b><font color=#ffa500>set</font></b> functData [<font color=#f1b479>$funct</font> <font color=#f1b479>$xnew</font> <font color=#f1b479>$pdata</font>]
            <b><font color=#ffa500>set</font></b> wa4 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$functData</font> fvec]
            <b><font color=#ffa500>incr</font></b> nfev
            <b><font color=#ffa500>set</font></b> fnorm1 [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa4</font>]
            <i><font color=#76a396># compute the scaled actual reduction.</font></i>
            <b><font color=#ffa500>set</font></b> actred -1.0
            <b><font color=#ffa500>if</font></b> {[= {0.1*<font color=#f1b479>$fnorm1</font>}]&lt;<font color=#f1b479>$fnorm</font>} {
                <b><font color=#ffa500>set</font></b> temp [= {<font color=#f1b479>$fnorm1</font>/<font color=#f1b479>$fnorm</font>}]
                <b><font color=#ffa500>set</font></b> actred [= {1.0-<font color=#f1b479>$temp</font>*<font color=#f1b479>$temp</font>}]
            }
            <i><font color=#76a396># compute the scaled predicted reduction and the scaled directional derivative.</font></i>
            <b><font color=#ffa500>set</font></b> jj 0
            <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$j</font> 0.0
                <b><font color=#ffa500>set</font></b> l [@ <font color=#f1b479>$ipvt</font> <font color=#f1b479>$j</font>]
                <b><font color=#ffa500>set</font></b> temp [@ <font color=#f1b479>$wa1</font> <font color=#f1b479>$l</font>]
                <b><font color=#ffa500>set</font></b> ij <font color=#f1b479>$jj</font>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;=<font color=#f1b479>$j</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> wa3 <font color=#f1b479>$i</font> [= {li(<font color=#f1b479>$wa3</font>,<font color=#f1b479>$i</font>)+li(<font color=#f1b479>$fjac</font>,<font color=#f1b479>$ij</font>)*<font color=#f1b479>$temp</font>}]
                    <b><font color=#ffa500>incr</font></b> ij
                }
                <b><font color=#ffa500>incr</font></b> jj <font color=#f1b479>$m</font>
            }
            <i><font color=#76a396># Remember, alpha is the fraction of the full LM step actually taken</font></i>
            <b><font color=#ffa500>set</font></b> temp1 [= {[<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa3</font>]*<font color=#f1b479>$alpha</font>/<font color=#f1b479>$fnorm</font>}]
            <b><font color=#ffa500>set</font></b> temp2 [= {sqrt(<font color=#f1b479>$par</font>*<font color=#f1b479>$alpha</font>)*<font color=#f1b479>$pnorm</font>/<font color=#f1b479>$fnorm</font>}]
            <b><font color=#ffa500>set</font></b> prered [= {<font color=#f1b479>$temp1</font>*<font color=#f1b479>$temp1</font>+(<font color=#f1b479>$temp2</font>*<font color=#f1b479>$temp2</font>)/0.5}]
            <b><font color=#ffa500>set</font></b> dirder [= {-(<font color=#f1b479>$temp1</font>*<font color=#f1b479>$temp1</font>+<font color=#f1b479>$temp2</font>*<font color=#f1b479>$temp2</font>)}]
            <i><font color=#76a396># compute the ratio of the actual to the predicted reduction</font></i>
            <b><font color=#ffa500>set</font></b> ratio 0.0
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$prered</font>!=0.0} {
                <b><font color=#ffa500>set</font></b> ratio [= {<font color=#f1b479>$actred</font>/<font color=#f1b479>$prered</font>}]
            }
            <i><font color=#76a396># update the step bound.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&lt;=0.25} {
                <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$actred</font>&gt;=0.0} {
                    <b><font color=#ffa500>set</font></b> temp 0.5
                } <b><font color=#ffa500>else</font></b> {
                    <b><font color=#ffa500>set</font></b> temp [= {0.5*<font color=#f1b479>$dirder</font>/(<font color=#f1b479>$dirder</font>+0.5*<font color=#f1b479>$actred</font>)}]
                }
                <b><font color=#ffa500>if</font></b> {((0.1*<font color=#f1b479>$fnorm1</font>)&gt;=<font color=#f1b479>$fnorm</font>) || (<font color=#f1b479>$temp</font>&lt;0.1)} {
                    <b><font color=#ffa500>set</font></b> temp 0.1
                }
                <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$temp</font>*[<b><font color=#fe6efe>my</font></b> Dmin1 <font color=#f1b479>$delta</font> [= {<font color=#f1b479>$pnorm</font>/0.1}]]}]
                <b><font color=#ffa500>set</font></b> par [= {<font color=#f1b479>$par</font>/<font color=#f1b479>$temp</font>}]
            } <b><font color=#ffa500>else</font></b> {
                <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$par</font>==0.0) || (<font color=#f1b479>$ratio</font>&gt;=0.75)} {
                    <b><font color=#ffa500>set</font></b> delta [= {<font color=#f1b479>$pnorm</font>/0.5}]
                    <b><font color=#ffa500>set</font></b> par [= {0.5*<font color=#f1b479>$par</font>}]
                }
            }
            <i><font color=#76a396># test for successful iteration.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&gt;=1e-4} {
                <i><font color=#76a396># successful iteration. update x, fvec, and their norms.</font></i>
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
                    <b><font color=#ffa500>lset</font></b> x <font color=#f1b479>$j</font> [@ <font color=#f1b479>$wa2</font> <font color=#f1b479>$j</font>]
                    <i><font color=#76a396>#puts $x</font></i>
                    <b><font color=#ffa500>lset</font></b> wa2 <font color=#f1b479>$j</font> [= {li(<font color=#f1b479>$diag</font>,li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>))*li(<font color=#f1b479>$x</font>,<font color=#f1b479>$j</font>)}]
                }
                <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> i} {
                    <b><font color=#ffa500>lset</font></b> fvec <font color=#f1b479>$i</font> [@ <font color=#f1b479>$wa4</font> <font color=#f1b479>$i</font>]
                }
                <b><font color=#ffa500>set</font></b> xnorm [<b><font color=#fe6efe>my</font></b> Enorm <font color=#f1b479>$wa2</font>]
                <b><font color=#ffa500>set</font></b> fnorm <font color=#f1b479>$fnorm1</font>
                <b><font color=#ffa500>incr</font></b> iter
            }
            <i><font color=#76a396># tests for convergence.</font></i>
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$ftol</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$ftol</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0)} {
                <b><font color=#ffa500>set</font></b> info {Convergence in chi-square value}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>&lt;=(<font color=#f1b479>$xtol</font>*<font color=#f1b479>$xnorm</font>)} {
                <b><font color=#ffa500>set</font></b> info {Convergence in parameter value}
            }
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$ftol</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$ftol</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0) && (<font color=#f1b479>$info</font>==2)} {
                <b><font color=#ffa500>set</font></b> info {Both convergence in parameter value and convergence in chi-square value hold}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
                <b><font color=#fe6efe>break</font></b>
            }
            <i><font color=#76a396># tests for termination and stringent tolerances.</font></i>
            <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$maxfev</font>&gt;0) && (<font color=#f1b479>$nfev</font>&gt;=<font color=#f1b479>$maxfev</font>)} {
                <i><font color=#76a396># Too many function evaluations</font></i>
                <b><font color=#ffa500>set</font></b> info {Maximum number of function evaluations reached}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$iter</font>&gt;=<font color=#f1b479>$maxiter</font>} {
                <i><font color=#76a396># Too many iterations</font></i>
                <b><font color=#ffa500>set</font></b> info {Maximum number of iterations reached}
            }
            <b><font color=#ffa500>if</font></b> {(abs(<font color=#f1b479>$actred</font>)&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>) && (<font color=#f1b479>$prered</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>) && (0.5*<font color=#f1b479>$ratio</font>&lt;=1.0)} {
                <b><font color=#ffa500>set</font></b> info {ftol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$delta</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>*<font color=#f1b479>$xnorm</font>} {
                <b><font color=#ffa500>set</font></b> info {xtol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$gnorm</font>&lt;=<font color=#f1b479>$::tclopt::MP_MACHEP0</font>} {
                <b><font color=#ffa500>set</font></b> info {gtol is too small, no further improvement}
            }
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
                <b><font color=#fe6efe>break</font></b>
            }
            <i><font color=#76a396># end of the inner loop. repeat if iteration unsuccessful.</font></i>
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$ratio</font>&lt;1e-4} {
                <b><font color=#fe6efe>continue</font></b>
            } <b><font color=#ffa500>else</font></b> {
                <b><font color=#fe6efe>break</font></b>
            }
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>!=0} {
            <b><font color=#fe6efe>break</font></b>
        }
    }
    <i><font color=#76a396># termination, either normal or user imposed.</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>lset</font></b> xall [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$i</font>] [@ <font color=#f1b479>$x</font> <font color=#f1b479>$i</font>]
    }
    <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$info</font>&gt;0} {
        <b><font color=#ffa500>set</font></b> functData [<font color=#f1b479>$funct</font> <font color=#f1b479>$xall</font> <font color=#f1b479>$pdata</font>]
        <b><font color=#ffa500>set</font></b> fvec [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$functData</font> fvec]
        <b><font color=#ffa500>incr</font></b> nfev
    }
    <i><font color=#76a396># Compute number of pegged parameters</font></i>
    <b><font color=#ffa500>set</font></b> npegged 0
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> i} {
        <b><font color=#ffa500>set</font></b> par [@ <font color=#f1b479>$pars</font> <font color=#f1b479>$i</font>]
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>}]} {
            <b><font color=#ffa500>set</font></b> parsLim0 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> parsLim0 [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-lowlim</font>]
        }
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>catch</font></b> {<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>}]} {
            <b><font color=#ffa500>set</font></b> parsLim1 0
        } <b><font color=#ffa500>else</font></b> {
            <b><font color=#ffa500>set</font></b> parsLim1 [<font color=#f1b479>$par</font> configure <font color=#b9b96e>-uplim</font>]
        }
        <b><font color=#ffa500>if</font></b> {(<font color=#f1b479>$parsLim0</font> && (<font color=#f1b479>$parsLim0</font>==li(<font color=#f1b479>$xall</font>,<font color=#f1b479>$i</font>))) || (<font color=#f1b479>$parsLim1</font> && (<font color=#f1b479>$parsLim1</font>==li(<font color=#f1b479>$xall</font>,<font color=#f1b479>$i</font>)))} {
            <b><font color=#ffa500>incr</font></b> npegged
        }
    }
    <i><font color=#76a396># Compute and return the covariance matrix and/or parameter errors</font></i>
    <b><font color=#ffa500>set</font></b> covarData [<b><font color=#fe6efe>my</font></b> Covar <font color=#f1b479>$nfree</font> <font color=#f1b479>$fjac</font> <font color=#f1b479>$ldfjac</font> <font color=#f1b479>$ipvt</font> <font color=#f1b479>$covtol</font>]
    <b><font color=#ffa500>set</font></b> fjac [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$covarData</font> r]
    <b><font color=#ffa500>set</font></b> wa2 [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$covarData</font> wa]
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$npar</font>*<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> covar 0.0
    }
    <i><font color=#76a396># Transfer the covariance array</font></i>
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> i 0} {<font color=#f1b479>$i</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> i} {
            <b><font color=#ffa500>lset</font></b> covar [= {int(li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$j</font>)*<font color=#f1b479>$npar</font>+li(<font color=#f1b479>$ifree</font>,<font color=#f1b479>$i</font>))}] [@ <font color=#f1b479>$fjac</font> [= {int(<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>+<font color=#f1b479>$i</font>)}]]
        }
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$npar</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> xerror 0.0
    }
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$nfree</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>set</font></b> cc [@ <font color=#f1b479>$fjac</font> [= {int(<font color=#f1b479>$j</font>*<font color=#f1b479>$ldfjac</font>+<font color=#f1b479>$j</font>)}]]
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$cc</font>&gt;0} {
            <b><font color=#ffa500>lset</font></b> xerror [@ <font color=#f1b479>$ifree</font> <font color=#f1b479>$j</font>] [= {sqrt(<font color=#f1b479>$cc</font>)}]
        }
    }
    <b><font color=#ffa500>set</font></b> bestnorm [= {[<b><font color=#fe6efe>my</font></b> Dmax1 <font color=#f1b479>$fnorm</font> <font color=#f1b479>$fnorm1</font>]**2}]
    <b><font color=#ffa500>for</font></b> {<b><font color=#ffa500>set</font></b> j 0} {<font color=#f1b479>$j</font>&lt;<font color=#f1b479>$m</font>} {<b><font color=#ffa500>incr</font></b> j} {
        <b><font color=#ffa500>lappend</font></b> resid [@ <font color=#f1b479>$fvec</font> <font color=#f1b479>$j</font>]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists debugOutput]} {
        <b><font color=#ffa500>set</font></b> debugOutput [<b><font color=#ffa500>join</font></b> <font color=#f1b479>$debugOutput</font> \n]
    } <b><font color=#ffa500>else</font></b> {
        <b><font color=#ffa500>set</font></b> debugOutput {}
    }
    <b><font color=#ffa500>set</font></b> resDict [<b><font color=#ffa500>dcreate</font></b> bestnorm <font color=#f1b479>$bestnorm</font> orignorm <font color=#f1b479>$orignorm</font> status <font color=#f1b479>$info</font> niter <font color=#f1b479>$iter</font> nfev <font color=#f1b479>$nfev</font> npar <font color=#f1b479>$npar</font> nfree <font color=#f1b479>$nfree</font> npegged <font color=#f1b479>$npegged</font> nfunc <font color=#f1b479>$m</font> resid <font color=#f1b479>$resid</font> xerror <font color=#f1b479>$xerror</font> x <font color=#f1b479>$xall</font> debug <font color=#f1b479>$debugOutput</font> covar <font color=#f1b479>$covar</font>]
    <b><font color=#ffa500>set</font></b> results <font color=#f1b479>$resDict</font>
    <b><font color=#fe6efe>return</font></b> <font color=#f1b479>$resDict</font>
}</pre></div>
</div></details>
<h3 class='ruffclass'><a name='::tclopt::Parameter'>Parameter</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::Parameter::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<h5 class='ruff'>Subclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::ParameterMpfit" title="ParameterMpfit" class='ruff_cmd'>ParameterMpfit</a></p>
<h4 class='ruffmethod'><a name='::tclopt::Parameter::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::Parameter" title="::tclopt::Parameter" class='ruff_cmd'>::tclopt::Parameter</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::Parameter'>Parameter</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>Parameter create OBJNAME</span> <span class='ruff_arg'>?args?</span><br><span class='ruff_cmd'>Parameter new</span> <span class='ruff_arg'>?args?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_Parameter_constructor' href="javascript:toggleSource('tclopt_Parameter_constructor')">Show source</a></p>
<div id='tclopt_Parameter_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    argparse <font color=#b9b96e>-pfirst</font> {
        {<font color=#b9b96e>-fixed</font> <font color=#b9b96e>-boolean</font>}
        <font color=#b9b96e>-lowlim</font>=
        <font color=#b9b96e>-uplim</font>=
        name
        initval
    }
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-fixed</font> <font color=#f1b479>$fixed</font> <font color=#b9b96e>-initval</font> <font color=#f1b479>$initval</font> <font color=#b9b96e>-name</font> <font color=#f1b479>$name</font>
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists lowlim]} {
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lowlim</font>&gt;<font color=#f1b479>$initval</font>} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Initial value must be higher than the lower limit}
        }
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-lowlim</font> <font color=#f1b479>$lowlim</font>
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists uplim]} {
        <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>info</font></b> exists lowlim]} {
            <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$lowlim</font>&gt;=<font color=#f1b479>$uplim</font>} {
                <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Lower limit must be lower than the upper limit}
            }
        }
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$uplim</font>&lt;<font color=#f1b479>$initval</font>} {
            <b><font color=#fe6efe>return</font></b> <font color=#b9b96e>-code</font> error {Initial value must be lower than the upper limit}
        }
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-uplim</font> <font color=#f1b479>$uplim</font>
    }
}</pre></div>
</div></details>
<h3 class='ruffclass'><a name='::tclopt::ParameterMpfit'>ParameterMpfit</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt" title="::tclopt" class='ruff_cmd'>::tclopt</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<h5 class='ruff'>Method summary</h5><table class='ruff_deflist'>
<tr><td><a href="index-tclopt.html#::tclopt::ParameterMpfit::constructor" title="constructor" class='ruff_cmd'>constructor</a></td><td>Constructor for the class.</td></tr>
<tr><td><code>configure</code></td><td>Configure properties.</td></tr>
</table>
<h5 class='ruff'>Properties</h5><p class='ruff'>Readable: <code><font color=#b9b96e>-debugder</font></code>, <code><font color=#b9b96e>-derivabstol</font></code>, <code><font color=#b9b96e>-derivreltol</font></code>, <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-relstep</font></code>, <code><font color=#b9b96e>-side</font></code>, <code><font color=#b9b96e>-step</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<p class='ruff'>Writable: <code><font color=#b9b96e>-debugder</font></code>, <code><font color=#b9b96e>-derivabstol</font></code>, <code><font color=#b9b96e>-derivreltol</font></code>, <code><font color=#b9b96e>-fixed</font></code>, <code><font color=#b9b96e>-initval</font></code>, <code><font color=#b9b96e>-lowlim</font></code>, <code><font color=#b9b96e>-name</font></code>, <code><font color=#b9b96e>-relstep</font></code>, <code><font color=#b9b96e>-side</font></code>, <code><font color=#b9b96e>-step</font></code>, <code><font color=#b9b96e>-uplim</font></code></p>
<h5 class='ruff'>Superclasses</h5><p class='ruff'><a href="index-tclopt.html#::tclopt::Parameter" title="Parameter" class='ruff_cmd'>Parameter</a></p>
<h4 class='ruffmethod'><a name='::tclopt::ParameterMpfit::constructor'>constructor</a><span class='ns_scope'> [<a href="index-tclopt.html#::tclopt::ParameterMpfit" title="::tclopt::ParameterMpfit" class='ruff_cmd'>::tclopt::ParameterMpfit</a>]</span><span class='ruff-uplink'><a href='index-tclopt.html#::tclopt::ParameterMpfit'>ParameterMpfit</a>, <a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Creates parameter object for <a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a> class.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>OBJECT constructor</span> <span class='ruff_arg'>value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value? ?-debugder -debugreltol value -debugabstol value?</span></div>
<details><summary class='ruff-expand'><span>Details</span></summary>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code><font color=#b9b96e>-debugabstol</font></code></td><td>Absolute error that controls printing of derivatives comparison if absolute error exceeds this value. Requires -debugder and -debugreltol.</td></tr>
<tr><td><code><font color=#b9b96e>-debugder</font></code></td><td>Switch to enable console debug logging of user-computed derivatives, as described above. Note that when debugging is enabled, then -side should be set to auto, right, left or both, depending on which numerical derivative you wish to compare to. Requires -debugreltol and -debugabstol values.</td></tr>
<tr><td><code><font color=#b9b96e>-debugreltol</font></code></td><td>Relative error that controls printing of derivatives comparison if relative error exceeds this value. Requires -debugder and -debugabstol.</td></tr>
<tr><td><code><font color=#b9b96e>-fixed</font></code></td><td>Specify that parameter is fixed during optimization, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-lowlim</font></code></td><td>Specify lower limit for parameter, must be lower than upper limit if upper limit is provided, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-relstep</font></code></td><td>The <em>relative</em> step size to be used in calculating the numerical derivatives. This number is the fractional size of the step, compared to the parameter value. This value supercedes the -step setting. If the parameter is zero, then a default step size is chosen.</td></tr>
<tr><td><code><font color=#b9b96e>-side</font></code></td><td>The sidedness of the finite difference when computing numerical derivatives. This field can take four values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h, left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an : user-computed explicit derivatives, where h is the -step parameter described above. The &quot;automatic&quot; one-sided derivative method will chose a direction for the finite difference which does not violate any constraints. The other methods do not perform this check. The two-sided method is in principle more precise, but requires twice as many function evaluations. Default is auto.</td></tr>
<tr><td><code><font color=#b9b96e>-step</font></code></td><td>The step size to be used in calculating the numerical derivatives.  If set to zero, then the step size is computed automatically, optional.</td></tr>
<tr><td><code><font color=#b9b96e>-uplim</font></code></td><td>Specify upper limit for parameter, must be higher than lower limit if lower limit is provided, optional.</td></tr>
<tr><td><code>initval</code></td><td>Initial value of parameter.</td></tr>
<tr><td><code>name</code></td><td>Name of the parameter.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Example of building 4 parameters with different constraints:</p>

<figure  class='ruff-snippet ruff-figure'><pre class='ruff'><b><font color=#ffa500>set</font></b> par0 [::tclopt::ParameterMpfit new a 1.0 <font color=#b9b96e>-fixed</font> <font color=#b9b96e>-side</font> both]
<b><font color=#ffa500>set</font></b> par1 [::tclopt::ParameterMpfit new b 2.0]
<b><font color=#ffa500>set</font></b> par2 [::tclopt::ParameterMpfit new c 0.0 <font color=#b9b96e>-fixed</font>]
<b><font color=#ffa500>set</font></b> par3 [::tclopt::ParameterMpfit new d 0.1 <font color=#b9b96e>-lowlim</font> -0.3 <font color=#b9b96e>-uplim</font> 0.2]
</pre>

</figure><div class='ruff_source'><p class='ruff_source_link'><a id='l_tclopt_ParameterMpfit_constructor' href="javascript:toggleSource('tclopt_ParameterMpfit_constructor')">Show source</a></p>
<div id='tclopt_ParameterMpfit_constructor' class='ruff_dyn_src'><pre><b><font color=#fe6efe>method</font></b> constructor {args} {

    <i><font color=#76a396># Creates parameter object for [::tclopt::Mpfit] class.</font></i>
    <i><font color=#76a396>#  name - name of the parameter</font></i>
    <i><font color=#76a396>#  initval - initial value of parameter</font></i>
    <i><font color=#76a396>#  -fixed - specify that parameter is fixed during optimization, optional</font></i>
    <i><font color=#76a396>#  -lowlim - specify lower limit for parameter, must be lower than upper limit if upper limit is provided,</font></i>
    <i><font color=#76a396>#    optional</font></i>
    <i><font color=#76a396>#  -uplim - specify upper limit for parameter, must be higher than lower limit if lower limit is provided,</font></i>
    <i><font color=#76a396>#    optional</font></i>
    <i><font color=#76a396>#  -step - the step size to be used in calculating the numerical derivatives.  If set to zero, then the step</font></i>
    <i><font color=#76a396>#    size is computed automatically, optional</font></i>
    <i><font color=#76a396>#  -relstep - the *relative* step size to be used in calculating the numerical derivatives. This number is the</font></i>
    <i><font color=#76a396>#    fractional size of the step, compared to the parameter value. This value supercedes the -step setting.</font></i>
    <i><font color=#76a396>#    If the parameter is zero, then a default step size is chosen.</font></i>
    <i><font color=#76a396>#  -side - the sidedness of the finite difference when computing numerical derivatives. This field can take four</font></i>
    <i><font color=#76a396>#    values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h,</font></i>
    <i><font color=#76a396>#    left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an :</font></i>
    <i><font color=#76a396>#    user-computed explicit derivatives, where h is the -step parameter described above. The &quot;automatic&quot;</font></i>
    <i><font color=#76a396>#    one-sided derivative method will chose a direction for the finite difference which does not violate any</font></i>
    <i><font color=#76a396>#    constraints. The other methods do not perform this check. The two-sided method is in principle more precise,</font></i>
    <i><font color=#76a396>#    but requires twice as many function evaluations. Default is auto.</font></i>
    <i><font color=#76a396>#  -debugder - switch to enable console debug logging of user-computed derivatives, as described above. Note that</font></i>
    <i><font color=#76a396>#    when debugging is enabled, then -side should be set to auto, right, left or both, depending on which</font></i>
    <i><font color=#76a396>#    numerical derivative you wish to compare to. Requires -debugreltol and -debugabstol values.</font></i>
    <i><font color=#76a396>#  -debugreltol - relative error that controls printing of derivatives comparison if relative error exceeds this</font></i>
    <i><font color=#76a396>#    value. Requires -debugder and -debugabstol.</font></i>
    <i><font color=#76a396>#  -debugabstol - absolute error that controls printing of derivatives comparison if absolute error exceeds this</font></i>
    <i><font color=#76a396>#    value. Requires -debugder and -debugreltol.</font></i>
    <i><font color=#76a396># Synopsis: value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value?</font></i>
    <i><font color=#76a396>#   ?-debugder -debugreltol value -debugabstol value?</font></i>
    <i><font color=#76a396>#</font></i>
    <i><font color=#76a396># Example of building 4 parameters with different constraints:</font></i>
    <i><font color=#76a396># ```</font></i>
    <i><font color=#76a396># set par0 [::tclopt::ParameterMpfit new a 1.0 -fixed -side both]</font></i>
    <i><font color=#76a396># set par1 [::tclopt::ParameterMpfit new b 2.0]</font></i>
    <i><font color=#76a396># set par2 [::tclopt::ParameterMpfit new c 0.0 -fixed]</font></i>
    <i><font color=#76a396># set par3 [::tclopt::ParameterMpfit new d 0.1 -lowlim -0.3 -uplim 0.2]</font></i>
    <i><font color=#76a396># ```</font></i>
    <b><font color=#ffa500>set</font></b> arguments [argparse <font color=#b9b96e>-inline</font> <font color=#b9b96e>-pfirst</font> <font color=#b9b96e>-help</font> {Creates parameter object for '::tclopt::Mpfit' class} {
        {<font color=#b9b96e>-fixed</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-help</font> {Specify that parameter is fixed during optimization}}
        {<font color=#b9b96e>-lowlim</font>= <font color=#b9b96e>-help</font> {Specify lower limit for parameter, must be lower than upper limit if upper limit is provided}}
        {<font color=#b9b96e>-uplim</font>= <font color=#b9b96e>-help</font> {Specify upper limit for parameter, must be higher than lower limit if lower limit is provided}}
        {<font color=#b9b96e>-step</font>= <font color=#b9b96e>-help</font> {The step size to be used in calculating the numerical derivatives.  If set to zero, then the size is computed automatically step}}
        {<font color=#b9b96e>-relstep</font>= <font color=#b9b96e>-help</font> {The *relative* step size to be used in calculating the numerical derivatives. This number is the fractional size of the step, compared to the parameter value. This value supercedes the <font color=#b9b96e>-step</font> setting. If the parameter is zero, then a default step size is chosen}}
        {<font color=#b9b96e>-side</font>= <font color=#b9b96e>-enum</font> {auto right left both an} <font color=#b9b96e>-default</font> auto <font color=#b9b96e>-help</font> {The sidedness of the finite difference when computing numerical derivatives. This field can take four values: auto : one-sided derivative computed automatically, right : one-sided derivative (f(x+h)-f(x))/h, left : one-sided derivative (f(x)-f(x-h))/h, both : two-sided derivative (f(x+h)-f(x-h))/(2*h), an : user-computed explicit derivatives, where h is the <font color=#b9b96e>-step</font> parameter described above. The <font color=#90ee90>&quot;automatic&quot;</font> one-sided derivative method will chose a direction for the finite difference which does not violate any constraints. The other methods do not perform this check. The two-sided method is in principle more precise, but requires twice as many function evaluations. Default is auto}}
        {<font color=#b9b96e>-debugder</font> <font color=#b9b96e>-boolean</font> <font color=#b9b96e>-require</font> {debugreltol debugabstol} <font color=#b9b96e>-help</font> {Switch to enable console debug logging of user-computed derivatives, as described above. Note that when debugging is enabled, then <font color=#b9b96e>-side</font> should be set to auto, right, left or both, depending on which numerical derivative you wish to compare to}}
        {<font color=#b9b96e>-debugreltol</font>= <font color=#b9b96e>-help</font> {Relative error that controls printing of derivatives comparison if relative error exceeds this value}}
        {<font color=#b9b96e>-debugabstol</font>= <font color=#b9b96e>-help</font> {Absolute error that controls printing of derivatives comparison if absolute error exceeds this value}}
        {name <font color=#b9b96e>-help</font> {Name of the parameter}}
        {initval <font color=#b9b96e>-help</font> {Initial value of parameter}}
    }]
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-side</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> side]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$arguments</font> step]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-step</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> step]
    }
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dexist</font></b> <font color=#f1b479>$arguments</font> relstep]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-relstep</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> relstep]
    }
    <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-debugder</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugder]
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugder]} {
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-derivreltol</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugreltol]
        <b><font color=#fe6efe>my</font></b> configure <font color=#b9b96e>-derivabstol</font> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> debugabstol]
    }
    <b><font color=#ffa500>set</font></b> params {}
    <b><font color=#ffa500>if</font></b> {[<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> fixed]} {
        <b><font color=#ffa500>lappend</font></b> params <font color=#b9b96e>-fixed</font>
    }
    <b><font color=#ffa500>dict</font></b> for {paramName value} <font color=#f1b479>$arguments</font> {
        <b><font color=#ffa500>if</font></b> {<font color=#f1b479>$paramName</font> ni {name initval side step relstep debugder debugreltol debugabstol fixed}} {
            <b><font color=#ffa500>lappend</font></b> params -<font color=#f1b479>$paramName</font> <font color=#f1b479>$value</font>
        }
    }
    <b><font color=#ffa500>next</font></b> [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> name] [<b><font color=#ffa500>dget</font></b> <font color=#f1b479>$arguments</font> initval] {<b><font color=#ffa500>*</font></b>}<font color=#f1b479>$params</font>
}</pre></div>
</div></details>
</main><nav class='ruff-nav'><ul ><li class='ruff-toc1'><a style='padding-top:2px;' href='index.html'>Start page</a></li>
<li class='ruff-toc1'><a href='index-docindex.html' accesskey='i'>Index</a></li>
<hr>
<li class='ruff-toc1'><a href='index-Examples.html'>Examples</a></li>
<li class='ruff-toc1'><a class='ruff-highlight' href='index-tclopt.html'>tclopt</a></li>
<hr><li class='ruff-toc2'><a href='#::tclopt-Classes'>Classes</a></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::DuplChecker'>DuplChecker</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::DuplChecker::duplListCheck'>duplListCheck</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT duplListCheck&lt;/span&gt; &lt;span class='ruff_arg'&gt;<b><font color=#ffa500>list</font></b>&lt;/span&gt;</pre>Checks if list contains duplicates.
</span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::Mpfit'>Mpfit</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT constructor&lt;/span&gt; &lt;span class='ruff_arg'&gt;<font color=#b9b96e>-funct</font> value <font color=#b9b96e>-m</font> value <font color=#b9b96e>-pdata</font> value ?-ftol value? ?-xtol value? ?-gtol value? ?-stepfactor value? ?-covtol value? ?-maxiter value? ?-maxfev value? ?-epsfcn value? ?-nofinitecheck?&lt;/span&gt;</pre>Creates optimization object that does least squares fitting using modified Levenberg-Marquardt algorithm.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::addPars'>addPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT addPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::getAllPars'>getAllPars</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllPars&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets references of all parameters objects.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::getAllParsNames'>getAllParsNames</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT getAllParsNames&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre>Gets names of all parameters.
</span></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Mpfit::run'>run</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT run&lt;/span&gt; </pre>Runs optimization.
</span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::Parameter'>Parameter</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::Parameter::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;<b><font color=#ffa500>Parameter</font></b> create OBJNAME&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;
&lt;span class='ruff_cmd'&gt;<b><font color=#ffa500>Parameter</font></b> new&lt;/span&gt; &lt;span class='ruff_arg'&gt;?args?&lt;/span&gt;</pre></span></li><li class='ruff-toc3'><a href='index-tclopt.html#::tclopt::ParameterMpfit'>ParameterMpfit</a></li><li class='ruff-toc4 ruff-tip'><a href='index-tclopt.html#::tclopt::ParameterMpfit::constructor'>constructor</a><span class='ruff-tiptext'><pre>&lt;span class='ruff_cmd'&gt;OBJECT constructor&lt;/span&gt; &lt;span class='ruff_arg'&gt;value value ?-fixed? ?-lowlim value? ?-uplim value? ?-step value? ?-relstep value? ?-side value? ?-debugder <font color=#b9b96e>-debugreltol</font> value <font color=#b9b96e>-debugabstol</font> value?&lt;/span&gt;</pre>Creates parameter object for <a href="index-tclopt.html#::tclopt::Mpfit" title="::tclopt::Mpfit" class='ruff_cmd'>::tclopt::Mpfit</a> class.
</span></li></ul></nav><footer class='ruff-layout-footer ruff-ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div><div>&copy; George Yashin</div></footer>
</div></body></html>
